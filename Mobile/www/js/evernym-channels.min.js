/*! evernym-channels 2014-01-22 */

function EnymAmpSvc(){function a(a,b,c){d(a,b,c,"GET")}function b(a,b,c){d(a,b,c,"POST")}function c(a,b,c){d(a,b,c,"PUT")}function d(a,b,c,d){var e={url:f+b+(void 0==c?"":"/"+c),dataType:"json",type:d};amplify.request.define(a,"ajax",e)}var e=this;e.request=function(a,b){var c=$.Deferred();return amplify.request({resourceId:a,data:b,success:c.resolve,error:c.reject}),c.promise()};var f="http://localhost:8079/api24/rest/",g="account",h="channel";a("getChnl",h,"{id}"),b("enroll",g,"enroll"),a("checkName",g,"{name}"),b("login",g,"login"),a("getAccount",g),c("modAccount",g),b("logout",g,"logout"),b("forgotPassword",g,"forgot"),c("resetPassword",g,"forgot"),c("changePassword",g,"password")}function EvernymChannelService(a){console.log("loading EvernymChannelService");{var b=this;new Array}b.createChannel=function(b,c){return a.callAPI("POST","/channel",b,c,!0)},b.listMyChannels=function(b){return a.callAPI("GET","/channel?relationship=O",void 0,b,!0)},b.listFollowingChannels=function(b){return a.callAPI("GET","/channel?relationship=F",void 0,b,!0)},b.getChannel=function(b,c){return a.callAPI("GET","/channel/"+b,void 0,c,!0)},b.followChannel=function(b,c){return a.callAPI("POST","/channel/"+b+"/follower",void 0,c,!0)},b.getFollowers=function(b,c){return a.callAPI("GET","/channel/"+b+"/follower",void 0,c,!0)},b.getFollower=function(b,c){return a.callAPI("GET","/follower/"+b,void 0,c,!0)},b.unfollowChannel=function(b,c){return a.callAPI("DELETE","/channel/"+b+"/follower",void 0,c,!0)},b.addFollower=function(b,c,d){return a.callAPI("POST","/channel/"+b+"/follower/"+c,void 0,d,!0)},b.removeFollower=function(b,c,d){return a.callAPI("DELETE","/channel/"+b+"/follower/"+c,void 0,d,!0)},b.deleteChannel=function(b,c){return a.callAPI("DELETE","/channel/"+b,void 0,c,!0)},b.modifyChannel=function(b,c){var d=b.id;return delete b.id,a.callAPI("PUT","/channel/"+d,b,c,!0)},b.getFollowerReq=function(b){return a.callAPI("GET","/channel/"+b+"/followerrequest",void 0,void 0,!1)},b.addFollowerReq=function(b,c){return a.callAPI("POST","/channel/"+b+"/followerrequest/"+c,void 0,void 0,!0)},b.removeFollowerReq=function(b,c){return a.callAPI("DELETE","/channel/"+b+"/followerrequest/"+c,void 0,void 0,!0)},b.getChnlSettings=function(b){return a.callAPI("GET","/channel/"+b+"/setting",void 0,void 0,!0)},b.putChnlSettings=function(b,c){return a.callAPI("PUT","/channel/"+b+"/setting",c,void 0,!0)},b.removeChnlSetting=function(b,c){return a.callAPI("DELETE","/channel/"+b+"/setting/"+c,void 0,void 0,!0)},b.invite=function(b,c,d){return a.callAPI("POST","/channel/"+b+"/invite",c,d,!0)}}function EvernymCommethodService(a){console.log("loading EvernymCommethodService"),this.verification=function(b,c,d){return a.callAPI("PUT","/commethod/verification/"+b,void 0,c,d)},this.getCommethods=function(b){return a.callAPI("GET","/commethod",void 0,b,!0)},this.addCommethod=function(b,c){return a.callAPI("POST","/commethod",b,c,!0)},this.deleteCommethod=function(b,c){return a.callAPI("DELETE","/commethod/"+b,void 0,c,!0)},this.requestVerification=function(b,c){return a.callAPI("POST","/commethod/"+b+"/verification",void 0,c,!0)},this.getCommethodsForProvis=function(b){return a.callAPI("GET","/account/"+b+"/commethod",void 0,void 0,!0)},this.addCommethodForProvis=function(b,c){return a.callAPI("POST","/account/"+b+"/commethod",c,void 0,!0)},this.deleteCommethodForProvis=function(b,c){return a.callAPI("DELETE","/account/"+b+"/commethod/"+c,void 0,void 0,!0)},this.requestVerificationForProvis=function(b,c){return a.callAPI("POST","/account/"+b+"/commethod/"+c+"/verification",void 0,void 0,!0)}}function EvernymEscPlanService(a){this.getEscPlans=function(b){return a.callAPI("GET","/escplan",void 0,b,!0)}}function EvernymLoginService(a){console.log("loading EvernymLoginService");var b=this;b.accountEnroll=function(b,c){return a.callAPI("POST","/account/enroll",b,c)},b.checkName=function(b,c){return a.callAPI("GET","/account/"+b,void 0,c)},b.accountLogin=function(b,c){return a.callAPI("POST","/account/login",b,c)},b.getAccount=function(b){return a.callAPI("GET","/account",void 0,b,!0)},b.accountModify=function(b,c){return a.callAPI("PUT","/account",b,c,!0)},b.accountModifyOther=function(b,c,d){return a.callAPI("PUT","/account/"+b,c,d,!0)},b.accountLogout=function(b){return a.callAPI("POST","/account/logout",void 0,b,!0)},b.forgotPassword=function(b,c){return a.callAPI("POST","/account/forgot",b,c)},b.resetPassword=function(b,c){return a.callAPI("PUT","/account/forgot",b,c)},b.changePassword=function(b,c){return a.callAPI("PUT","/account/password",b,c,!0)}}function EvernymMessageService(a){console.log("loading EvernymMessageService"),this.createChannelMessage=function(b,c,d){return a.callAPI("POST","/channel/"+b+"/message",c,d,!0)},this.getChannelMessages=function(b,c,d){var e=[],f="";for(var g in c)e.push(g+"="+c[g]);return e.length&&(f="?"+e.join("&")),a.callAPI("GET","/channel/"+b+"/message"+f,void 0,d,!0)},this.getChannelMessagesForFollower=function(b,c,d){var e=[],f="";for(var g in c)e.push(g+"="+c[g]);return e.length&&(f="?"+e.join("&")),a.callAPI("GET","/channel/"+b+"/messagealert"+f,void 0,d,!0)},this.getChannelMessage=function(b,c,d){return a.callAPI("GET","/channel/"+b+"/message/"+c,void 0,d,!0)},this.getResponseMessages=function(b,c,d){return a.callAPI("GET","/channel/"+b+"/message?replyto="+c,void 0,d,!0)},this.getMessageRecipients=function(b,c,d,e){var f="";return("Y"===d||"N"===d)&&(f="?iGi="+d),a.callAPI("GET","/channel/"+b+"/message/"+c+"/recipient"+f,void 0,e,!0)},this.readMsg=function(b,c){return a.callAPI("POST","/message/"+b+"/read",void 0,c,!0)},this.dismissMsg=function(b,c){return a.callAPI("POST","/message/"+b+"/dismiss",void 0,c,!0)},this.acknowledgeMsg=function(b,c){return a.callAPI("POST","/message/"+b+"/igi",void 0,c,!0)},this.fetchMsgNotifs=function(b){return a.callAPI("GET","/notification?type=msg",void 0,b,!0)}}function ServiceContext(a,b){var c={};return c.evernymService=new EvernymService(a,b),c.channelService=new EvernymChannelService(c.evernymService),c.commethodService=new EvernymCommethodService(c.evernymService),c.loginService=new EvernymLoginService(c.evernymService),c.systemService=new EvernymSystemService(c.evernymService),c.messageService=new EvernymMessageService(c.evernymService),c.escplanService=new EvernymEscPlanService(c.evernymService),c}function EvernymService(a,b){function c(a){var b="",c=/<p><b>description<\/b>(.*)<\/p>/,d=c.exec(a);return d.length&&(b=d[1]),b}console.log("loading EvernymService");var d=this,e=b?b:"https://api.evernym.com/api24/rest";d.getBaseUrl=function(){return e},d.doAfterDone=function(){},d.doAfterFail=function(){},d.storage=a?a:ENYM.ctx,d.getAccessToken=function(){return d.storage.getItem("accessToken")},d.clearAccessToken=function(){d.storage.removeItem("accessToken")},d.setAccessToken=function(a){d.storage.setItem("accessToken",a)},d.callAPI=function(a,b,f,g,h){var i=d.storage.getItem("baseUrl");i&&(e=i);var j={url:e+b,type:a,data:JSON.stringify(f),dataType:"json",contentType:"application/json"},k=d.getAccessToken();h&&k&&(j.beforeSend=function(a){a.setRequestHeader("Authorization",k)});var l=$.Deferred(),m=$.ajax(j);return m.done(function(a,b,c){d.doAfterDone(),g&&g.success&&g.success(a,b,c.status,c.responseText),l.resolve(a,b,c.status,c.responseText)}),m.fail(function(a,b,e){var f=/<b>description<\/b>/,h={},i=f.exec(a.responseText);if(i&&i.length)h.message=c(a.responseText);else try{h=JSON.parse(a.responseText)}catch(k){h.message=a.responseText}d.doAfterFail(j,a,b,e,h),g&&g.error&&g.error(e?e:b,a.status,h),l.reject(e?e:b,a.status,h)}),l.promise()}}function EvernymSystemService(a){console.log("loading EvernySystemService");var b=this;b.sendFeedback=function(b,c){return a.callAPI("POST","/system/feedback",b,c,!0)},b.getUrgencySettings=function(b){return a.callAPI("GET","/system/urgency",void 0,b,!0)},b.getMsgNotifs=function(b){return a.callAPI("GET","/notification?type=msg",void 0,b,!0)},b.getMsgNotifsSmry=function(b){return a.callAPI("GET","/notification/summary?type=msg",void 0,b,!0)},b.getFeedback=function(){return a.callAPI("GET","/admin/feedback",void 0,void 0,!0)},b.MnsCacheData={},b.MnsLastUpdated=0,b.MnsCacheTTL=6e4,b.adjMnsCount=function(a){b.MnsCacheData.data.unreadCount+=a;var c=Date.now()-b.MnsLastUpdated;c>b.MnsCacheTTL-5e3&&c<b.MnsCacheTTL&&(b.MnsLastUpdated=Date.now()-(b.MnsCacheTTL-5e3))},b.getMsgNotifsSmry_C=function(a){var c=Date.now()-b.MnsLastUpdated,d=$.Deferred();if(c>0&&6e4>c){var e=b.MnsCacheData;d.resolve(e.data,e.textStatus,e.status,e.responseText)}else b.getMsgNotifsSmry(a).then(function(a,c,e,f){"204"!=e&&(b.MnsLastUpdated=Date.now(),b.MnsCacheData.data=a,b.MnsCacheData.textStatus=c,b.MnsCacheData.status=e,b.MnsCacheData.responseText=f,d.resolve(a,c,e,f))},function(a,c,e){b.MnsLastUpdated=0,d.reject(a,c,e)});return d.promise()}}function AboutEvernymViewModel(){var a=this;a.template="aboutEvernymView",a.viewid="V-46",a.viewname="About Evernym",a.displayname="About Evernym Channels",a.activate=function(){addExternalMarkup(a.template)}}function AddContactViewModel(){var a=this;a.template="addContactView",a.viewid="V-081",a.viewname="Cont. Info",a.displayname="Add/Edit Contact",a.hasfooter=!0,a.channels=ko.observableArray([]),a.commethods=ko.observableArray([]),a.inputObs=["baseUrl","currentDeleteCommethod","verify","deletedID","navText","currentDeleteCommethodID"],a.defineObservables(),a.showDelete=ko.observable(!1),a.showConfirm=ko.observable(!1),a.pView="",a.getCommethods=function(){var a={success:function(){},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};return ES.commethodService.getCommethods(a)},a.gotoVerify=function(b){a.verify(!0),ENYM.ctx.setItem("currentVerificationCommethod",b.comMethodAddress),ENYM.ctx.setItem("commethodType",b.comMethodType),ENYM.ctx.setItem("currentVerificationCommethodID",b.comMethodID),ENYM.ctx.setItem("verificationStatus",!1),viewNavigate("Cont. Info","addContactView","verifyContactView")},a.gotoDelete=function(b){0==a.verify()&&(a.currentDeleteCommethod(b.comMethodAddress),a.currentDeleteCommethodID(b.comMethodID),ENYM.ctx.setItem("CommethodType",b.comMethodType)),a.showDelete(!0)},a.gotoView=function(){a.currentDeleteCommethodID()?(a.currentDeleteCommethodID(""),goToView("addContactView")):(a.currentDeleteCommethodID(""),goToView("userSettingsView"))},a.showConfirmButton=function(){a.showConfirm(!0)},a.confirmDelete=function(){var b={success:function(){a.deletedID(a.currentDeleteCommethodID())},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};if(ES.commethodService.deleteCommethod(a.currentDeleteCommethodID(),b),"EMAIL"==ENYM.ctx.getItem("CommethodType")){var c="Email address deleted";ENYM.ctx.removeItem("CommethodType")}else{var c="Phone number deleted";ENYM.ctx.removeItem("CommethodType")}var d={redirect:"addContactView",type:"",text:c};showToast(d),goToView("addContactView")},a.showCommethods=function(b){if(b.commethod.length>0){var c="",d=!1;$.each(b.commethod,function(b,e){"N"==e.verified?(c="notverify",d=!0):(c="notverify",d=!1),tempCommethodTypeClass="EMAIL"==e.type?"emailicon":"texticon",a.deletedID()!=e.id&&a.commethods.push({comMethodID:e.id,comMethodAddress:e.address,comMethodClass:c,comMethodVerify:d,comMethodType:e.type,comMethodTypeClass:tempCommethodTypeClass})})}},a.activate=function(){addExternalMarkup(a.template);var b=ENYM.ctx.getItem("baseUrl"),c=ENYM.ctx.getItem("previousView");console.log("previousView: "+c);var d=ko.dataFor($("#"+c).get(0));if(console.log("previousView Model viewid: "+d.displayname),a.navText(d.displayname),a.pView=c,b)a.baseUrl(b);else{var e=new EvernymService;a.baseUrl(e.getBaseUrl())}a.commethods.removeAll(),a.showDelete(!1),a.showConfirm(!1),a.verify(!1),ENYM.ctx.removeItem("currentVerificationCommethodID"),setTimeout(function(){return $.mobile.showPageLoadingMsg("a","Loading commmethods."),a.getCommethods().then(a.showCommethods)},1e3)}}function AddFollowersViewModel(){function a(){var a={};if(""!=d.firstLastName()){var b=d.firstLastName().split(" "),c=b[0],e=b[1];""!=c&&(a.firstname=c),""!=e&&(a.lastname=e)}return""!=d.emailaddress()&&(a.emailaddress=d.emailaddress()),""!=d.smsPhone()&&(a.phonenumber=d.smsPhone()),a}function b(){d.showInvite(!1)}function c(){$.mobile.hidePageLoadingMsg(),""!=d.emailaddress()&&""!=d.smsPhone()?(d.emailClass("validationerror"),d.phoneClass("validationerror"),d.errorPhone("<span>Sorry,</span> phone or email already invited")):""!=d.emailaddress()?(d.emailClass("validationerror"),d.errorEmail("<span>Sorry,</span> email already associated with this channel.")):(d.phoneClass("validationerror"),d.errorPhone("<span>Sorry,</span> phone already associated with this channel."))}var d=this;d.template="addFollowersView",d.viewid="V-28",d.viewname="Add Followers",d.displayname="Add Followers",d.showInvite=ko.observable(),d.inputObs=["channelId","channelName","firstLastName","nameClass","errorName","emailaddress","emailClass","errorEmail","smsPhone","phoneClass","errorPhone"],d.errorObs=["nameClass","errorName","emailClass","errorEmail","errorPhone","phoneClass"],d.defineObservables(),d.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(d.showInvite(!0),a){addExternalMarkup(d.template);var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));d.channelId(a.channelId),d.channelName(a.channelName),$("input").keyup(function(){d.clearErrorObs()})}else goToView("channelsIOwnView")},$(document).keyup(function(a){13==a.keyCode&&"addFollowersView"==$.mobile.activePage.attr("id")&&d.addFollowersCommand()}),d.addFollowersCommand=function(){if(""==d.emailaddress()&&""==d.smsPhone())return d.errorPhone("<span>Sorry,</span> a phone or email address are required."),d.phoneClass("validationerror"),d.emailClass("validationerror"),!1;if(""==d.smsPhone()){var e=validateEmail(d.emailaddress());if("Error"==e.type)return d.errorEmail(e.text),d.emailClass("validationerror"),!1}else if(""==d.emailaddress()){var f=validateUSAPhone(d.smsPhone());if("Error"==f.type)return d.errorPhone(f.text),d.phoneClass("validationerror"),!1;d.smsPhone(f.text)}else{var e=validateEmail(d.emailaddress());if("Error"==e.type)return d.errorEmail(e.text),d.emailClass("validationerror"),!1;var f=validateUSAPhone(d.smsPhone());if("Error"==f.type)return d.errorPhone(f.text),d.phoneClass("validationerror"),!1;d.smsPhone(f.text)}$.mobile.showPageLoadingMsg("a","Adding Provisional Follower");var g=a();ES.channelService.invite(d.channelId(),g,{success:b,error:c})}}function AddInviteFollowersViewModel(){var a=this;a.template="addInviteFollowersView",a.viewid="V-27",a.viewname="Add/Invite",a.displayname="Add/Invite Followers",a.inputObs=["channelName","channelWebAddress"],a.defineObservables(),a.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(b){addExternalMarkup(a.template);var b=JSON.parse(ENYM.ctx.getItem("currentChannelData"));a.channelName(b.channelName),a.channelWebAddress(b.channelName+".evernym.com")}else goToView("channelsIOwnView")},a.comingSoon=function(){headerViewModel.comingSoon()}}function AdditionalContactViewModel(){var a=this;a.template="additionalContactView",a.viewid="V-10",a.viewname="AdditionalContact",a.displayname="Additional Contact",a.inputObs=["baseUrl","comMethodName"],a.errorObs=["errorMessage","errorMessageInput"],a.defineObservables(),a.activate=function(){addExternalMarkup(a.template),$("input").keyup(function(){a.clearErrorObs()}),ENYM.ctx.removeItem("currentVerificationCommethodID")},$(document).keyup(function(b){13==b.keyCode&&"additionalContactView"==$.mobile.activePage.attr("id")&&a.addCommethod()}),a.addCommethod=function(){var b=/^[0-9\-\s\(\)\+]+$/i;if(""==a.comMethodName())a.errorMessage("<span>ERROR:</span> Please input email or phone!"),a.errorMessageInput("validationerror");else if(b.test(a.comMethodName())){var c=validateUSAPhone(a.comMethodName());if("Error"==c.type)return a.errorMessage(c.text),a.errorMessageInput("validationerror"),!1;a.comMethodName(c.text);var d={name:"Default name",type:"TEXT",address:a.comMethodName()};a.addNewCommethod(d)}else{var e=validateEmail(a.comMethodName());if("Error"==e.type)return a.errorMessage(e.text),a.errorMessageInput("validationerror"),!1;var d={name:"Default name",type:"EMAIL",address:a.comMethodName()};a.addNewCommethod(d)}},a.addNewCommethod=function(b){var c={success:function(a){ENYM.ctx.setItem("commethodType",a.type),"TEXT"==a.address?(ENYM.ctx.setItem("currentVerificationCommethod",a.address+"(TXT)"),ENYM.ctx.setItem("currentVerificationCommethodID",a.id)):(ENYM.ctx.setItem("currentVerificationCommethod",a.address),ENYM.ctx.setItem("currentVerificationCommethodID",a.id)),ENYM.ctx.setItem("verificationStatus",!0);var b={redirect:"verifyContactView",type:"",text:"Verification message sent"};showToast(b),goToView("verifyContactView")},error:function(b,c,d){a.errorMessage("<span>ERROR:</span> "+d.message)}};$.mobile.showPageLoadingMsg("a","Adding new communication methods"),ES.commethodService.addCommethod(b,c)}}function AdministratorFeedbackViewModel(){function a(a){$.each(a,function(a,b){b.context=b.context+"-icon",b.created=formatDate(b.created,"short","follow")}),b.submittedFeedbacks(a)}var b=this;b.template="administratorFeedbackView",b.viewid="V-47",b.viewname="Administrator Feedbacks",b.displayname="Administrator Feedbacks",b.submittedFeedbacks=ko.observableArray([]),b.activate=function(){addExternalMarkup(b.template),ENYM.ctx.removeItem("singleFeedback"),b.getFeedbacks().then(a)},b.getFeedbacks=function(){return ES.systemService.getFeedback()},b.showSingleFeedback=function(a){ENYM.ctx.setItem("singleFeedback",a),viewNavigate("Feedbacks","administratorFeedbackView","singleFeedbackView")}}function AdministratorViewModel(){var a=this;a.template="administratorView",a.viewid="V-47",a.viewname="Administrator",a.displayname="Administrator",a.activate=function(){addExternalMarkup(a.template)},a.comingSoon=function(){headerViewModel.comingSoon()}}function AfterLoginVerifyViewModel(){var a=this;a.template="afterLoginVerifyView",a.viewid="V-??",a.viewname="Verify Contact",a.displayname="Verify Contact",a.inputObs=["commethod","verificationCommethodType","verificationCommethod","verificationCommethodID","verificationCode","verified","status"],a.errorObs=["verificationClass","errorMessage"],a.defineObservables(),a.activate=function(){return addExternalMarkup(a.template),action=JSON.parse(ENYM.ctx.getItem("action")),$("input").keyup(function(){a.clearErrorObs()}),a.getCommethods()},$(document).keyup(function(b){13==b.keyCode&&"afterLoginVerifyView"==$.mobile.activePage.attr("id")&&a.verifyRequestCommethod()}),a.verifyCommand=function(){a.status("verify"),$.when(a.getCommethods().then(function(){"Y"==a.verified()?a.skipCommand():a.verifyRequestCommethod()}))},a.getCommethods=function(){var b={success:function(b){a.commethod(b.commethod[0].address),a.verificationCommethodType(),a.verificationCommethod(b.commethod[0].type),a.verificationCommethodID(b.commethod[0].id),a.verified(b.commethod[0].verified);var c={success:function(){},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};"verify"!=a.status()&&ES.commethodService.requestVerification(a.verificationCommethodID(),c)},error:function(a,b,c){showMessage(c.message)}};return $.mobile.showPageLoadingMsg("a","Sending Verification Request"),ES.commethodService.getCommethods(b)},a.verifyRequestCommethod=function(){if(""==a.verificationCode())a.verificationClass("validationerror"),a.errorMessage("<span>ERROR:</span> Please input verification code!");else if(6!=a.verificationCode().length)a.verificationClass("validationerror"),a.errorMessage("<span>ERROR:</span> Verification code should be 6 digits!");else{var b={code:a.verificationCode(),type:a.verificationCommethodType(),address:a.verificationCommethod()};a.verifyRequest(b)}},a.requestVerificationCode=function(){var b={success:function(){var a={type:"",text:"Verification code sent"};showToast(a)},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};return $.mobile.showPageLoadingMsg("a","Resending Verification code"),ES.commethodService.requestVerification(a.verificationCommethodID(),b)},a.verifyRequest=function(b){var c={success:function(){if(action&&"Y"==action.follow_channel&&"Y"==action.SHARE_NAME){var a={redirect:"nameRequiredView",type:"",text:"Email verified"};goToView("nameRequiredView")}else if(action&&"Y"==action.follow_channel&&"N"==action.SHARE_NAME){var b={success:function(){var a={redirect:"channelsFollowingListView",type:"",text:"Now following "+c.name};showToast(a)},error:function(a,b,c){var d={redirect:"channelsFollowingListView",type:"toast-error",text:c.message};showToast(d)}},c=JSON.parse(ENYM.ctx.getItem("currentChannel"));ES.channelService.followChannel(c.id,b),goToView("channelsFollowingListView"),ENYM.ctx.removeItem("action")}else{var a={redirect:"homeView",type:"",text:"Email verified"};goToView("homeView")}showToast(a)},error:function(b,c,d){"100912"==d.code?(a.verified("Y"),a.skipCommand()):(a.verified("N"),a.errorMessage("<span>ERROR:</span> "+d.message))}};return $.mobile.showPageLoadingMsg("a","Sending Verification Request"),ES.commethodService.verification(b.code,c,ES.evernymService.getAccessToken())},a.skipCommand=function(){if(action&&"Y"==action.follow_channel&&"Y"==action.SHARE_NAME)if("Y"==a.verified()){var b={redirect:"nameRequiredView",type:"toast-info",text:"Email already verified"};showToast(b),goToView("nameRequiredView")}else goToView("nameRequiredView");else if(action&&"Y"==action.follow_channel&&"N"==action.SHARE_NAME){var c={success:function(){var a={redirect:"channelsFollowingListView",type:"",text:"Now following "+d.name};showToast(a),goToView("channelsFollowingListView")},error:function(a,b,c){var d={redirect:"channelsFollowingListView",type:"toast-error",text:c.message};showToast(d),goToView("channelsFollowingListView")}},d=JSON.parse(ENYM.ctx.getItem("currentChannel"));ES.channelService.followChannel(d.id,c),ENYM.ctx.removeItem("action")}else if("Y"==a.verified()){if("TEXT"==a.verificationCommethod)var e="Phone number already verified";else var e="Email already verified";var b={redirect:"homeView",type:"toast-info",text:e};showToast(b),goToView("homeView")}else goToView("homeView")}}function ChangePasswordViewModel(){function a(){$.mobile.hidePageLoadingMsg(),c.sectionOne(!1),c.sectionTwo(!0)}function b(a,b,d){$.mobile.hidePageLoadingMsg(),c.currentpasswordClass("validationerror"),c.newpasswordClass("validationerror"),c.confirmpasswordClass("validationerror"),c.errorMessageConfirm(d.message)}var c=this;c.template="changePasswordView",c.viewid="V-44",c.viewname="Change Password",c.displayname="Change Password",c.sectionOne=ko.observable(!0),c.sectionTwo=ko.observable(!1),c.inputObs=["currentPassword","newPassword","newConfirmPassword"],c.errorObs=["currentpasswordClass","newpasswordClass","confirmpasswordClass","errorMessageCurrent","errorMessageNew","errorMessageConfirm"],c.defineObservables(),c.activate=function(){addExternalMarkup(c.template),c.sectionOne(!0),c.sectionTwo(!1),$("input").keyup(function(){c.clearErrorObs()})},$(document).keyup(function(a){13==a.keyCode&&"changePasswordView"==$.mobile.activePage.attr("id")&&c.changePassword()}),c.changePassword=function(){if(""==c.currentPassword())c.currentpasswordClass("validationerror"),c.errorMessageCurrent("Please input your current password!");else if(""==c.newPassword())c.newpasswordClass("validationerror"),c.errorMessageNew("Please input new password!");else if(""==c.newConfirmPassword())c.confirmpasswordClass("validationerror"),c.errorMessageConfirm("Please input new confirm password!");else if(c.newPassword()!=c.newConfirmPassword())c.newpasswordClass("validationerror"),c.confirmpasswordClass("validationerror"),c.errorMessageConfirm("Password's don't match");else{if(!(c.newPassword().length<8)){$.mobile.showPageLoadingMsg("a","Sending change password request");var d={};return d.currentPassword=c.currentPassword(),d.newPassword=c.newPassword(),ES.loginService.changePassword(d,{success:a,error:b})}c.newpasswordClass("validationerror"),c.confirmpasswordClass("validationerror"),c.errorMessageConfirm("Password of min. 8 characters")}},c.okayChangeCommand=function(){ENYM.ctx.removeItem("changePassword"),popBackNav()}}function ChannelChangeIconViewModel(){function a(){goToView("channelSettingsView")}function b(){$.mobile.hidePageLoadingMsg()}var c=this;c.template="channelChangeIconView",c.viewid="V-16",c.viewname="Change Icon",c.displayname="Channel Chage Icon Image",c.inputObs=["channelId","picId"],c.defineObservables(),c.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(!a){goToView("channelsIOwnView"),addExternalMarkup(c.template);var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));c.channelId(a.channelId)}},c.changeChannelIconCommand=function(){var d={id:c.channelId(),picId:c.picId()};$.mobile.showPageLoadingMsg("a","Modifying Channel "),ES.channelService.modifyChannel(d,{success:a,error:b})}}function ChannelChangeNameViewModel(){var a=this;a.template="channelChangeNameView",a.viewid="V-16",a.viewname="Change Chan",a.displayname="Change Channel Name",a.sectionOne=ko.observable(!0),a.sectionTwo=ko.observable(!1),a.inputObs=["channelId","channelChangeName","channelClass","message","errorChannel","channelWebAddress"],a.defineObservables(),a.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(b){addExternalMarkup(a.template);var b=JSON.parse(ENYM.ctx.getItem("currentChannelData"));a.channelId(b.channelId),a.channelChangeName(b.channelName),$("input").keyup(function(){a.message(""),a.errorChannel(""),a.channelClass("")})}else goToView("channelsIOwnView")},$(document).keyup(function(b){13==b.keyCode&&"channelChangeNameView"==$.mobile.activePage.attr("id")&&a.nextViewCommand()}),a.nextViewCommand=function(){headerViewModel.comingSoon()},a.confirmChannelChangeNameCommand=function(){({id:a.channelId(),name:a.channelChangeName()})}}function ChannelDeleteViewModel(){function a(){for($.mobile.hidePageLoadingMsg();"channelsIOwnView"!=backNavView[backNavView.length-1];)backNavText.pop(),backNavView.pop();"channelsIOwnView"==backNavView[backNavView.length-1]&&(backNavText.pop(),backNavView.pop());var a={redirect:"channelsIOwnView",type:"",text:"Channel deleted"};showToast(a),sendMessageViewModel.channels.removeAll(),ENYM.ctx.removeItem("currentChannelData"),goToView("channelsIOwnView")}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="channelDeleteView",c.viewid="V-16",c.viewname="Channel Delete",c.displayname="Channel Delete",c.inputObs=["channelId","channelName","channelDisplayName"],c.defineObservables(),c.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(a){addExternalMarkup(c.template);var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));c.channelId(a.channelId),c.channelName(a.channelName),c.channelDisplayName(a.channeldescription)}else goToView("channelsIOwnView")},c.channelDeleteCommand=function(){return $.mobile.showPageLoadingMsg("a","Removing Channel"),ES.channelService.deleteChannel(c.channelId(),{success:a,error:b})}}function ChannelIntroViewModel(){function a(){$.mobile.showPageLoadingMsg("a","Loading channel Infomation"),ES.channelService.getChannel(d.channelId(),{success:b,error:c})}function b(a){var b=[];if(b.push({channelId:a.id,channelName:a.name,channelDescription:a.description,longDescription:a.longDescription,followerCount:a.followers}),b=b[0],ENYM.ctx.setItem("currentChannelData",JSON.stringify(b)),"tagline"==d.clickType()){d.taglineBtnText("Edit"),d.editing(!1);var c={type:"",text:"Channel Tagline updated"};showToast(c)}else{d.descBtnText("Edit"),d.editingTextarea(!1),d.less(!0);var c={type:"",text:"Description changed"};showToast(c),d.longDescription(d.longDescription().replace(/\n/g,"<br/>"))}}function c(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var d=this;d.template="channelIntroView",d.viewid="V-??",d.viewname="Channel Intro",d.displayname="Channel Introduction",d.sectionOne=ko.observable(!0),d.sectionTwo=ko.observable(!1),d.inputObs=["channelId","channelName","channelWebAddress","tagline","longDescription","moreText","taglineBtnText","descBtnText","clickType"],d.defineObservables(),d.editing=ko.observable(!1),d.editingTextarea=ko.observable(!1),d.less=ko.observable(!0),d.more=ko.observable(!1),d.moreButton=ko.observable(!1),d.lessButton=ko.observable(!1),d.activate=function(){d.sectionOne(!0),d.sectionTwo(!1);var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(addExternalMarkup(d.template),d.channelId(a.channelId),d.channelName(a.channelName),d.channelWebAddress("This is your channel web page, now live at <em>"+d.channelName()+".evernym.com</em>"),d.tagline("(sample tagline for "+d.channelName()+")"),d.longDescription("This is the web page for "+d.channelName()+".<br/>To follow "+d.channelName()+', click the "Follow" Button below.'),d.taglineBtnText("Edit"),d.descBtnText("Edit"),d.editing(!1),d.editingTextarea(!1),d.less(!0),d.more(!1),d.moreButton(!1),d.lessButton(!1),"undefined"!=typeof a.channelDescription&&d.tagline(a.channelDescription),"undefined"!=typeof a.longDescription)if(a.longDescription.length>12*truncatedTextScreen()){var b=($.trim(a.longDescription).substring(0,7*truncatedTextScreen()).split(" ").slice(0,-1).join(" ")+"...").replace(/\n/g,"<br/>");d.longDescription(b),d.moreText(a.longDescription.replace(/\n/g,"<br/>")),d.moreButton(!0)}else d.longDescription(a.longDescription.replace(/\n/g,"<br/>"))},d.editTagline=function(a){d.clickType(a),"Save"==d.taglineBtnText()?d.shortDescriptionCommand():(d.editing(!0),d.taglineBtnText("Save"))},d.editDescription=function(a){d.clickType(a),"Save"==d.descBtnText()?d.longDescriptionCommand():(d.longDescription(d.longDescription().replace(/<br\s*[\/]?>/gi,"\n")),d.editingTextarea(!0),d.descBtnText("Save"),d.less(!1),d.more(!1))},d.shortDescriptionCommand=function(){if(""==d.tagline()||"undefined"==typeof d.tagline()){var b={type:"toast-error",text:"Please enter channel tagline"};showToast(b)}else{var e={id:d.channelId(),description:d.tagline()};$.mobile.showPageLoadingMsg("a","Modifying Channel "),ES.channelService.modifyChannel(e,{success:a,error:c})}},d.longDescriptionCommand=function(){if(""==d.longDescription()||"undefined"==typeof d.longDescription()){var b={type:"toast-error",text:"Please enter long description"};showToast(b)}else{var e={id:d.channelId(),longDescription:d.longDescription()};$.mobile.showPageLoadingMsg("a","Modifying Channel "),ES.channelService.modifyChannel(e,{success:a,error:c})}},d.comingSoon=function(){headerViewModel.comingSoon()},d.showMore=function(){d.less(!1),d.more(!0),d.moreButton(!1),d.lessButton(!0)},d.showLess=function(){d.less(!0),d.more(!1),d.moreButton(!0),d.lessButton(!1)},d.showPreview=function(){d.sectionOne(!1),d.sectionTwo(!0)},d.okCommand=function(){"plusMenuView"==backNavView.pop()?("channelsIOwnView"==backNavView[backNavView.length-1]&&(backNavText.pop(),backNavView.pop()),goToView("channelsIOwnView")):goToView("channelSettingsView")},d.exitPreview=function(){goToView("channelIntroView")}}function ChannelMainViewModel(){function a(a){if($.mobile.hidePageLoadingMsg(),e.channelName(a.name),1==a.followers)var b=a.followers+" follower";else var b=a.followers+" followers";e.followerCount(b);var c=[];c.push({channelId:a.id,channelName:a.name,channelDescription:a.description,followerCount:a.followers}),c=c[0],ENYM.ctx.setItem("currentChannelData",JSON.stringify(c)),ENYM.ctx.removeItem("currentChannelId")}function b(a){$.mobile.hidePageLoadingMsg();for(var b=0;b<a.message.length;b++){var c="icon-"+a.message[b].escLevelId.toLowerCase(),d="<strong class="+c+"></strong><span>"+a.message[b].text+"</span>";if("N"==a.message[b].escLevelId)var d="<span>"+a.message[b].text+"</span>",f="NORMAL";else if("F"==a.message[b].escLevelId)var f="FAST";
else if("R"==a.message[b].escLevelId)var f="REMIND";else if("C"==a.message[b].escLevelId)var f="CHASE";else if("H"==a.message[b].escLevelId)var f="HOUND";else if("E"==a.message[b].escLevelId)var f="EMERGENCY";else var c="",f="";if("REQUEST_ACKNOWLEDGEMENT"==a.message[b].type){var g=Math.round(Math.ceil(100*a.message[b].acks)/(a.message[b].acks+a.message[b].noacks))+"%";if(0==a.message[b].acks)var h="0%. . . no responses yet",i="",j="zero-percentage",g="",k="";else if("100%"==g)var l=a.message[b].acks,m=l+a.message[b].noacks,n=1==m?" Follower":" Followers",h=l+"/"+m+n+" got it - "+g,i="",j="",k="";else if(a.message[b].acks)var h=a.message[b].acks+' Got it <span class="percentage-text">('+g+")</span>",o=1==a.message[b].noacks?"  Hasn't":" Haven't",i=a.message[b].noacks+" "+o,j="",k="";else var h="",j="norequested",g="100%",k="No followers to acknowledge iGi!",i=""}else var h="",j="norequested",g="100%",k='No iGi requested<em class="norequestedican"></em>',i="";if(1==a.message[b].replies)var p=a.message[b].replies+" Reply";else var p=a.message[b].replies+" Replies";e.broadcasts.push({messageId:a.message[b].id,sensitivity:c,sensitivityText:f,broadcast:d,broadcastFull:a.message[b].text,time:formatDate(a.message[b].created,"short","main"),created:a.message[b].created,escUntil:a.message[b].escUntil,iGi:h,percentageText:k,percentage:g,percentageClass:j,noiGi:i,replies:p,acks:a.message[b].acks,noacks:a.message[b].noacks,type:a.message[b].type})}}function c(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}function d(a){$.mobile.hidePageLoadingMsg();for(var b=0;b<a.message.length;b++){if(a.message[b].text.length>truncatedTextScreen())var c="<em>"+a.message[b].senderFirstname+" "+a.message[b].senderLastname+": </em>"+$.trim(a.message[b].text).substring(0,truncatedTextScreen()).split(" ").slice(0,-1).join(" ")+"...",d=$.trim(a.message[b].text).substring(0,2*truncatedTextScreen()).split(" ").slice(0,-1).join(" ")+"...";else var c="<em>"+a.message[b].senderFirstname+" "+a.message[b].senderLastname+": </em>"+a.message[b].text,d=a.message[b].text;var c=[];c.push({replyId:a.message[b].id,senderSubscriberId:a.message[b].senderSubscriberId,responseToMsgId:a.message[b].responseToMsgId,created:a.message[b].created,replyTime:formatDate(a.message[b].created,"short","main"),replyLess:d.replace(/\n/g,"<br/>"),replyFull:a.message[b].text.replace(/\n/g,"<br/>"),senderFirstname:a.message[b].senderFirstname,senderLastname:a.message[b].senderLastname,replyToReply:a.message[b].replies}),c=c[0],ENYM.ctx.setItem("currentReplyData",JSON.stringify(c))}viewNavigate("Main","channelMainView","replyDetailView"),replyDetailViewModel.showMore()}function c(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var e=this;e.template="channelMainView",e.viewid="V-46",e.viewname="Main",e.displayname="Channel Main",e.inputObs=["channelId","channelName","followerCount"],e.defineObservables(),e.broadcasts=ko.observableArray([]),e.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(b||ENYM.ctx.getItem("currentChannelId")){if(addExternalMarkup(e.template),e.broadcasts.removeAll(),ENYM.ctx.removeItem("currentMessageData"),e.broadcasts.removeAll(),ENYM.ctx.getItem("currentChannelId"))return e.channelId(ENYM.ctx.getItem("currentChannelId")),ES.channelService.getChannel(e.channelId(),{success:a,error:c}).then(e.getMessagesCommand());if(e.channelId(b.channelId),e.channelName(b.channelName),1==b.followerCount)var d=b.followerCount+" follower";else var d=b.followerCount+" followers";e.followerCount(d),e.getMessagesCommand()}else goToView("channelsIOwnView")},e.getMessagesCommand=function(){return $.mobile.showPageLoadingMsg("a","Loading Messages"),ES.messageService.getChannelMessages(e.channelId(),void 0,{success:b,error:c})},e.singleMessage=function(a){ENYM.ctx.setItem("currentMessageData",JSON.stringify(a)),viewNavigate("Main","channelMainView","singleMessageView")},e.showWhoGotIt=function(a){if(0==a.acks){var b={type:"toast-info",text:"No iGi's received yet"};showToast(b)}else ENYM.ctx.setItem("currentMessageData",JSON.stringify(a)),viewNavigate("Main","channelMainView","whoGotItView")},e.iGiPercentage=function(a){ENYM.ctx.setItem("currentMessageData",JSON.stringify(a)),""!=a.percentageClass?viewNavigate("Main","channelMainView","singleMessageView"):viewNavigate("Main","channelMainView","whoGotItView")},e.showNotGotIt=function(a){ENYM.ctx.setItem("currentMessageData",JSON.stringify(a)),viewNavigate("Main","channelMainView","notGotItView")},e.showReplies=function(a){if("0 Replies"==a.replies){var b={type:"toast-info",text:"No replies to display"};showToast(b)}else{if("1 Reply"==a.replies)return ENYM.ctx.setItem("currentMessageData",JSON.stringify(a)),$.mobile.showPageLoadingMsg("a","Loading Message reply"),ES.messageService.getChannelMessages(e.channelId(),{replyto:a.messageId},{success:d,error:c});ENYM.ctx.setItem("currentMessageData",JSON.stringify(a)),viewNavigate("Main","channelMainView","singleMessageRepliesView")}}}function ChannelMenuViewModel(){var a=this;a.template="channelMenuView",a.viewid="V-04",a.viewname="ChannelMenu",a.displayname="Channel Menu",a.activate=function(){},a.menuHide=function(){backNavText.pop(),backNavView.pop(),goToView(a.previousViewID())}}function ChannelMessagesViewModel(){var a=this;a.template="channelMessagesView",a.viewid="V-55",a.viewname="Broadcast Msg",a.displayname="Channel Messages",a.hasfooter=!0,a.inputObs=["title","description","channelid"],a.defineObservables(),a.channelMessages=ko.observableArray([]);var b;a.activate=function(){ENYM.ctx.removeItem("overlayCurrentChannel"),b=JSON.parse(ENYM.ctx.getItem("currentChannel")),b?(addExternalMarkup(a.template),a.channelid(b.id),ENYM.ctx.removeItem("currentChannelMessage"),$.mobile.showPageLoadingMsg("a","Loading Channel Messages"),a.channelMessages.removeAll(),a.gotChannel(b)):goToView("channelsFollowingListView")},a.actionFollowChannelCommand=function(){viewNavigate("Broadcast Msg","channelMessagesView","channelViewUnfollow")},a.iGiAckMessage=function(a){var b=$("#"+a.messageId).attr("class");if("igibutton igisent"!=a.iGiClass&&"igibutton igisent"!=b){var c={success:function(){$("#"+a.messageId).parent().removeClass("read-n").addClass("read-i"),$("#"+a.messageId).addClass("igisent"),a.ack="Y";var b={type:"",text:"iGi sent!"};showToast(b)},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};return $.mobile.showPageLoadingMsg("a","Sending iGi request!"),ES.messageService.acknowledgeMsg(a.messageId,c)}var d={type:"toast-info",text:"iGi has already been sent!"};showToast(d),$.isEmptyObject(ES.systemService.MnsCacheData)||ES.systemService.adjMnsCount(-1);var e=[];e=JSON.parse(ENYM.ctx.getItem("enymNotifications")),e.length>0&&($.each(e,function(b,c){"undefined"!=typeof c&&c.msgId==a.messageId&&e.splice(b,1)}),setTimeout(function(){showNewMessagesCount(ES.systemService.MnsCacheData.data.unreadCount),overlayViewModel.showNewMessagesOverlay()},1e3),ENYM.ctx.setItem("enymNotifications",JSON.stringify(e)))},a.showSingleMessage=function(a){ENYM.ctx.setItem("currentChannelMessage",JSON.stringify(a)),viewNavigate("Broadcast Msg","channelMessagesView","channelSingleMessagesView")},a.gotChannel=function(b){$.mobile.hidePageLoadingMsg(),a.title(b.name),a.description(b.description);var c={success:function(b){a.channelMessages.removeAll();truncatedTextScreen();$.each(b.messagealert,function(b,c){var d=formatDate(c.created,"short","follow");if(c.escLevelId&&"N"!=c.escLevelId&&"F"!=c.escLevelId){var e=c.escLevelId.toLowerCase().trim();e="iconchannels icon-"+e;var f="msg-icon"}else if("N"==c.escLevelId||"F"==c.escLevelId){e="";var f="onlymsg"}else e="iconchannels icon-d";var g=c.text;if("Y"==c.ackRequested&&"N"==c.acknowledged&&"N"==c.dismissed)var h="igibutton",f="igi-msg";else if("Y"==c.acknowledged&&"N"==c.dismissed)var h="igibutton igisent",f="igi-msg";else var h="";if(""!=h&&""!=e)var f="";var i="read-"+c.read.toLowerCase();a.channelMessages.push({readClass:i,read:c.read,ackRequested:c.ackRequested,dismissed:c.dismissed,iGiClass:h,messageType:f,messageId:c.msgId,ack:c.acknowledged,messageCreated:d,messageShortText:g,messageText:c.text,messageClass:e,messageID:c.channelId,messageSender:c.subscriberId,messageCreatedOriginal:c.created})})},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};return ES.messageService.getChannelMessagesForFollower(a.channelid(),{limit:1e4},c)}}function ChannelNewViewModel(){function a(a){$.mobile.hidePageLoadingMsg();var b=[];b.push({channelId:a.id,channelName:a.name,channelDescription:a.description,longDescription:a.longDescription,followerCount:a.followers}),b=b[0],ENYM.ctx.setItem("currentChannelData",JSON.stringify(b));var c={type:"",text:"Channel created"};showToast(c)}function b(b){b?(d.channelClass("validationerror"),d.errorNewChannel("<span>Sorry,</span> This channel name has already been taken")):($.mobile.showPageLoadingMsg("a","Creating Channel "),ES.channelService.createChannel({name:d.newChannel()},{success:a,error:c}),d.sectionOne(!1),d.sectionTwo(!0),d.channelName(d.newChannel()+" is now live."),d.channelWebAddress(d.newChannel()+".evernym.com")),$(".channelvisiting strong").bind("copy",function(){return!1})}function c(a,b,c){$.mobile.hidePageLoadingMsg(),goToView("channelNameView"),d.sectionOne(!0),d.sectionTwo(!1),d.message(""),d.channelClass("validationerror"),d.errorNewChannel("<span>Sorry,</span> "+c.message)}var d=this;d.template="channelNewView",d.viewid="V-13",d.viewname="New Chan",d.displayname="Create a channel",d.sectionOne=ko.observable(!0),d.sectionTwo=ko.observable(!1),d.inputObs=["newChannel","message","channelName","channelWebAddress"],d.errorObs=["errorNewChannel","channelClass"],d.defineObservables(),d.activate=function(){addExternalMarkup(d.template),d.sectionOne(!0),d.sectionTwo(!1),$("input").keyup(function(){d.clearErrorObs()})},$(document).keyup(function(a){13==a.keyCode&&"channelNewView"==$.mobile.activePage.attr("id")&&d.createChannelCommand()}),d.createChannelCommand=function(){var a=/^[a-zA-Z0-9]+$/;""==d.newChannel()?(d.channelClass("validationerror"),d.errorNewChannel("<span>Sorry,</span> Please enter channel name")):a.test(d.newChannel())?d.newChannel().length<5||d.newChannel().length>25?(d.channelClass("validationerror"),d.errorNewChannel("<span>Sorry,</span> Name of min. 5 and max. 25 characters")):($.mobile.showPageLoadingMsg("a","Checking channel name availability"),ES.loginService.checkName(d.newChannel(),{success:b,error:c})):(d.channelClass("validationerror"),d.errorNewChannel("<span>Sorry,</span> Letters and numbers only, no spaces."))},d.goToNext=function(){sendMessageViewModel.channels.removeAll(),goToView("channelIntroView")}}function ChannelSettingsViewModel(){function a(a){""==a&&(c.yesShare("yesbutton"),c.noShare("nobutton"))}function b(a){c.newFollowers("undefined"==typeof a.NEW_FLWR_NOTIF?"Off":"F"==a.NEW_FLWR_NOTIF?"Fast":"Normal"),c.notifyClass("bluebtn"),ENYM.ctx.removeItem("followersNotify"),ENYM.ctx.setItem("followersNotify",JSON.stringify(a.NEW_FLWR_NOTIF))}var c=this;c.template="channelSettingsView",c.viewid="V-16",c.viewname="Settings",c.displayname="Channel Settings",c.inputObs=["channelId","channelName","shortDescription","yesShare","noShare","notifyClass","newFollowers"],c.defineObservables(),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData"));d?(addExternalMarkup(c.template),c.channelId(d.channelId),c.channelName(d.channelName),c.shortDescription(d.channelDescription),c.yesShare("nobutton"),c.noShare("yesbutton"),ENYM.ctx.removeItem("channelOwner"),ES.channelService.getFollowerReq(c.channelId()).then(a),ES.channelService.getChnlSettings(c.channelId()).then(b)):goToView("channelsIOwnView")},c.comingSoon=function(){headerViewModel.comingSoon()},c.requiredYes=function(a){if("Share"==a){c.yesShare("nobutton"),c.noShare("yesbutton");var b={type:"",text:"First/Last name now required"};showToast(b),ES.channelService.addFollowerReq(c.channelId(),"SHARE_NAME")}else"Notify"==a&&viewNavigate("Settings","channelSettingsView","newFollowersSettingsView")},c.requiredNo=function(){c.yesShare("yesbutton"),c.noShare("nobutton");var a={type:"",text:"First/Last name no longer required"};showToast(a),ES.channelService.removeFollowerReq(c.channelId(),"SHARE_NAME")}}function ChannelSingleMessagesViewModel(){var a=this;a.template="channelSingleMessagesView",a.viewid="V-55",a.viewname="Message details",a.displayname="Channel Single Message",a.hasfooter=!0,a.inputObs=["title","description","channelid","channelIcon","messageId","ack","messageCreated","messageClass","messageText","moreText","activeClass","dismissClass"],a.defineObservables(),a.less=ko.observable(!0),a.more=ko.observable(!1),a.moreButton=ko.observable(!1),a.lessButton=ko.observable(!1),a.iGiButton=ko.observable(!1),a.dismissButton=ko.observable(!0),a.setting=ko.observable(!1),a.activate=function(){if(addExternalMarkup(a.template),a.channelIcon(""),a.setting(!1),a.less(!0),a.more(!1),a.moreButton(!1),a.lessButton(!1),a.iGiButton(!1),a.dismissButton(!0),a.activeClass("igimsgdetail"),a.dismissClass(""),ENYM.ctx.getItem("overlayCurrentChannel")){var b={success:function(b){a.channelIcon("channel4 sky-blue"),a.title(b.name),a.description(b.description),a.setting(!0)},error:function(b,c){"404"==c&&(a.channelIcon("evernymicon"),a.title("Evernym, Inc."),a.description("System Notifications"),a.setting(!1))}},c=JSON.parse(ENYM.ctx.getItem("overlayCurrentChannel"));if(a.channelid(c.channelId),a.messageId(c.msgId),a.ack(c.ack),a.messageCreated(c.createdLong),a.messageClass(c.escLevelId),a.moreText(c.fullText),c.fullText.length>6*truncatedTextScreen()){var d=$.trim(c.fullText).substring(0,6*truncatedTextScreen()).split(" ").slice(0,-1).join(" ")+"...";a.messageText(d),a.less(!0),a.moreButton(!0)}else a.messageText(c.fullText);return""!=c.iGiClass&&("N"==c.acknowledged?(a.iGiButton(!0),a.activeClass("igimsgdetail")):(a.iGiButton(!0),a.dismissButton(!1),a.activeClass("igisentimg"))),""==a.messageClass()||"iconchannels icon-d"==a.messageClass()?a.dismissButton(!1):"Y"==c.dismissed&&(a.iGiButton(!1),a.dismissClass("active")),"N"==c.read&&"N"==c.acknowledged?ES.channelService.getChannel(c.channelId,b).then(a.readMessageUpdateBadge(c.msgId,c.read,c.ackRequested)):ES.channelService.getChannel(c.channelId,b)}var c=JSON.parse(ENYM.ctx.getItem("currentChannel")),e=JSON.parse(ENYM.ctx.getItem("currentChannelMessage"));if(a.channelIcon("channel4 sky-blue"),a.title(c.name),a.channelid(c.channelId),a.description(c.description),a.setting(!0),e){if(a.messageId(e.messageId),a.ack(e.ack),a.messageCreated(formatDate(e.messageCreatedOriginal,"long")),a.messageClass(e.messageClass),a.moreText(e.messageText),e.messageText.length>6*truncatedTextScreen()){var d=$.trim(e.messageText).substring(0,6*truncatedTextScreen()).split(" ").slice(0,-1).join(" ")+"...";a.messageText(d),a.less(!0),a.moreButton(!0)}else a.messageText(e.messageText);a.readMessageUpdateBadge(e.messageId,e.read,e.ackRequested),""!=e.iGiClass&&("N"==e.ack?(a.iGiButton(!0),a.activeClass("igimsgdetail")):(a.iGiButton(!0),a.dismissButton(!1),a.activeClass("igisentimg"))),""==a.messageClass()||"iconchannels icon-d"==a.messageClass()?a.dismissButton(!1):"Y"==e.dismissed&&(a.iGiButton(!1),a.dismissClass("active"))}},a.readMessageUpdateBadge=function(b,c,d){$(".active-overlay").html("");var e={success:function(){},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};if("N"==c&&"N"==d){$.isEmptyObject(ES.systemService.MnsCacheData)||ES.systemService.adjMnsCount(-1);var f=[];f=JSON.parse(ENYM.ctx.getItem("enymNotifications")),f.length>0&&($.each(f,function(a,c){"undefined"!=typeof c&&c.msgId==b&&f.splice(a,1)}),ENYM.ctx.removeItem("enymNotifications"),ENYM.ctx.setItem("enymNotifications",JSON.stringify(f)))}else if("N"==c){var f=[];f=JSON.parse(ENYM.ctx.getItem("enymNotifications")),f.length>0&&($.each(f,function(a,c){"undefined"!=typeof c&&c.msgId==b&&(c.read="Y")}),ENYM.ctx.removeItem("enymNotifications"),ENYM.ctx.setItem("enymNotifications",JSON.stringify(f)))}return ES.messageService.readMsg(b,e).then(a.updateMessages)},a.updateMessages=function(a){a&&a.unreadCount>0?headerViewModel.newMessageCount(a.unreadCount):(headerViewModel.newMessageCount(),headerViewModel.newMessageClass(""))},a.showMore=function(){a.less(!1),a.more(!0),a.moreButton(!1),a.lessButton(!0)},a.showLess=function(){a.less(!0),a.more(!1),a.moreButton(!0),a.lessButton(!1)},a.iGiAck=function(){var b={success:function(){a.iGiButton(!0),a.dismissButton(!1),a.activeClass("igisentimg"),backNavText.pop();var b=backNavView.pop(),c={redirect:b,type:"",text:"iGi sent!"};showToast(c),goToView(b)},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};if("Y"!=a.ack()&&"igisentimg"!=a.activeClass()){$.mobile.showPageLoadingMsg("a","Sending iGi request!"),$.isEmptyObject(ES.systemService.MnsCacheData)||ES.systemService.adjMnsCount(-1);var c=[];return c=JSON.parse(ENYM.ctx.getItem("enymNotifications")),c.length>0&&($.each(c,function(b,d){"undefined"!=typeof d&&d.msgId==a.messageId()&&c.splice(b,1)}),setTimeout(function(){showNewMessagesCount(ES.systemService.MnsCacheData.data.unreadCount),overlayViewModel.showNewMessagesOverlay()},1e3),ENYM.ctx.setItem("enymNotifications",JSON.stringify(c))),ES.messageService.acknowledgeMsg(a.messageId(),b)}var d={type:"toast-info",text:"iGi has already been sent!"};showToast(d)},a.dismissEscalation=function(){var b={success:function(){a.iGiButton(!1),a.dismissButton(!0),a.dismissClass("active");var b={type:"",text:"Escalation is now halted for this message. No further delivery attempts will be made."};showToast(b)},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};if("active"!=a.dismissClass())return $.mobile.showPageLoadingMsg("a","Sending Dismiss escalation request !"),ES.messageService.dismissMsg(a.messageId(),b);var c={type:"toast-info",text:"Escalation is already halted !"};showToast(c)},a.comingSoon=function(){headerViewModel.comingSoon()}}function ChannelViewModel(){function a(a){if($.mobile.hidePageLoadingMsg(),ENYM.ctx.setItem("currentChannel",JSON.stringify(a)),g.title(a.name),g.description(a.description),"undefined"!=typeof a.longDescription)if(a.longDescription.length>12*truncatedTextScreen()){var b=($.trim(a.longDescription).substring(0,7*truncatedTextScreen()).split(" ").slice(0,-1).join(" ")+"...").replace(/\n/g,"<br/>");g.longdescription(b),g.moreText(a.longDescription.replace(/\n/g,"<br/>")),g.moreButton(!0)}else g.longdescription(a.longDescription.replace(/\n/g,"<br/>"));else(""==a.longDescription||"undefined"==typeof a.longDescription)&&g.longdescription("This is the web page for "+g.title()+". To follow "+g.title()+", click the Follow button below.");if(g.channelId(a.id),"F"==a.relationship){g.channelAction(!1),g.settings(!0);var c={redirect:"channelMessagesView",type:"",text:"You already follow the channel '"+g.title()+"'"};showToast(c),viewNavigate("Channels","channelsFollowingListView","channelMessagesView")}else if("O"==a.relationship){if(""==a.longDescription||"undefined"==typeof a.longDescription){var d=JSON.parse(ENYM.ctx.getItem("account"));g.longdescription("This is the web page for "+g.title()+". To follow "+g.title()+", click the Follow button below.<br/><br/>Hello, "+d.firstname+"!  Your channel needs a better description than what we came up with for you, so go ahead and type that in this box.<br/>Make sure to include an invitation for visitors to click the Follow button in order to get your channel's broadcasts.")}ENYM.ctx.setItem("channelOwner","yes");var e=[];e.push({channelId:a.id,channelName:a.name,channelDescription:a.description,longDescription:a.longDescription,followerCount:a.followers}),e=e[0],ENYM.ctx.setItem("currentChannelData",JSON.stringify(e)),g.settings(!0)}else g.settings(!1),g.channelAction(!0)}function b(){$.mobile.hidePageLoadingMsg(),ENYM.ctx.removeItem("action");var a={redirect:"channelsFollowingListView",type:"",text:"Now following "+g.title()};showToast(a),goToView("channelsFollowingListView")}function c(a,b,c){$.mobile.hidePageLoadingMsg();var d=ES.evernymService.getAccessToken();if(""==d||null==d){var e={redirect:"loginView",type:"toast-error",text:c.message};showToast(e),goToView("loginView")}else{var e={redirect:"homeView",type:"toast-error",text:c.message};showToast(e),goToView("homeView")}}function d(a,b,c){if($.mobile.hidePageLoadingMsg(),100601==c.code){var d={type:"toast-error",text:c.message};showToast(d)}else if(isBadLogin(c.code))ENYM.ctx.setItem("action","follow_channel"),$.mobile.changePage("#"+loginViewModel.template);else{var d={type:"toast-error",text:c.message};showToast(d)}}function e(a){if(""!=a){var b={follow_channel:"Y",SHARE_NAME:"Y"};ENYM.ctx.setItem("action",JSON.stringify(b)),goToView("nameRequiredView")}else g.followChannelCommand()}function f(a){if(""!=a)var b={follow_channel:"Y",SHARE_NAME:"Y"};else var b={follow_channel:"Y",SHARE_NAME:"N"};ENYM.ctx.setItem("action",JSON.stringify(b)),goToView(""==ENYM.ctx.getItem("evernym")||null==ENYM.ctx.getItem("evernym")?"signupStepFirstView":"loginView")}var g=this;g.requiresAuth=!1,g.template="channelView",g.viewid="V-18",g.viewname="Landing Page",g.displayname="Channel Landing Page",g.hasfooter=ko.observable(!1),g.hasheader=ko.observable(!1),g.settings=ko.observable(!0),g.inputObs=["title","channelAction","channelId","description","longdescription","moreText","loggedIn"],g.defineObservables(),g.less=ko.observable(!0),g.more=ko.observable(!1),g.moreButton=ko.observable(!1),g.lessButton=ko.observable(!1),g.activate=function(){var b=ES.evernymService.getAccessToken();if(""==b||null==b?(g.loggedIn(""),g.hasheader(!1),g.hasfooter(!1)):(g.loggedIn("Y"),addExternalMarkup(g.template),g.hasheader(!0),g.hasfooter(!0)),jQuery.mobile.path.get().split("?")[1])g.channelId(jQuery.mobile.path.get().split("?")[1].replace("id=",""));else{var d=JSON.parse(ENYM.ctx.getItem("currentChannel"));g.channelId(d.id)}return g.accountName(ENYM.ctx.getItem("accountName")),g.channelAction(!0),ENYM.ctx.removeItem("channelOwner"),g.less(!0),g.more(!1),g.moreButton(!1),g.lessButton(!1),$.mobile.showPageLoadingMsg("a","Loading The Channel"),ES.channelService.getChannel(g.channelId(),{success:a,error:c})},g.channelSettings=function(){"yes"==ENYM.ctx.getItem("channelOwner")?viewNavigate("Landing Page","channelView?id="+g.title(),"channelSettingsView"):viewNavigate("Landing Page","channelView?id="+g.title(),"channelViewUnfollow")},g.editLongDescription=function(){"yes"==ENYM.ctx.getItem("channelOwner")&&viewNavigate("Landing Page","channelView?id="+g.title(),"editLongDescriptionView")},g.actionFollowChannelCommand=function(){if("Y"!=g.loggedIn())return ES.channelService.getFollowerReq(g.channelId()).then(f);var a=JSON.parse(ENYM.ctx.getItem("account"));if("yes"==ENYM.ctx.getItem("channelOwner")){var b={type:"toast-info",text:"See Channel Settings to receive your own broadcasts."};showToast(b)}else{if(!(a&&a.firstname&&a.lastname))return ES.channelService.getFollowerReq(g.channelId()).then(e);g.followChannelCommand()}},g.followChannelCommand=function(){return $.mobile.showPageLoadingMsg("a","Requesting to Follow Channel"),ES.channelService.followChannel(g.channelId(),{success:b,error:d})},g.showMore=function(){g.less(!1),g.more(!0),g.moreButton(!1),g.lessButton(!0)},g.showLess=function(){g.less(!0),g.more(!1),g.moreButton(!0),g.lessButton(!1)}}function ChannelViewUnfollowModel(){function a(){for($.mobile.hidePageLoadingMsg();"channelsFollowingListView"!=backNavView[backNavView.length-1];)backNavText.pop(),backNavView.pop();"channelsFollowingListView"==backNavView[backNavView.length-1]&&(backNavText.pop(),backNavView.pop());var a={redirect:"channelsFollowingListView",type:"",text:"No longer following "+b.title()};showToast(a),ENYM.ctx.removeItem("currentChannel"),goToView("channelsFollowingListView")}var b=this;b.template="channelViewUnfollow",b.viewid="V-16",b.viewname="Channel Unfollow",b.displayname="Channel Unfollow",b.inputObs=["title","description","channelid"],b.defineObservables(),b.hasfooter=ko.observable(!0),b.activate=function(){addExternalMarkup(b.template);var a=JSON.parse(ENYM.ctx.getItem("currentChannel"));b.channelid(a.id),b.title(a.name),b.description(a.description),$.mobile.showPageLoadingMsg("a","Loading The Channel")},b.unfollowChannelCommand=function(){$.mobile.showPageLoadingMsg("a","Requesting to Unfollow Channel");var c={success:function(){},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};return ES.channelService.unfollowChannel(b.channelid(),c).then(a)},b.comingSoon=function(){headerViewModel.comingSoon()}}function ChannelsFollowingListViewModel(){function a(a){$.mobile.hidePageLoadingMsg(),a.channel?($.each(a.channel,function(a,b){"undefined"==typeof b.description&&(b.description="")}),c.channels(a.channel),c.noFollow(!0)):goToView("followChannelView")}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="channelsFollowingListView",c.viewid="V-30",c.viewname="Channels",c.displayname="Channels I Follow",c.channels=ko.observableArray([]),c.shown=!1,c.noFollow=ko.observable(!1),c.activate=function(){return c.noFollow(!1),c.shown||(ENYM.ctx.removeItem("currentChannel"),ENYM.ctx.removeItem("overlayCurrentChannel")),addExternalMarkup(c.template),c.channels.removeAll(),c.channels()&&c.channels().length&&c.channels.removeAll(),$.mobile.showPageLoadingMsg("a","Loading Channels"),ES.channelService.listFollowingChannels().then(a,b)},c.channelViewUnfollow=function(a){var b=JSON.stringify(a);ENYM.ctx.setItem("currentChannel",b),viewNavigate("Channels","channelsFollowingListView","channelViewUnfollow")},c.actionFollowChannelCommand=function(a){ENYM.ctx.setItem("currentChannel",JSON.stringify(a)),viewNavigate("Channels","channelsFollowingListView","channelMessagesView")}}function ChannelsIOwnViewModel(){function a(a){if($.mobile.hidePageLoadingMsg(),0==a.channel.length)c.sectionOne(!0);else{c.sectionTwo(!0);for(var b=0;b<a.channel.length;b++){if(1==a.channel[b].followers)var d=a.channel[b].followers+" follower",e=!1;else if(0==a.channel[b].followers)var d=a.channel[b].followers+" followers",e=!0;else var d=a.channel[b].followers+" followers",e=!1;c.channels.push({channelId:a.channel[b].id,channelName:a.channel[b].name,channelDescription:a.channel[b].description,longDescription:a.channel[b].longDescription,followers:d,followerCount:a.channel[b].followers,addFollower:e})}}}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="channelsIOwnView",c.viewid="V-19",c.viewname="Channels",c.displayname="Channels I Own",c.sectionOne=ko.observable(!1),c.sectionTwo=ko.observable(!1),c.addFollower=ko.observable(!1),c.channels=ko.observableArray([]),c.activate=function(){return addExternalMarkup(c.template),c.sectionOne(!1),c.sectionTwo(!1),c.addFollower(!1),c.channels.removeAll(),$.mobile.showPageLoadingMsg("a","Loading Channels"),ES.channelService.listMyChannels({success:a,error:b})},c.channelSettings=function(a){ENYM.ctx.removeItem("currentChannelData"),ENYM.ctx.setItem("currentChannelData",JSON.stringify(a)),viewNavigate("Channels","channelsIOwnView","channelSettingsView")},c.channelMain=function(a){ENYM.ctx.removeItem("currentChannelData"),ENYM.ctx.setItem("currentChannelData",JSON.stringify(a)),viewNavigate("Channels","channelsIOwnView","channelMainView")},c.channelFollowers=function(a){ENYM.ctx.removeItem("currentChannelData"),ENYM.ctx.setItem("currentChannelData",JSON.stringify(a)),viewNavigate("Channels","channelsIOwnView","followersListView")},c.addFollowers=function(a){ENYM.ctx.removeItem("currentChannelData"),ENYM.ctx.setItem("currentChannelData",JSON.stringify(a)),viewNavigate("Channels","channelsIOwnView","addInviteFollowersView")}}function CommethodVerificationViewModel(){function a(){$.mobile.hidePageLoadingMsg(),c.message("Successfully verified")}function b(a,b,d){$.mobile.hidePageLoadingMsg(),c.message(d.message)}var c=this;c.template="commethodVerificationView",c.viewid="V-??",c.viewname="ComMethodVerification",c.displayname="ComMethod Verification",c.message=ko.observable(),c.activate=function(){$.mobile.showPageLoadingMsg("a","Verifying");var c=jQuery.mobile.path.get().split("?")[1].replace("key=","");return ES.commethodService.verification(c,{success:a,error:b})}}function DeclinedFollowersViewModel(){function a(a){$.mobile.hidePageLoadingMsg(),$.each(a.followers,function(a,b){if("D"==b.relationship){var d=!0,e=!1;if("N"==b.managed)var f="normalfollowers",g=!0,e=!0;else var f="provisionalicon noname",g=!1;if("undefined"==typeof b.firstname&&"undefined"==typeof b.lastname)"Y"==b.managed?h=b.comMethods[0].address:(h="",f+=" noname"),d=!1;else if("undefined"==typeof b.firstname)var h=b.lastname;else if("undefined"==typeof b.lastname)var h=b.firstname;else var h=b.firstname+" "+b.lastname;c.followers.push({followerId:b.id,nameClass:f,visibleName:d,followerName:h,accountname:b.accountname,reachable:b.accountname,evernym:g,evernymIcon:e,type:b.managed}),c.declinesCount(c.followers().length)}})}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="declinedFollowersView",c.viewid="V-??",c.viewname="Declined Invites",c.displayname="Declined Invites",c.evernymIcon=ko.observable(!1),c.inputObs=["channelId","channelName","declinesCount"],c.defineObservables(),c.followers=ko.observableArray([]),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData"));return d?(addExternalMarkup(c.template),c.evernymIcon(!1),c.followers.removeAll(),c.declinesCount(""),c.channelId(d.channelId),c.channelName(d.channelName),$.mobile.showPageLoadingMsg("a","Loading Declined Followers"),ES.channelService.getFollowers(c.channelId(),{success:a,error:b})):void goToView("channelsIOwnView")},c.followerDetails=function(a){ENYM.ctx.setItem("currentfollowerData",JSON.stringify(a)),viewNavigate("Declined Invites","declinedFollowersView","followerDetailsView")}}function EditFollowerDetailsViewModel(){function a(){var a={firstname:"",lastname:""};if(""!=b.followerName()){var c=b.followerName().split(" "),d=c[0],e=c[1];""!=d&&(a.firstname=d),"undefined"!=typeof e&&""!=e&&(a.lastname=e)}return a}var b=this;b.template="editFollowerDetailsView",b.viewid="V-35",b.viewname="Edit Follower",b.displayname="Edit Follower Details",b.followerCommethods=ko.observable([]),b.inputObs=["channelName","followerName","emailaddress","smsPhone","followerID","previousEmail","previousPhone"],b.errorObs=["nameClass","errorName","emailClass","errorEmail","errorPhone","phoneClass"],b.defineObservables(),b.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("currentChannelData")),c=JSON.parse(ENYM.ctx.getItem("currentfollowerData"));a?(addExternalMarkup(b.template),b.channelName(a.channelName),b.followerID(c.accountname),1==c.visibleName&&("undefined"!=typeof c.followerName||""!=c.followerName?b.followerName(c.followerName):b.followerName())):goToView("followersListView"),b.followerCommethods([]),""!=c.accountname&&$.when(ES.commethodService.getCommethodsForProvis(c.accountname).then(function(a){$.each(a.commethod,function(a,c){"EMAIL"==c.type?(b.emailaddress(c.address),b.previousEmail(c.address)):(b.smsPhone(c.address),b.previousPhone(c.address))}),b.followerCommethods(a.commethod)})),$("input").keyup(function(){b.clearErrorObs()})},$(document).keyup(function(a){13==a.keyCode&&"editFollowerDetailsView"==$.mobile.activePage.attr("id")&&b.editFollowerDetails()}),b.editFollowerDetails=function(){if(""==b.emailaddress()&&""==b.smsPhone())return b.errorPhone("<span>Sorry, </span> A phone number or email address are required."),b.phoneClass("validationerror"),b.emailClass("validationerror"),!1;if(""==b.smsPhone()){var c=validateEmail(b.emailaddress());if("Error"==c.type)return b.errorEmail(c.text),b.emailClass("validationerror"),!1
}else if(""==b.emailaddress()){var d=validateUSAPhone(b.smsPhone());if("Error"==d.type)return b.errorPhone(d.text),b.phoneClass("validationerror"),!1;b.smsPhone(d.text)}else{var c=validateEmail(b.emailaddress());if("Error"==c.type)return b.errorEmail(c.text),b.emailClass("validationerror"),!1;var d=validateUSAPhone(b.smsPhone());if("Error"==d.type)return b.errorPhone(d.text),b.phoneClass("validationerror"),!1;b.smsPhone(d.text)}$.mobile.showPageLoadingMsg("a","Editing Follower details.");var e=a(),f="Changes saved successfully";(b.previousEmail()!=b.emailaddress()||b.previousPhone()!=b.smsPhone())&&(f="Changes saved, invitation sent"),$.when(ES.loginService.accountModifyOther(b.followerID(),e)).then(function(){if(""!=b.emailaddress()||""!=b.smsPhone())if(b.followerCommethods().length>0){var a=!1,c=!1;$.each(b.followerCommethods(),function(d,e){"EMAIL"==e.type&&(e.address!=b.emailaddress()&&$.when(ES.commethodService.deleteCommethodForProvis(b.followerID(),e.id).then(function(){ES.commethodService.addCommethodForProvis(b.followerID(),{type:"EMAIL",address:b.emailaddress()})})),a=!0),"TEXT"==e.type&&(e.address!=b.smsPhone()&&$.when(ES.commethodService.deleteCommethodForProvis(b.followerID(),e.id).then(function(){ES.commethodService.addCommethodForProvis(b.followerID(),{type:"TEXT",address:b.smsPhone()})})),c=!0)}),""!=b.emailaddress()&&0==a&&ES.commethodService.addCommethodForProvis(b.followerID(),{type:"EMAIL",address:b.emailaddress()}),""!=b.smsPhone()&&0==c&&ES.commethodService.addCommethodForProvis(b.followerID(),{type:"TEXT",address:b.smsPhone()})}else""!=b.emailaddress()&&ES.commethodService.addCommethodForProvis(b.followerID(),{type:"EMAIL",address:b.emailaddress()}),""!=b.smsPhone()&&ES.commethodService.addCommethodForProvis(b.followerID(),{type:"TEXT",address:b.smsPhone()})});var g={redirect:"followersListView",type:"",text:f};showToast(g),viewNavigate("Channels","channelsIOwnView","followersListView")}}function EditLongDescriptionViewModel(){function a(){$.mobile.showPageLoadingMsg("a","Loading channel Infomation"),ES.channelService.getChannel(d.channelId(),{success:b,error:c})}function b(a){var b=[];b.push({channelId:a.id,channelName:a.name,channelDescription:a.description,longDescription:a.longDescription,followerCount:a.followers}),b=b[0],ENYM.ctx.setItem("currentChannelData",JSON.stringify(b));var c={redirect:d.previousViewID(),type:"",text:"Description changed"};showToast(c),popBackNav()}function c(a,b,c){$.mobile.hidePageLoadingMsg(),d.errorMessage(!0),d.errorChannel("<span>Sorry,</span> "+c.message)}var d=this;d.template="editLongDescriptionView",d.viewid="V-67",d.viewname="Edit Long Desc",d.displayname="Edit Long Desc",d.inputObs=["channelId","channelName","longDescription","errorChannel","notification"],d.defineObservables(),d.errorMessage=ko.observable(!1),d.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));a?(addExternalMarkup(d.template),d.channelId(a.channelId),d.channelName(a.channelName),d.longDescription(a.longDescription),$("textarea").keyup(function(){d.errorMessage(!1),d.errorChannel("")})):goToView("channelsIOwnView")},$(document).keyup(function(a){13==a.keyCode&&"TEXTAREA"!=a.target.nodeName&&"editLongDescriptionView"==$.mobile.activePage.attr("id")&&d.longDescriptionCommand()}),d.longDescriptionCommand=function(){if(""==d.longDescription()||"undefined"==typeof d.longDescription())d.errorMessage(!0),d.errorChannel("<span>Sorry,</span> Please enter long description");else{var b={id:d.channelId(),longDescription:d.longDescription()};$.mobile.showPageLoadingMsg("a","Modifying Channel "),ES.channelService.modifyChannel(b,{success:a,error:c})}}}function EditNameViewModel(){function a(){return{firstname:d.firstname(),lastname:d.lastname()}}function b(){$.mobile.hidePageLoadingMsg();var a=[];a.push({accountname:d.accountName(),firstname:d.firstname(),lastname:d.lastname()}),a=a[0],ENYM.ctx.setItem("account",JSON.stringify(a));var b={redirect:"userSettingsView",type:"",text:"Name updated successfully !"};showToast(b),backNavText.pop(),backNavView.pop(),goToView("userSettingsView")}function c(a,b,c){$.mobile.hidePageLoadingMsg(),d.firstnameClass("validationerror"),d.lastnameClass("validationerror"),d.errorFirstLastName("<span>Sorry,</span> "+c.message)}var d=this;d.template="editNameView",d.viewid="V-11",d.viewname="Edit Name",d.displayname="Edit Name",d.inputObs=["firstname","lastname"],d.errorObs=["errorFirstName","errorFirstLastName","firstnameClass","lastnameClass"],d.defineObservables(),d.activate=function(){if(addExternalMarkup(d.template),$("input").keyup(function(){d.clearErrorObs()}),ENYM.ctx.getItem("account")){var a=JSON.parse(ENYM.ctx.getItem("account"));d.firstname(a.firstname),d.lastname(a.lastname)}},$(document).keyup(function(a){13==a.keyCode&&"editNameView"==$.mobile.activePage.attr("id")&&d.editNameCommand()}),d.editNameCommand=function(){if(""==d.firstname())d.firstnameClass("validationerror"),d.errorFirstName("<span>Sorry,</span> Please enter first name");else if(d.firstname().length>20)d.firstnameClass("validationerror"),d.errorFirstName("<span>Sorry,</span> Please enter name of max. 20 characters");else if(""==d.lastname())d.lastnameClass("validationerror"),d.errorFirstLastName("<span>Sorry,</span> Last name cannot be left empty");else if(d.lastname().length>20)d.lastnameClass("validationerror"),d.errorFirstLastName("<span>Sorry,</span> Please enter name of max. 20 characters");else{$.mobile.showPageLoadingMsg("a","Updating Name");var e=a();ES.loginService.accountModify(e,{success:b,error:c})}}}function EditShortDescriptionViewModel(){function a(){$.mobile.showPageLoadingMsg("a","Loading channel Infomation"),ES.channelService.getChannel(d.channelId(),{success:b,error:c})}function b(a){var b=[];b.push({channelId:a.id,channelName:a.name,channelDescription:a.description,longDescription:a.longDescription,followerCount:a.followers}),b=b[0],ENYM.ctx.setItem("currentChannelData",JSON.stringify(b));var c={redirect:d.previousViewID(),type:"",text:"Channel Tagline updated"};showToast(c),popBackNav()}function c(a,b,c){$.mobile.hidePageLoadingMsg(),d.errorMessage(!0),d.errorChannel("<span>Sorry,</span> "+c.message)}var d=this;d.template="editShortDescriptionView",d.viewid="V-66",d.viewname="Edit Tagline",d.displayname="Edit Channel Tagline",d.errorMessage=ko.observable(!1),d.inputObs=["channelId","channelName","shortDescription","errorChannel","notification"],d.defineObservables(),d.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(a){addExternalMarkup(d.template);var a=JSON.parse(ENYM.ctx.getItem("currentChannelData"));d.channelId(a.channelId),d.channelName(a.channelName),d.shortDescription(a.channelDescription),$("textarea").keyup(function(){d.errorMessage(!1),d.errorChannel("")})}else goToView("channelsIOwnView")},$(document).keyup(function(a){13==a.keyCode&&"TEXTAREA"!=a.target.nodeName&&"editShortDescriptionView"==$.mobile.activePage.attr("id")&&d.shortDescriptionCommand()}),d.shortDescriptionCommand=function(){if(""==d.shortDescription()||"undefined"==typeof d.shortDescription())d.errorMessage(!0),d.errorChannel("<span>Sorry,</span> Please enter channel tagline");else if(d.shortDescription().length<=80){var b={id:d.channelId(),description:d.shortDescription()};$.mobile.showPageLoadingMsg("a","Modifying Channel "),ES.channelService.modifyChannel(b,{success:a,error:c})}else d.errorMessage(!0),d.errorChannel("<span>Sorry,</span> Taglines have a max of 80 characters")}}function EscalateHelpViewModel(){var a=this;a.template="escalateHelpView",a.viewid="V-20b",a.viewname="Escalate Help",a.displayname="Escalate help",a.activate=function(){addExternalMarkup(a.template)}}function EscalateSettingsViewModel(){var a=this;a.template="escalateSettingsView",a.viewid="V-20c",a.viewname="Escalate Settings",a.displayname="Escalate Settings",a.escType=ko.observable(!1),a.inputObs=["escalationColor","escalationType","escalateUntil","ecalateTime","remindClass","chaseClass","houndClass","remindColor","chaseColor","houndColor"],a.defineObservables(),a.activate=function(){addExternalMarkup(a.template),a.escType(!1),a.escalateUntil(""),a.ecalateTime("Set Date and Time"),a.remindColor(""),a.chaseColor(""),a.houndColor(""),a.remindClass(""),a.chaseClass(""),a.houndClass(""),"H"==ENYM.ctx.getItem("escLevel")?(a.escalationColor("houndcolor"),a.houndColor("houndcolor"),a.houndClass("criticalicon"),ENYM.ctx.setItem("escLevel","H"),a.escalationType('"Hound"')):"C"==ENYM.ctx.getItem("escLevel")?(a.escalationColor("chasecolor"),a.chaseColor("chasecolor"),a.chaseClass("broadcasticon"),ENYM.ctx.setItem("escLevel","C"),a.escalationType('"Chase"')):(a.escalationColor("remindcolor"),a.remindColor("remindcolor"),a.remindClass("timesensitiveicon"),ENYM.ctx.setItem("escLevel","R"),a.escalationType('"Remind"')),ENYM.ctx.getItem("escDuration")&&(a.escalateUntil(" until: "+moment(ENYM.ctx.getItem("escDuration")).format("h:m A, MMM. D, YYYY")),a.ecalateTime("Edit"),a.escType(!0))},a.remindActive=function(){a.remindColor("remindcolor "),a.chaseColor(""),a.houndColor(""),a.remindClass("timesensitiveicon "),a.chaseClass(""),a.houndClass(""),ENYM.ctx.setItem("escLevel","R"),a.escalationColor("remindcolor "),a.escalationType('"Remind"')},a.chaseActive=function(){a.remindColor(""),a.chaseColor("chasecolor"),a.houndColor(""),a.remindClass(""),a.chaseClass("broadcasticon"),a.houndClass(""),ENYM.ctx.setItem("escLevel","C"),a.escalationColor("chasecolor"),a.escalationType('"Chase"')},a.houndActive=function(){a.remindColor(""),a.chaseColor(""),a.houndColor("houndcolor"),a.remindClass(""),a.chaseClass(""),a.houndClass("criticalicon"),ENYM.ctx.setItem("escLevel","H"),a.escalationColor("houndcolor"),a.escalationType('"Hound"')},a.saveCommand=function(){if(ENYM.ctx.getItem("escDuration"))ENYM.ctx.setItem("escalate","yes"),popBackNav();else{var a={type:"toast-error",text:"Please set Date and time for escalation !"};showToast(a)}}}function EscalateTimeSettingsViewModel(){var a=this;a.template="escalateTimeSettingsView",a.viewid="V-20d",a.viewname="Escalate Time",a.displayname="Escalate time",a.inputObs=["month","day","year","hour","minute","meridiem","pickerDate"],a.defineObservables(),a.activate=function(){if(monthNames=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"],addExternalMarkup(a.template),ENYM.ctx.getItem("escDuration"))a.month(moment(ENYM.ctx.getItem("escDuration")).format("MMM")),a.day(moment(ENYM.ctx.getItem("escDuration")).format("D")),a.year(moment(ENYM.ctx.getItem("escDuration")).format("YYYY")),a.hour(moment(ENYM.ctx.getItem("escDuration")).format("h")),a.minute(moment(ENYM.ctx.getItem("escDuration")).format("m")),a.meridiem(moment(ENYM.ctx.getItem("escDuration")).format("A")),a.pickerDate("Escalate until: "+moment(ENYM.ctx.getItem("escDuration")).format("h:m A, MMM. D, YYYY"));else{a.month(monthNames[_getDate("getMonth")]),a.day(_getDate("getDate")),a.year(_getDate("getFullYear"));var b=_getDate("getHours");b=(10>b?"0":"")+(b>12?b-12:b),a.hour(b);var c=_getDate("getMinutes");c=(10>c+1?"0":"")+c,a.minute(c);var d=_getDate("getHours")>11?"PM":"AM";a.meridiem(d),a.pickerDate("Escalate until: "+a.hour()+":"+a.minute()+" "+a.meridiem()+", "+a.month()+". "+a.day()+", "+a.year())}},a.upArrow=function(b){ENYM.ctx.setItem("setValue",b),a.setUp()},a.downArrow=function(b){ENYM.ctx.setItem("setValue",b),a.setDown()},a.setUp=function(){if("month"==ENYM.ctx.getItem("setValue"))a.month("Dec"==a.month()?"Jan":monthNames[$.inArray(a.month(),monthNames)+1]);else if("day"==ENYM.ctx.getItem("setValue"))if(31==a.day())a.day(1);else{var b=a.day();b==b++,a.day(b)}else if("year"==ENYM.ctx.getItem("setValue")){var c=a.year();c==c++,a.year(c)}else if("hour"==ENYM.ctx.getItem("setValue"))if(12==a.hour())a.hour(1);else{var d=a.hour();d==d++,a.hour(d)}else if("minute"==ENYM.ctx.getItem("setValue"))if(59==a.minute())a.minute("00");else{var e=a.minute();e==e++,e=(10>e?"0":"")+e,a.minute(e)}else"meridiem"==ENYM.ctx.getItem("setValue")&&a.meridiem("PM"==a.meridiem()?"AM":"PM");a.pickerDate("Escalate until: "+a.hour()+":"+a.minute()+" "+a.meridiem()+", "+a.month()+". "+a.day()+", "+a.year())},a.setDown=function(){if("month"==ENYM.ctx.getItem("setValue"))a.month("Jan"==a.month()?"Dec":monthNames[$.inArray(a.month(),monthNames)-1]);else if("day"==ENYM.ctx.getItem("setValue"))if(1==a.day())a.day(31);else{var b=a.day();b==b--,a.day(b)}else if("year"==ENYM.ctx.getItem("setValue"))a.year(a.year()-1);else if("hour"==ENYM.ctx.getItem("setValue"))if(1==a.hour())a.hour(12);else{var c=a.hour();c==c--,a.hour(c)}else if("minute"==ENYM.ctx.getItem("setValue"))if(0==a.minute())a.minute(59);else{var d=a.minute();d==d--,d=(10>d?"0":"")+d,a.minute(d)}else"meridiem"==ENYM.ctx.getItem("setValue")&&a.meridiem("PM"==a.meridiem()?"AM":"PM");a.pickerDate("Escalate until: "+a.hour()+":"+a.minute()+" "+a.meridiem()+", "+a.month()+". "+a.day()+", "+a.year())},a.saveCommand=function(){var b,c=(a.year()+"/"+a.month()+"/"+a.day()+" "+a.hour()+":"+a.minute()+" "+a.meridiem(),moment());"PM"==a.meridiem()&&a.hour()<12&&(b=parseInt(a.hour())+parseInt(12));var d=monthNames.indexOf(a.month()),e=parseInt(a.minute())+parseInt(0),f=moment([a.year(),d,a.day(),b,e,0,0]),g=f.diff(c,"minutes");if(g>0)ENYM.ctx.setItem("escDuration",f),popBackNav();else{var h={type:"toast-error",text:"Please set date greater than current date !"};showToast(h)}}}function EscalationPlanSingleViewModel(){function a(a){a.escPaths.length&&$.each(a.escPaths,function(a,c){c.urgencyName.toLowerCase()==b.activeEscPlan&&(delays=new Array,arrCounter=0,$.each(c.steps,function(a,b){-1==$.inArray(b.delay,delays)&&(delays[arrCounter]=b.delay),arrCounter++}),delays=delays.sort(),$.each(delays,function(a,d){switch(d){case 0:varDelayText="Immediately ( 0 minute after arrival )";break;default:varDelay=d/60,59>varDelay?varDelay+=" minutes ":varDelay=varDelay/60+" hours",varDelayText=varDelay+" after arrival"}var e=[];$.each(c.steps,function(a,b){if(b.delay==d){var c=[];$.each(b.retries,function(a,b){varRetriesInternal=b.interval/60,59>varRetriesInternal?varRetriesInternal+=" minutes ":varRetriesInternal=varRetriesInternal/60+" hours",varRetriesDuration=b.totalDuration/60,59>varRetriesDuration?varRetriesDuration+=" minutes ":varRetriesDuration=varRetriesDuration/60+" hours",c.push({comInterval:varRetriesInternal,comDuration:varRetriesDuration})}),"PUSH"==b.comMethodType&&b.retries.length<1&&c.push({comInterval:"0 mins.",comDuration:"0 mins."}),e.push({comMethodName:b.comMethodType,comMethodRetries:c})}}),b.activeEscalationPlan.push({comMethods:e,delayText:varDelayText})}))})}var b=this;b.template="escalationPlanSingleView",b.viewid="V-081",b.viewname="EscalationPlanSingle",b.displayname="Escalation Plan Single",b.hasfooter=!0,b.commethods=ko.observableArray([]),b.activeEscalationPlan=ko.observableArray([]),b.inputObs=["baseUrl","backText","name","activeEscPlan","navText"],b.defineObservables(),b.pView="",b.gotoView=function(){goToView("escalationPlanSingleView")},b.activate=function(){addExternalMarkup(b.template);var c=ENYM.ctx.getItem("baseUrl"),d=ENYM.ctx.getItem("previousView");console.log("previousView: "+d);var e=ko.dataFor($("#"+d).get(0));if(console.log("previousView Model viewid: "+e.displayname),b.navText(e.displayname),b.pView=d,c)b.baseUrl(c);else{var f=new EvernymService;b.baseUrl(f.getBaseUrl())}var g=ENYM.ctx.getItem("UserFullName");return b.activeEscalationPlan.removeAll(),b.backText("<em></em>"+backNavText[backNavText.length-1]),b.name(g),b.activeEscPlan=ENYM.ctx.getItem("activeEscPlan"),b.getEscPlans().then(a)},b.getEscPlans=function(){var a={success:function(){},error:function(){alert("error")}};return ES.escplanService.getEscPlans(a)},b.getCommethods=function(){var a={success:function(){},error:function(){alert("error")}};return ES.commethodService.getCommethods(a)},b.gotoView=function(a){goToView(a)},b.showCommethods=function(a){if(a.commethod.length>0){var c="",d=!1;$.each(a.commethod,function(a,e){"N"==e.verified&&(c="notverify",d=!0),b.commethods.push({comMethodAddress:e.address,comMethodClass:c,comMethodVerify:d})})}}}function FeedbackViewModel(){var a=this;a.template="feedbackView",a.viewid="V-47",a.viewname="Feedback",a.displayname="Feedback",a.activate=function(){addExternalMarkup(a.template),ENYM.ctx.removeItem("feedbackType")},a.praise=function(){ENYM.ctx.setItem("feedbackType","feedback"),viewNavigate("Feedback","feedbackView","sendFeedbackView")},a.suggestions=function(){ENYM.ctx.setItem("feedbackType","suggestions"),viewNavigate("Feedback","feedbackView","sendFeedbackView")},a.reportABug=function(){ENYM.ctx.setItem("feedbackType","bug"),viewNavigate("Feedback","feedbackView","sendFeedbackView")}}function FirstChannelViewModel(){var a=this;a.template="firstChannelView",a.viewid="V-14",a.viewname="FollowFirstChannel",a.displayname="Follow First Channel",a.backText=ko.observable(),a.activate=function(){var b=ES.evernymService.getAccessToken();""==b||null==b?goToView("loginView"):a.backText("<em></em>"+backNavText[backNavText.length-1])}}function FollowChannelViewModel(){function a(a){return a?ES.channelService.getChannel(d.channelValue(),{success:b,error:c}):(d.findClass("validationerror"),void d.errorFind("<span>Sorry,</span> that channel name doesn't exist, try again"))}function b(a){$.mobile.hidePageLoadingMsg(),ENYM.ctx.setItem("currentChannel",JSON.stringify(a)),viewNavigate("Follow Channel","followChannelView","channelView")}function c(a,b,c){$.mobile.hidePageLoadingMsg(),d.findClass("validationerror"),d.errorFind("<span>Sorry,</span> "+c.message)}var d=this;d.template="followChannelView",d.viewid="V-??",d.viewname="Follow Channel",d.displayname="Follow Channel",d.inputObs=["channelValue"],d.errorObs=["findClass","errorFind"],d.defineObservables(),d.activate=function(){addExternalMarkup(d.template),ENYM.ctx.removeItem("currentChannel"),$("input").keyup(function(){d.clearErrorObs()})},$(document).keyup(function(a){13==a.keyCode&&"followChannelView"==$.mobile.activePage.attr("id")&&d.findChannel()}),d.findChannel=function(){""==d.channelValue()?(d.findClass("validationerror"),d.errorFind("<span>Sorry,</span> Please enter channel name")):($.mobile.showPageLoadingMsg("a","Searching channel"),ES.loginService.checkName(d.channelValue(),{success:a,error:c}))}}function FollowerDetailsViewModel(){var a=this;a.template="followerDetailsView",a.viewid="V-35",a.viewname="Follower Details",a.displayname="Follower Details",a.followerCommethods=ko.observable([]),a.inputObs=["channelName","nameClass","followerName","reachable","followerEvernym","evernymType"],a.defineObservables(),a.evernymIcon=ko.observable(!1),a.visibleEvernym=ko.observable(!0),a.visibleName=ko.observable(!1),a.evernym=ko.observable(!1),a.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData")),c=JSON.parse(ENYM.ctx.getItem("currentfollowerData"));b?(addExternalMarkup(a.template),a.channelName(b.channelName),a.evernymIcon(c.evernymIcon),a.nameClass(c.nameClass),a.evernymType(!1),a.followerCommethods([]),a.visibleName(c.visibleName),a.evernym(c.evernym),a.reachable(c.reachable),1==c.visibleName&&a.followerName("undefined"==typeof c.followerName||""==c.followerName?c.accountname:c.followerName),"Y"==c.type&&a.evernymType(!0)):goToView("followersListView"),0==c.evernymIcon&&$.when(ES.commethodService.getCommethodsForProvis(c.accountname).then(function(b){a.followerCommethods(b.commethod)}))}}function FollowersListViewModel(){function a(a){$.mobile.hidePageLoadingMsg(),invites=declines=unreachs=0,name=accountname="",$.each(a.followers,function(a,b){if("O"!=b.relationship&&("I"==b.relationship?invites==invites++:"D"==b.relationship&&declines==declines++,"F"==b.relationship)){"N"==b.reachable&&unreachs==unreachs++;var d=!0,e=!1;if("N"==b.managed)var f="normalfollowers",g=!0,e=!0;else var f="provisionalicon noname",g=!1;if("undefined"==typeof b.firstname&&"undefined"==typeof b.lastname?("Y"==b.managed?name=b.comMethods[0].address:(name="",f+=" noname"),d=!1):"undefined"==typeof b.firstname?name=b.lastname:"undefined"==typeof b.lastname?name=b.firstname:""==b.firstname&&""==b.lastname?("Y"==b.managed?name=b.comMethods[0].address:(name="",f+=" noname"),d=!1):name=b.firstname+" "+b.lastname,"N"==b.reachable){var f="normalfollowers noverified";reachable="Un-reachable Follower";var g=!0;""==name&&"N"==b.managed&&(name=b.accountname)}else reachable=b.accountname;c.followers.push({followerId:b.id,nameClass:f,visibleName:d,followerName:name,accountname:b.accountname,reachable:reachable,evernym:g,evernymIcon:e,type:b.managed})}}),c.invitesCount(invites),c.declinesCount(declines),c.unreachCount(unreachs),(0!=c.invitesCount()||0!=c.declinesCount()||0!=c.unreachCount())&&c.countIsZero(!0),c.followerCount(1==c.followers().length?"Follower ("+c.followers().length+")":"Followers ("+c.followers().length+")")}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="followersListView",c.viewid="V-26",c.viewname="Followers",c.displayname="Followers",c.inputObs=["channelId","channelName","invitesCount","declinesCount","unreachCount","followerCount","countIsZero"],c.defineObservables(),c.followers=ko.observableArray([]),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData"));return d?(addExternalMarkup(c.template),c.followers.removeAll(),c.followerCount("Followers ()"),c.accountName(ENYM.ctx.getItem("accountName")),c.channelId(d.channelId),c.channelName(d.channelName),c.countIsZero(!1),$.mobile.showPageLoadingMsg("a","Loading Followers"),ES.channelService.getFollowers(c.channelId(),{success:a,error:b})):void goToView("channelsIOwnView")},c.followerDetails=function(a){ENYM.ctx.setItem("currentfollowerData",JSON.stringify(a)),viewNavigate("Followers","followersListView","followerDetailsView")}}function ForgotEvernymViewModel(){var a=this;a.requiresAuth=!1,a.template="forgotEvernymView",a.viewid="V-??",a.viewname="ForgotEvernym",a.displayname="Forgot Evernym",a.sectionOne=ko.observable(!0),a.sectionTwo=ko.observable(!1),a.inputObs=["email"],a.errorObs=["errorEmail","emailClass"],a.defineObservables(),a.activate=function(){var b=ES.evernymService.getAccessToken();""==b||null==b?(a.sectionOne(!0),a.sectionTwo(!1),$("input").keyup(function(){a.clearErrorObs()})):goToView("homeView")},$(document).keyup(function(b){13==b.keyCode&&"forgotEvernymView"==$.mobile.activePage.attr("id")&&a.forgotEvernymCommand()}),a.forgotEvernymCommand=function(){var b=/^[\+_a-zA-Z0-9-]+(\.[\+_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;""==a.email()?(a.emailClass("validationerror"),a.errorEmail("Please enter your email")):""==a.email()||b.test(a.email())?(a.sectionOne(!1),a.sectionTwo(!0)):(a.emailClass("validationerror"),a.errorEmail("Please enter valid email"))}}function ForgotPasswordViewModel(){function a(){$.mobile.hidePageLoadingMsg(),c.sectionOne(!1),c.sectionTwo(!0)}function b(a,b,d){$.mobile.hidePageLoadingMsg(),c.emailClass("validationerror"),c.errorEmail(d.message)}var c=this;c.requiresAuth=!1,c.template="forgotPasswordView",c.viewid="V-03",c.viewname="ForgotPassword",c.displayname="Forgot Password",c.sectionOne=ko.observable(!0),c.sectionTwo=ko.observable(!1),c.inputObs=["email"],c.errorObs=["errorEmail","emailClass"],c.defineObservables(),c.activate=function(){var a=ES.evernymService.getAccessToken();""==a||null==a?(c.sectionOne(!0),c.sectionTwo(!1),$("input").keyup(function(){c.clearErrorObs()})):goToView("homeView")},$(document).keyup(function(a){13==a.keyCode&&"forgotPasswordView"==$.mobile.activePage.attr("id")&&c.forgotPasswordCommand()}),c.forgotPasswordCommand=function(){var d=/^[\+_a-zA-Z0-9-]+(\.[\+_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;if(""==c.email())c.emailClass("validationerror"),c.errorEmail("Please enter your email");else{if(""==c.email()||d.test(c.email())){var e={success:a,error:b},f={};return f.emailAddress=c.email(),$.mobile.showPageLoadingMsg("a","Sending Forgot Password Request"),ES.loginService.forgotPassword(f,e)}c.emailClass("validationerror"),c.errorEmail("Please enter valid email")}}}function HeaderViewModel(){this.backText=ko.observable(),this.isBack=ko.observable(!0),this.newMessageCount=ko.observable(""),this.newMessageClass=ko.observable(),that=this,this.activate=function(){"homeView"==$.mobile.activePage.attr("id")&&(this.isBack=ko.observable(!1)),that.backText("undefined"==typeof backNavText[0]?"<em></em>Home":"<em></em>"+backNavText[backNavText.length-1]),this.updateBadges()},this.updateBadges=function(){$.isEmptyObject(ES.systemService.MnsCacheData)||setTimeout(function(){"undefined"!=typeof ES.systemService.MnsCacheData.data&&(showNewMessagesCount(ES.systemService.MnsCacheData.data.unreadCount),overlayViewModel.showNewMessagesOverlay())},1e3);var a={success:function(a){a&&a.unreadCount>0?ES.systemService.getMsgNotifs({success:function(a){ENYM.ctx.removeItem("enymNotifications"),ENYM.ctx.setItem("enymNotifications",JSON.stringify(a.messagealert)),JSON.parse(ENYM.ctx.getItem("enymNotifications")).length>0&&(overlayViewModel.showNewMessagesOverlay(),showNewMessagesCount(JSON.parse(ENYM.ctx.getItem("enymNotifications")).length))},error:function(){}}):(showNewMessagesCount(0),ENYM.ctx.removeItem("enymNotifications"))},error:function(){}};ES.systemService.getMsgNotifsSmry_C(a)},showNewMessagesCount=function(a){a>0?(headerViewModel.newMessageClass("smsiconwhite"),headerViewModel.newMessageCount(a)):(headerViewModel.newMessageCount(""),headerViewModel.newMessageClass(""))},showNewMessagesList=function(a){a>0?(headerViewModel.newMessageClass("smsiconwhite"),headerViewModel.newMessageCount(a)):headerViewModel.newMessageCount("")},this.backCommand=function(a,b){var c=b.currentTarget.parentNode.parentNode.parentNode.getAttribute("id");switch(c){case"addContactView":1==addContactViewModel.showConfirm()?(addContactViewModel.showDelete(!0),addContactViewModel.showConfirm(!1)):1==addContactViewModel.showDelete()?(addContactViewModel.showDelete(!1),goToView("addContactView")):popBackNav();break;default:"undefined"==typeof backNavText[0]?goToView("homeView"):popBackNav()}},this.comingSoon=function(){var a={type:"toast-info",text:"Feature coming soon!"};showToast(a)},this.newMessagesOverlayPopup=function(){if(ENYM.ctx.getItem("enymNotifications"))JSON.parse(ENYM.ctx.getItem("enymNotifications")).length>0&&$("#newMessages").popup().popup("open",{x:10,y:10});else{var a={type:"toast-info",text:"You dont have any new messages!"};showToast(a)}if(""==this.newMessageClass()){var a={type:"toast-info",text:"You dont have any new messages!"};showToast(a)}},this.menuCommand=function(){var a=getCurrentViewModel().viewname;viewNavigate(a,$.mobile.activePage.attr("id"),"channelMenuView")}}function OverlayViewModel(){that=this,this.newMessagesDisplayList=ko.observableArray([]),this.activate=function(){},this.showNewMessagesOverlay=function(){overlayViewModel.newMessagesDisplayList.removeAll();truncatedText();$.each(JSON.parse(ENYM.ctx.getItem("enymNotifications")),function(a,b){if(b.createdLong=formatDate(b.created,"long"),b.created=formatDate(b.created,"short","main"),b.fullText=jQuery.trim(b.text),b.text="<em>"+b.created+"</em>:&nbsp;"+b.text,b.escLevelId&&"N"!=b.escLevelId&&"F"!=b.escLevelId){b.escLevelId="iconchannels icon-"+b.escLevelId.toLowerCase();var c="msg-icon"}else if("N"==b.escLevelId||"F"==b.escLevelId){b.escLevelId="";var c="onlymsg"}else b.escLevelId="iconchannels icon-d";if("Y"==b.ackRequested&&"N"==b.acknowledged&&"N"==b.dismissed)var d="igibutton",c="igi-msg";else if("Y"==b.acknowledged&&"N"==b.dismissed)var d="igibutton igisent",c="igi-msg";else var d="";if(""!=d&&""!=b.escLevelId)var c="";b.iGiClass=d,b.messageType=c,b.readClass="read-"+b.read.toLowerCase(),overlayViewModel.newMessagesDisplayList.push(b)})},this.closePopup=function(){$("#newMessages").popup("close")},this.iGiAckOverlay=function(a,b){var c={success:function(){var a={type:"",text:"iGi sent!"};showToast(a)},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};$.mobile.showPageLoadingMsg("a","Sending iGi request!"),$.isEmptyObject(ES.systemService.MnsCacheData)||(setTimeout(function(){ES.systemService.adjMnsCount(-1),$("#"+b.currentTarget.parentNode.getAttribute("id")).remove()},1e3),1==ES.systemService.MnsCacheData.data.unreadCount&&$("#newMessages").remove());var d=[];return d=JSON.parse(ENYM.ctx.getItem("enymNotifications")),d.length>0&&($.each(d,function(b,c){"undefined"!=typeof c&&c.msgId==a.msgId&&d.splice(b,1)}),setTimeout(function(){showNewMessagesCount(ES.systemService.MnsCacheData.data.unreadCount)},1e3),ENYM.ctx.setItem("enymNotifications",JSON.stringify(d))),ES.messageService.acknowledgeMsg(a.msgId,c)},this.showSingleMessage=function(a){ENYM.ctx.setItem("overlayCurrentChannel",JSON.stringify(a));var b=getCurrentViewModel().viewname;viewNavigate(b,$.mobile.activePage.attr("id"),"channelSingleMessagesView")}}function HelpViewModel(){var a=this;a.template="helpView",a.viewid="V-45",a.viewname="Help",a.displayname="Help and FAQs",a.activate=function(){addExternalMarkup(a.template)}}function HomeViewModel(){var a=this;a.template="homeView",a.viewid="V-40",a.viewname="Home",a.displayname="Home",a.activate=function(){addExternalMarkup(a.template)}}function InviteFollowersViewModel(){var a=this;a.template="inviteFollowersView",a.viewid="V-27a",a.viewname="InviteFollowers",a.displayname="Invite Followers",a.textId=ko.observable("message"),a.error=ko.observable(!1),a.inputObs=["channelName","channelWebAddress","emailClass","errorEmail","emailaddress","textClass","text","errorText"],a.defineObservables(),a.activate=function(){a.error(!1);var b=JSON.parse(ENYM.ctx.getItem("currentChannelData"));if(b){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData"));a.channelName(b.channelName),a.channelWebAddress(b.channelName+".evernym.dom"),$("textarea").keyup(function(){a.textClass(""),a.error(!1),a.errorText("")}),$("input, textarea").keyup(function(){a.emailClass(""),a.errorEmail("")})}else goToView("channelsIOwnView")},$(document).keyup(function(b){13==b.keyCode&&"TEXTAREA"!=b.target.nodeName&&"inviteFollowersView"==$.mobile.activePage.attr("id")&&a.sendInviteCommand()}),a.sendInviteCommand=function(){var b=/^[\+_a-zA-Z0-9-]+(\.[\+_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/,c=$("#"+a.textId()).val();""!=a.emailaddress()&&b.test(a.emailaddress())?""==c?(a.textClass("validationerror"),a.error(!0),a.errorText("<span>Sorry,</span> Please give message")):showMessage("Testing"):(a.emailClass("validationerror"),a.errorEmail("<span>Sorry,</span> Please enter valid email"))}}function InvitedFollowersViewModel(){function a(a){$.mobile.hidePageLoadingMsg(),$.each(a.followers,function(a,b){if("I"==b.relationship){var d=!0,e=!1;if("N"==b.managed)var f="normalfollowers",g=!0,e=!0;else var f="provisionalicon noname",g=!1;if("undefined"==typeof b.firstname&&"undefined"==typeof b.lastname)"Y"==b.managed?h=b.comMethods[0].address:(h="",f+=" noname"),d=!1;else if("undefined"==typeof b.firstname)var h=b.lastname;else if("undefined"==typeof b.lastname)var h=b.firstname;else if(""==b.firstname&&""==b.lastname)"Y"==b.managed?h=b.comMethods[0].address:(h="",f+=" noname"),d=!1;else var h=b.firstname+" "+b.lastname;c.followers.push({followerId:b.id,nameClass:f,visibleName:d,followerName:h,accountname:b.accountname,reachable:b.accountname,evernym:g,evernymIcon:e,type:b.managed}),c.invitesCount(c.followers().length)}})}function b(){$.mobile.hidePageLoadingMsg()}var c=this;c.template="invitedFollowersView",c.viewid="V-??",c.viewname="Pending Invites",c.displayname="Pending Invites",c.evernymIcon=ko.observable(!1),c.inputObs=["channelId","channelName","invitesCount"],c.defineObservables(),c.followers=ko.observableArray([]),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData"));return d?(addExternalMarkup(c.template),c.evernymIcon(!1),c.followers.removeAll(),c.invitesCount(""),c.channelId(d.channelId),c.channelName(d.channelName),$.mobile.showPageLoadingMsg("a","Loading Invited Followers"),ES.channelService.getFollowers(c.channelId(),{success:a,error:b})):void goToView("channelsIOwnView")
},c.followerDetails=function(a){ENYM.ctx.setItem("currentfollowerData",JSON.stringify(a)),viewNavigate("Pending Invites","invitedFollowersView","followerDetailsView")}}function LoginViewModel(){function a(a){return $.mobile.hidePageLoadingMsg(),ES.evernymService.clearAccessToken(),a.accessToken?(ES.evernymService.setAccessToken(a.accessToken),ENYM.ctx.setItem("account",JSON.stringify(a.account)),ENYM.ctx.setItem("accountName",d.username()),ENYM.ctx.setItem("evernym",1),"undefined"!=typeof a.privs&&ENYM.ctx.setItem("roleType",a.privs),1==ENYM.ctx.getItem("resumeStatus")?goToView(d.previousViewID()):d.getCommethodsCommand(),ENYM.ctx.setItem("resumeStatus",0),void 0):void d.errorMessage("<span>Sorry, </span> Unknown Error.")}function b(a){if($.mobile.hidePageLoadingMsg(),a.commethod[0])for(var b=0;b<a.commethod.length;b++){if("Y"==a.commethod[b].verified)return d.afterLoggedIn(),!0;b==a.commethod.length-1&&"N"==a.commethod[b].verified&&viewNavigate("Home","homeView","afterLoginVerifyView")}else goToView("homeView")}function c(a,b,c){$.mobile.hidePageLoadingMsg(),ENYM.ctx.removeItem("action");var d={redirect:"homeView",type:"toast-error",text:c.message};showToast(d),goToView("homeView")}var d=this;d.requiresAuth=!1,d.template="loginView",d.viewid="V-01",d.viewname="Login",d.displayname="Login",d.inputObs=["username","password","session"],d.errorObs=["errorMessage","usernameClass","passwordClass"],d.defineObservables(),d.activate=function(){var a=ES.evernymService.getAccessToken();""==a||null==a?(d.errorMessage(""),d.username(""),d.password(""),$("input").keyup(function(){d.clearErrorObs()}),ENYM.ctx.removeItem("signupObj")):goToView("homeView")},$(document).keyup(function(a){13==a.keyCode&&"loginView"==$.mobile.activePage.attr("id")&&d.loginCommand()}),d.loginCommand=function(){if(""==d.username()&&""==d.password())d.usernameClass("validationerror"),d.passwordClass("validationerror"),d.errorMessage("<span>Sorry,</span> Please enter username and password");else if(""==d.username())d.usernameClass("validationerror"),d.errorMessage("<span>Sorry,</span> Please enter username");else{if(""!=d.password()){d.errorMessage(""),1==$('input[name="rememberPassword"]:checked').length?(d.session(1209600),$("input[type='checkbox']").attr("checked",!1).checkboxradio("refresh")):d.session(3600);var b=function(){d.usernameClass("validationerror"),d.passwordClass("validationerror"),d.errorMessage("<span>Sorry, </span> evernym or password is incorrect"),d.password("")},c={};return $.mobile.showPageLoadingMsg("a","Logging In"),c.accountname=d.username(),c.appToken="sNQO8tXmVkfQpyd3WoNA6_3y2Og=",c.overrideTtl=d.session(),c.password=d.password(),ES.loginService.accountLogin(c).then(a,b)}d.passwordClass("validationerror"),d.errorMessage("<span>Sorry,</span> Please enter password")}},d.cleanApplication=function(){ES.evernymService.clearAccessToken(),ENYM.ctx.removeItem("login_nav"),ENYM.ctx.removeItem("currentChannel"),ENYM.ctx.removeItem("accountName"),ENYM.ctx.removeItem("name"),ENYM.ctx.removeItem("signUpError"),ENYM.ctx.removeItem("newuseremail"),ENYM.ctx.removeItem("roleType")},d.getCommethodsCommand=function(){return ES.commethodService.getCommethods({success:b,error:c})},d.afterLoggedIn=function(){var a=JSON.parse(ENYM.ctx.getItem("action"));if(a&&"Y"==a.follow_channel&&"N"==a.SHARE_NAME){var b={success:function(){ENYM.ctx.removeItem("action");var a={redirect:"channelsFollowingListView",type:"",text:"Now following "+c.name};showToast(a),goToView("channelsFollowingListView")},error:function(a,b,c){ENYM.ctx.removeItem("action");var d={redirect:"channelsFollowingListView",type:"toast-info",text:c.message};showToast(d),goToView("channelsFollowingListView")}},c=JSON.parse(ENYM.ctx.getItem("currentChannel"));ES.channelService.followChannel(c.id,b)}else if(a&&"Y"==a.follow_channel&&"Y"==a.SHARE_NAME){var d=JSON.parse(ENYM.ctx.getItem("account"));if(d.firstname&&d.lastname){var b={success:function(){var a={redirect:"channelsFollowingListView",type:"",text:"Now following "+c.name};showToast(a),goToView("channelsFollowingListView")},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}},c=JSON.parse(ENYM.ctx.getItem("currentChannel"));ES.channelService.followChannel(c.id,b)}else goToView("nameRequiredView")}else goToView("homeView")}}function MessageLengthWarningViewModel(){var a=this;a.template="messageLengthWarningView",a.viewid="V-46",a.viewname="Message Warning",a.displayname="Message Length Warning",a.activate=function(){addExternalMarkup(a.template)}}function NameRequiredViewModel(){function a(){return{firstname:d.firstname(),lastname:d.lastname()}}function b(){$.mobile.hidePageLoadingMsg();var a=[];if(a.push({accountname:d.accountName(),firstname:d.firstname(),lastname:d.lastname()}),a=a[0],ENYM.ctx.setItem("account",JSON.stringify(a)),ENYM.ctx.getItem("newusername")){var b={success:function(){var a={redirect:"tutorialView",type:"",text:"Now following "+d.channelName()};showToast(a),goToView("tutorialView")},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};ES.channelService.followChannel(d.channelId(),b)}else{var b={success:function(){ENYM.ctx.removeItem("action");var a={redirect:"channelsFollowingListView",type:"",text:"Now following "+d.channelName()};showToast(a),goToView("channelsFollowingListView")},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};ES.channelService.followChannel(d.channelId(),b)}}function c(a,b,c){$.mobile.hidePageLoadingMsg(),d.firstnameClass("validationerror"),d.lastnameClass("validationerror"),d.errorFirstLastName("<span>Sorry,</span> "+c.message)}var d=this;d.template="nameRequiredView",d.viewid="V-??",d.viewname="Name Required",d.displayname="Name Required",d.inputObs=["channelId","channelName","firstname","lastname"],d.errorObs=["errorFirstName","errorFirstLastName","firstnameClass","lastnameClass"],d.defineObservables(),d.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("action"));if(a&&"Y"==a.follow_channel&&"Y"==a.SHARE_NAME){$("input").keyup(function(){d.clearErrorObs()});var b=JSON.parse(ENYM.ctx.getItem("currentChannel"));d.channelId(b.id),d.channelName(b.name)}else goToView("homeView")},$(document).keyup(function(a){13==a.keyCode&&"nameRequiredView"==$.mobile.activePage.attr("id")&&d.insertNameCommand()}),d.insertNameCommand=function(){if(""==d.firstname())d.firstnameClass("validationerror"),d.errorFirstName("<span>Sorry,</span> Please enter first name");else if(d.firstname().length>20)d.firstnameClass("validationerror"),d.errorFirstName("<span>Sorry,</span> Please enter name of max. 20 characters");else if(""==d.lastname())d.lastnameClass("validationerror"),d.errorFirstLastName("<span>Sorry,</span> Last name cannot be left empty");else if(d.lastname().length>20)d.lastnameClass("validationerror"),d.errorFirstLastName("<span>Sorry,</span> Please enter name of max. 20 characters");else{$.mobile.showPageLoadingMsg("a","Saving settings");var e=a();ES.loginService.accountModify(e,{success:b,error:c})}},d.cancelRequest=function(){if(ENYM.ctx.getItem("newusername")){ENYM.ctx.removeItem("action");var a={redirect:"tutorialView",type:"toast-info",text:"Follow request cancelled"};showToast(a),goToView("tutorialView")}else{ENYM.ctx.removeItem("action");var a={redirect:"homeView",type:"toast-info",text:"Follow request cancelled"};showToast(a),goToView("homeView")}}}function NewFollowersSettingsViewModel(){var a=this;a.template="newFollowersSettingsView",a.viewid="V-??",a.viewname="Follower settings",a.displayname="New Followers Notification settings",a.inputObs=["channelId","offText","normalText","fastText","offClass","normalClass","fastClass","escLevel","duration","activeType"],a.defineObservables(),a.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData")),c=JSON.parse(ENYM.ctx.getItem("followersNotify"));b?(addExternalMarkup(a.template),a.channelId(b.channelId),null==c?a.offYes():"F"==c?a.fastYes():a.normalYes()):goToView("channelsIOwnView")},a.offYes=function(){a.offText("coloroff"),a.normalText(""),a.fastText(""),a.offClass("bgoff"),a.normalClass(""),a.fastClass(""),a.duration(""),a.escLevel("O")},a.normalYes=function(){a.offText(""),a.normalText("colornormal"),a.fastText(""),a.offClass(""),a.normalClass("bgnormal"),a.fastClass(""),a.duration("Normal: <em>Send once (usually to email)</em>"),a.activeType("normalcolor"),a.escLevel("N")},a.fastYes=function(){a.offText(""),a.normalText(""),a.fastText("colorfast"),a.offClass(""),a.normalClass(""),a.fastClass("bgfast"),a.duration("Fast: <em>Send once (usually text or app)</em>"),a.activeType("fastcolor"),a.escLevel("F")},a.saveCommand=function(){if($.mobile.showPageLoadingMsg("a","Saving Channel Setting"),"O"==a.escLevel()){ES.channelService.removeChnlSetting(a.channelId(),"NEW_FLWR_NOTIF");var b={redirect:"channelSettingsView",type:"",text:"Notify me of new followers no longer required"}}else{var c={};c.NEW_FLWR_NOTIF=a.escLevel(),ES.channelService.putChnlSettings(a.channelId(),c);var d="Normal";if("F"==a.escLevel())var d="Fast";var b={redirect:"channelSettingsView",type:"",text:"Notify me of new followers is set to "+d}}setTimeout(function(){popBackNav(),showToast(b)},500)}}function NotGotItViewModel(){function a(a){var b,d;$.mobile.hidePageLoadingMsg();for(var e=0;e<a.recipients.length;e++){if("undefined"==typeof a.recipients[e].rcvrFirstname&&"undefined"==typeof a.recipients[e].rcvrLastname?(b="",d=""):(b=a.recipients[e].rcvrFirstname,d=a.recipients[e].rcvrLastname+","),e%2===0)var f="even";else var f="odd";c.recipients.push({recipientId:a.recipients[e].subscriberId,recipientsClass:f,recipient:"<span></span>"+b+" "+d+" <em>"+a.recipients[e].rcvrAccountname+"</em>"})}}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="notGotItView",c.viewid="V-57",c.viewname="Not Got it",c.displayname="Did not got iGi",c.recipients=ko.observableArray([]),c.inputObs=["channelName","channelId","messageId","time","singleMessage","broadcastType","iGi","percentageText","percentageClass","percentage","noiGi","noacks","acks","escalateUntil","replies"],c.defineObservables(),c.noacksVisibility=ko.observable(!1),c.acksVisibility=ko.observable(!1),c.escalateTime=ko.observable(!1),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData")),e=JSON.parse(ENYM.ctx.getItem("currentMessageData"));return d&&e?(addExternalMarkup(c.template),c.recipients.removeAll(),c.time("Sent - "+formatDate(e.created,"long")),c.singleMessage("<span>"+e.broadcastFull+"</span><em></em>"),c.broadcastType(e.type),c.iGi(e.iGi),c.percentageText(e.percentageText),c.percentageClass(e.percentageClass),c.percentage(e.percentage),c.noiGi(e.noiGi),c.noacksVisibility(!1),c.acksVisibility(!1),c.escalateTime(!1),""!=e.escUntil&&"undefined"!=typeof e.escUntil&&(c.escalateTime(!0),c.escalateUntil('<span class="singlemsgicon '+e.sensitivity+'"></span>"'+e.sensitivityText+'" until '+formatDate(e.escUntil,"short","main"))),c.replies(e.replies),"REQUEST_ACKNOWLEDGEMENT"==e.type&&"undefined"!=typeof e.noacks&&(e.acks+e.noacks==e.acks?(c.noacksVisibility(!1),c.acksVisibility(!0),c.acks(e.acks+" Got It")):(c.noacksVisibility(!0),c.acksVisibility(!0),c.noacks(e.noacks+" Haven't Got It Yet"),c.acks(e.acks+" Got It"))),ENYM.ctx.removeItem("currentRecipientData"),c.channelId(d.channelId),c.channelName(d.channelName),c.messageId(e.messageId),c.noacks(e.noacks+" Haven't Got It Yet"),$.mobile.showPageLoadingMsg("a","Loading Followers"),ES.messageService.getMessageRecipients(c.channelId(),c.messageId(),"N",{success:a,error:b})):void goToView("channelsIOwnView")},c.showWhoGotIt=function(){if("REQUEST_ACKNOWLEDGEMENT"!=c.broadcastType()){var a={type:"toast-info",text:"No iGi requested"};showToast(a)}else if("0 Got It"==c.acks()){var a={type:"toast-info",text:"No iGi's received yet"};showToast(a)}else viewNavigate("Not Got it","notGotItView","whoGotItView")},c.recipientDetails=function(a){ENYM.ctx.setItem("currentRecipientData",JSON.stringify(a)),viewNavigate("Not Got it","notGotItView","recipientDetailsView")}}function PlusMenuViewModel(){var a=this;a.template="plusMenuView",a.viewid="V-??",a.viewname="Plus Menu",a.displayname="Plus Menu",a.activate=function(){addExternalMarkup(a.template)}}function PrivacyPolicyViewModel(){var a=this;a.requiresAuth=!1,a.template="privacyPolicyView",a.viewid="V-49",a.viewname="Privacy Policy",a.displayname="Privacy Policy",a.hasheader=ko.observable(!1),a.hasfooter=ko.observable(!1),a.activate=function(){var b=ES.evernymService.getAccessToken();""==b||null==b?(a.hasheader(!0),a.hasfooter(!1)):(addExternalMarkup(a.template),a.hasheader(!1),a.hasfooter(!0))}}function RecipientDetailsViewModel(){var a=this;a.template="recipientDetailsView",a.viewid="V-34a",a.viewname="Recipient Details",a.displayname="Recipient Details",a.channelName=ko.observable(),a.recipient=ko.observableArray(),a.inputObs=["time","singleMessage","iGi","percentageText","percentageClass","percentage","noiGi","igiReceivedTime","escalateUntil","escalateTime","notIgiReceived"],a.defineObservables(),a.escalateTime=ko.observable(!1),a.igiReceived=ko.observable(!1),a.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData")),c=JSON.parse(ENYM.ctx.getItem("currentRecipientData")),d=JSON.parse(ENYM.ctx.getItem("currentMessageData"));if(b&&c){addExternalMarkup(a.template),a.channelName(b.channelName),a.time("Sent - "+formatDate(d.created,"long")),a.singleMessage("<span>"+d.broadcastFull+"</span><em></em>"),a.iGi(d.iGi),a.percentageText(d.percentageText),a.percentageClass(d.percentageClass),a.percentage(d.percentage),a.noiGi(d.noiGi),a.escalateTime(!1),""!=d.escUntil&&"undefined"!=typeof d.escUntil&&(a.escalateTime(!0),a.escalateUntil('<span class="singlemsgicon '+d.sensitivity+'"></span>"'+d.sensitivityText+'" until '+formatDate(d.escUntil,"short","main")));var e=c.recipient.split(",");if("undefined"==typeof e[1])var f="";else var f=e[1];a.igiReceivedTime(""),a.recipient(e[0]+" "+f),a.notIgiReceived("noigi")}else goToView("channelsIOwnView")}}function RegistrationVerifyViewModel(){var a=this;a.template="registrationVerifyView",a.viewid="V-02f",a.viewname="RegistrationVerify",a.displayname="Registration Verify",a.inputObs=["verificationCommethodType","verificationCommethod","verificationCommethodID","verificationCode","verified"],a.errorObs=["verificationClass","errorMessage"],a.defineObservables(),a.activate=function(){var b=ENYM.ctx.getItem("newusername");""==b||null==b?goToView("homeView"):(action=JSON.parse(ENYM.ctx.getItem("action")),a.getCommethods(),a.accountName("Your evernym is: "+ENYM.ctx.getItem("accountName")+" (Don't forget!)"),a.verificationCommethodType(ENYM.ctx.getItem("newuseremail")),$("input").keyup(function(){a.clearErrorObs()}))},$(document).keyup(function(b){13==b.keyCode&&"registrationVerifyView"==$.mobile.activePage.attr("id")&&a.verifyCommand()}),a.verifyCommand=function(){$.when(a.getCommethods().then(function(){"Y"==a.verified()?a.skipCommand():a.verifyRequestCommethod()}))},a.getCommethods=function(){var b={success:function(b){a.verificationCommethod(b.commethod[0].type),a.verificationCommethodID(b.commethod[0].id),a.verified(b.commethod[0].verified)},error:function(a,b,c){showMessage(c.message)}};return $.mobile.showPageLoadingMsg("a","Sending Verification Request"),ES.commethodService.getCommethods(b)},a.verifyRequestCommethod=function(){if(""==a.verificationCode())a.verificationClass("validationerror"),a.errorMessage("<span>ERROR:</span> Please input verification code!");else if(6!=a.verificationCode().length)a.verificationClass("validationerror"),a.errorMessage("<span>ERROR:</span> Verification code should be 6 digits!");else{var b={code:a.verificationCode(),type:a.verificationCommethodType(),address:a.verificationCommethod()};a.verifyRequest(b)}},a.requestVerificationCode=function(){var b={success:function(){var a={type:"",text:"Verification code sent"};showToast(a)},error:function(a,b,c){var d={type:"toast-error",text:c.message};showToast(d)}};return $.mobile.showPageLoadingMsg("a","Resending Verification code"),ES.commethodService.requestVerification(a.verificationCommethodID(),b)},a.verifyRequest=function(b){var c={success:function(){if(action&&"Y"==action.follow_channel&&"Y"==action.SHARE_NAME){var a={redirect:"nameRequiredView",type:"",text:"Email verified"};goToView("nameRequiredView")}else if(action&&"Y"==action.follow_channel&&"N"==action.SHARE_NAME){var b={success:function(){var a={redirect:"tutorialView",type:"",text:"Now following "+c.name};showToast(a)},error:function(a,b,c){var d={redirect:"tutorialView",type:"toast-error",text:c.message};showToast(d)}},c=JSON.parse(ENYM.ctx.getItem("currentChannel"));ES.channelService.followChannel(c.id,b),goToView("tutorialView")}else{var a={redirect:"tutorialView",type:"",text:"Email verified"};goToView("tutorialView")}showToast(a)},error:function(b,c,d){"100912"==d.code?(a.verified("Y"),a.skipCommand()):(a.verified("N"),a.errorMessage("<span>ERROR:</span> "+d.message))}};return $.mobile.showPageLoadingMsg("a","Sending Verification Request"),ES.commethodService.verification(b.code,c,ES.evernymService.getAccessToken())},a.skipCommand=function(){if(action&&"Y"==action.follow_channel&&"Y"==action.SHARE_NAME)if("Y"==a.verified()){var b={redirect:"nameRequiredView",type:"toast-info",text:"Email already verified"};showToast(b),goToView("nameRequiredView")}else goToView("nameRequiredView");else if(action&&"Y"==action.follow_channel&&"N"==action.SHARE_NAME){var c={success:function(){var a={redirect:"tutorialView",type:"",text:"Now following "+d.name};showToast(a),goToView("tutorialView")},error:function(a,b,c){var d={redirect:"tutorialView",type:"toast-error",text:c.message};showToast(d),goToView("tutorialView")}},d=JSON.parse(ENYM.ctx.getItem("currentChannel"));ES.channelService.followChannel(d.id,c)}else if("Y"==a.verified()){var b={redirect:"tutorialView",type:"toast-info",text:"Email already verified"};showToast(b),goToView("tutorialView")}else goToView("tutorialView")}}function RemoveFollowerViewModel(){function a(){$.mobile.hidePageLoadingMsg();for(var a=0;1>=a;a++)backNavText.pop(),backNavView.pop();ES.channelService.getChannel(d.channelId(),{success:b,error:c})}function b(a){var b=[];b.push({channelId:a.id,channelName:a.name,channelDescription:a.description,longDescription:a.longDescription,followerCount:a.followers}),b=b[0],ENYM.ctx.setItem("currentChannelData",JSON.stringify(b));var c={redirect:"followersListView",type:"",text:"Follower removed"};showToast(c),goToView("followersListView")}function c(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var d=this;d.template="removeFollowerView",d.viewid="V-35a",d.viewname="Remove Follower",d.displayname="Remove Follower",d.inputObs=["channelId","followerId","nameClass","followerName","reachable"],d.defineObservables(),d.evernymIcon=ko.observable(!1),d.evernym=ko.observable(!1),d.activate=function(){var a=JSON.parse(ENYM.ctx.getItem("currentChannelData")),b=JSON.parse(ENYM.ctx.getItem("currentfollowerData"));b?(addExternalMarkup(d.template),d.channelId(a.channelId),d.followerId(b.followerId),d.evernymIcon(b.evernymIcon),d.nameClass(b.nameClass),d.followerName(b.followerName),d.evernym(b.evernym),d.reachable(b.reachable)):goToView("followersListView")},d.removeFollowerCommand=function(){return $.mobile.showPageLoadingMsg("a","Removing Follower"),ES.channelService.removeFollower(d.channelId(),d.followerId(),{success:a,error:c})}}function ReplyDetailViewModel(){var a=this;a.template="replyDetailView",a.viewid="V-56",a.viewname="Reply Detail",a.displayname="Reply Detail",a.inputObs=["channelId","channelName","messageId","senderName","replyDate","reply","moreText"],a.defineObservables(),a.less=ko.observable(!0),a.more=ko.observable(!1),a.moreButton=ko.observable(!0),a.lessButton=ko.observable(!1),a.activate=function(){var b,c,d=JSON.parse(ENYM.ctx.getItem("currentChannelData")),e=JSON.parse(ENYM.ctx.getItem("currentMessageData"));if(d&&e){addExternalMarkup(a.template);var f=JSON.parse(ENYM.ctx.getItem("currentReplyData"));"undefined"==typeof f.senderFirstname&&"undefined"==typeof f.senderLastname?(b="Evernym",c=""):(b=f.senderFirstname,c=f.senderLastname),a.less(!0),a.more(!1),a.moreButton(!0),a.lessButton(!1),a.channelId(d.channelId),a.channelName(d.channelName),a.messageId(e.messageId),a.senderName(b+" "+c+":"),a.replyDate(formatDate(f.created,"short","main")),a.reply(f.replyLess),a.moreText(f.replyFull)}else goToView("channelsIOwnView")},a.showMore=function(){a.less(!1),a.more(!0),a.moreButton(!1),a.lessButton(!0)},a.showLess=function(){a.less(!0),a.more(!1),a.moreButton(!0),a.lessButton(!1)}}function RequestiGiHelpViewModel(){var a=this;a.template="requestiGiHelpView",a.viewid="V-20b",a.viewname="iGi Help",a.displayname="iGi help",a.activate=function(){authenticate()&&addExternalMarkup(a.template)}}function ResetPasswordViewModel(){function a(){$.mobile.hidePageLoadingMsg(),c.sectionOne(!1),c.sectionTwo(!0)}function b(a,b,d){c.passwordClass("validationerror"),c.confirmPasswordClass("validationerror"),c.errorResetPassword(d.message)}var c=this;c.requiresAuth=!1,c.template="resetPasswordView",c.viewid="V-03d",c.viewname="ResetPassword",c.displayname="ResetPassword",c.sectionOne=ko.observable(!0),c.sectionTwo=ko.observable(!1),c.inputObs=["newPassword","confirmPassword"],c.errorObs=["errorResetPassword","passwordClass","confirmPasswordClass","changePasswordNotification"],c.defineObservables(),c.activate=function(){jQuery.mobile.path.get().split("?")[1]?(c.sectionOne(!0),c.sectionTwo(!1),$("input").keyup(function(){c.clearErrorObs()})):goToView("forgotPasswordView")},$(document).keyup(function(a){13==a.keyCode&&"resetPasswordView"==$.mobile.activePage.attr("id")&&c.resetPasswordCommand()}),c.resetPasswordCommand=function(){if(""==c.newPassword()&&""==c.confirmPassword())c.passwordClass("validationerror"),c.confirmPasswordClass("validationerror"),c.errorResetPassword("Please enter password and confirm password");else{if(c.newPassword()==c.confirmPassword()){var d={success:a,error:b},e={};return e.password=c.newPassword(),e.confirmPassword=c.confirmPassword(),e.forgotPasswordRequestKey=jQuery.mobile.path.get().split("?")[1].replace("key=",""),$.mobile.showPageLoadingMsg("a","Sending Update Password Request"),ES.loginService.resetPassword(e,d)}c.passwordClass("validationerror"),c.confirmPasswordClass("validationerror"),c.errorResetPassword("Passwords don't match")}}}function SendFeedbackViewModel(){function a(){$.mobile.hidePageLoadingMsg();var a={redirect:"feedbackView",type:"",text:"Feedback sent successfully"};showToast(a),backNavText.pop(),backNavView.pop(),goToView("feedbackView")}function b(a,b,d){$.mobile.hidePageLoadingMsg(),c.feedbackClass("validationerror"),c.error(!0),c.errorFeedback("<span>Sorry,</span> "+d.message)}var c=this;c.template="sendFeedbackView",c.viewid="V-41",c.viewname="Send Feedback",c.displayname="Send Feedback",c.inputObs=["feedbackType","feedbackLabel","feedbackClass","feedback","feedbackContext","error","errorFeedback","feedbackPlaceholder"],c.defineObservables(),c.activate=function(){addExternalMarkup(c.template);var a=ENYM.ctx.getItem("feedbackType");"feedback"==a?(c.feedbackPlaceholder("Show user an example of usefull feedback"),c.feedbackType("Praise for Evernym Channels"),c.feedbackLabel("Your feedback:"),c.feedbackContext("feedback")):"suggestions"==a?(c.feedbackPlaceholder("Show user an example of usefull feedback"),c.feedbackType("Suggestions for Evernym Channels"),c.feedbackLabel("Your Suggestions:"),c.feedbackContext("suggestions")):(c.feedbackPlaceholder("Show user an example of how to report a bug in a usefull way"),c.feedbackType("Report a Bug for Evernym Channels"),c.feedbackLabel("Report a Bug:"),c.feedbackContext("bug")),a="",c.accountName(ENYM.ctx.getItem("accountName")),$("textarea").keyup(function(){c.feedbackClass(""),c.error(!1),c.errorFeedback("")})},$(document).keyup(function(a){13==a.keyCode&&"TEXTAREA"!=a.target.nodeName&&"sendFeedbackView"==$.mobile.activePage.attr("id")&&c.sendFeedbackCommand()}),c.sendFeedbackCommand=function(){if(""!=c.feedback()&&"undefined"!=typeof c.feedback()){$.mobile.showPageLoadingMsg("a","Sending Feedback");var d={};return d.comments=c.feedback(),d.context=c.feedbackContext(),ES.systemService.sendFeedback(d,{success:a,error:b})}c.feedbackClass("validationerror"),c.error(!0),c.errorFeedback("<span>Sorry,</span> Please enter text above")}}function SendMessageViewModel(){function a(a){if(a.commethod.length>=1){var b=0;for(b;b<a.commethod.length;b++){if("Y"==a.commethod[b].verified)return f.createChannelMessage(),!0;if(b==a.commethod.length-1&&"N"==a.commethod[b].verified){var c={type:"toast-error",text:"Please verify your email !"};showToast(c)}}}else{var c={type:"toast-error",text:"Please add a default email !"};showToast(c)}}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}function c(a){if(0==a.channel.length)f.sectionOne(!0);else{f.sectionTwo(!0),$.mobile.hidePageLoadingMsg();for(var b=0;b<a.channel.length;b++)f.channels.push(new g(a.channel[b].name,a.channel[b].id,a.channel[b].followers))}}function d(){$.mobile.hidePageLoadingMsg(),f.messageText(""),ENYM.ctx.removeItem("msgLenWarn"),ENYM.ctx.removeItem("escDuration"),ENYM.ctx.removeItem("escLevel"),ENYM.ctx.removeItem("iGiStatus");var a={redirect:"channelMainView",type:"",text:"Your message has been sent."};showToast(a),ENYM.ctx.setItem("currentChannelId",f.selectedChannels().channelId),goToView("channelMainView")}function e(a,b,c){$.mobile.hidePageLoadingMsg(),ENYM.ctx.removeItem("escDuration"),ENYM.ctx.removeItem("escLevel"),ENYM.ctx.removeItem("iGiStatus");var d={type:"toast-error",text:c.message};showToast(d)}var f=this;f.template="sendMessageView",f.viewid="V-20",f.viewname="Compose",f.displayname="Compose Broadcast",f.sectionOne=ko.observable(!1),f.sectionTwo=ko.observable(!1),f.noWarning=ko.observable(!0),f.warning=ko.observable(!1),f.escalateEdit=ko.observable(!1),f.channels=ko.observableArray([]),f.messageText=ko.observable(),f.characterCount=ko.observable(),f.igiClass=ko.observable(),f.iGiYes=ko.observable(),f.iGiNo=ko.observable(),f.yesClass=ko.observable(),f.noClass=ko.observable(),f.inputObs=["channelId","channelName","characterClass","normalText","fastText","escalateText","normalClass","fastClass","escalateClass","normalActive","fastActive","escalateActive","escDuration","escLevel","duration","activeType","escalateEdit","broadcastType","selectedChannels"],f.defineObservables();var g=function(a,b,c){this.channelName=a,this.channelId=b,this.followerCount=c};f.composeForm=function(){f.messageText(""),f.channels.removeAll(),ENYM.ctx.removeItem("msgLenWarn"),ENYM.ctx.removeItem("escDuration"),ENYM.ctx.removeItem("escLevel"),ENYM.ctx.removeItem("iGiStatus")},f.activate=function(){if(monthNames=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"],addExternalMarkup(f.template),f.sectionOne(!1),f.sectionTwo(!1),f.noWarning(!0),f.warning(!1),f.normalText("normalcolor"),f.fastText(""),f.escalateText(""),f.normalClass("normalcoloricon"),f.fastClass(""),f.escalateClass(""),f.duration("Normal: <em>Send once (usually to email)</em>"),f.activeType("normalcolor"),f.yesClass("yesbutton"),f.noClass("nobutton"),f.escalateEdit(!1),f.escLevel("N"),f.igiClass("igiimageoff"),f.characterClass(""),(""==f.messageText()||"undefined"==typeof f.messageText())&&(f.characterCount("0"),$("#sendMessageView textarea").css("height","81")),f.escLevel(ENYM.ctx.getItem("escLevel")),escalate="H"==f.escLevel()?"Hound":"C"==f.escLevel()?"Chase":"Remind","yes"==ENYM.ctx.getItem("escalate")){if(f.normalText(""),f.fastText(""),f.escalateText(escalate),f.normalClass(""),f.fastClass(""),f.escalateClass("escalatecoloricon icon-"+escalate),ENYM.ctx.getItem("escDuration")){f.escDuration(ENYM.ctx.getItem("escDuration"));var a='"'+escalate+'" until: '+moment(ENYM.ctx.getItem("escDuration")).format("h:m A, MMM. D, YYYY");f.duration(a),f.activeType("escalatecolor "+escalate),f.escalateEdit(!0)}ENYM.ctx.removeItem("escalate")}else f.normalText("normalcolor"),f.fastText(""),f.escalateText(""),f.normalClass("normalcoloricon"),f.fastClass(""),f.escalateClass(""),f.duration("Normal: <em>Send once (usually to email)</em>"),f.activeType("normalcolor"),f.yesClass("yesbutton"),f.noClass("nobutton"),f.escalateEdit(!1),ENYM.ctx.removeItem("escDuration"),f.escLevel("N"),f.igiClass("igiimageoff");return f.broadcastType("FYI"),"yes"==ENYM.ctx.getItem("iGiStatus")&&(f.igiClass("igiimage"),f.yesClass("nobutton"),f.noClass("yesbutton"),f.broadcastType("RAC")),ENYM.ctx.getItem("msgLenWarn")&&(f.noWarning(!1),f.warning(!0),f.characterClass("length-warning"),f.characterCount(ENYM.ctx.getItem("msgLenWarn")),ENYM.ctx.removeItem("msgLenWarn")),$("textarea").keyup(function(){f.characterCount(f.messageText().length);var a=f.selectedChannels().channelName.length,b=299-a;f.messageText().length>b?(f.noWarning(!1),f.warning(!0),f.characterClass("length-warning")):(f.noWarning(!0),f.warning(!1),f.characterClass(""))}),"undefined"==typeof f.selectedChannels()||""==f.selectedChannels()?(f.channels.removeAll(),$.mobile.showPageLoadingMsg("a","Loading Channels options"),ES.channelService.listMyChannels({success:c,error:e})):(f.sectionOne(!1),void f.sectionTwo(!0))},$(document).keyup(function(a){13==a.keyCode&&"TEXTAREA"!=a.target.nodeName&&"sendMessageView"==$.mobile.activePage.attr("id")&&f.sendMessageCommand()}),f.sendMessageCommand=function(){if(""==f.messageText()||"undefined"==typeof f.messageText()){var c={type:"toast-error",text:"Please type a message to broadcast."};showToast(c)}else{if(0!=f.selectedChannels().followerCount)return $.mobile.showPageLoadingMsg("a","Posting Message"),ES.commethodService.getCommethods({success:a,error:b});var c={type:"toast-info",text:"Message not sent - Zero followers on "+f.selectedChannels().channelName};showToast(c)}},f.createChannelMessage=function(){if($.mobile.showPageLoadingMsg("a","Posting Message"),"N"==f.escLevel()||"F"==f.escLevel())var a={text:f.messageText(),escLevelId:f.escLevel(),type:f.broadcastType()};else var a={text:f.messageText(),escUntil:f.escDuration(),escLevelId:f.escLevel(),type:f.broadcastType()};return ES.messageService.createChannelMessage(f.selectedChannels().channelId,a,{success:d,error:e})},f.seeWarning=function(){ENYM.ctx.setItem("msgLenWarn",f.characterCount()),viewNavigate("Compose","sendMessageView","messageLengthWarningView")},f.requestiGiHelp=function(){viewNavigate("Compose","sendMessageView","requestiGiHelpView")},f.escalateHelp=function(){viewNavigate("Compose","sendMessageView","escalateHelpView")},f.normalYes=function(){f.normalText("normalcolor"),f.fastText(""),f.escalateText(""),f.normalClass("normalcoloricon"),f.fastClass(""),f.escalateClass(""),f.duration("Normal: <em>Send once (usually to email)</em>"),f.activeType("normalcolor"),f.escalateEdit(!1),ENYM.ctx.removeItem("escLevel"),ENYM.ctx.removeItem("escDuration"),f.escLevel("N")},f.fastYes=function(){f.normalText(""),f.fastText("fastcolor"),f.escalateText(""),f.normalClass(""),f.fastClass("fastcoloricon"),f.escalateClass(""),f.duration("Fast: <em>Send once (usually text or app)</em>"),f.activeType("fastcolor"),f.escalateEdit(!1),ENYM.ctx.removeItem("escLevel"),ENYM.ctx.removeItem("escDuration"),f.escLevel("F")},f.escalateYes=function(){viewNavigate("Compose","sendMessageView","escalateSettingsView")},f.iGiYes=function(){f.igiClass("igiimage"),f.yesClass("nobutton"),f.noClass("yesbutton"),f.broadcastType("RAC"),ENYM.ctx.setItem("iGiStatus","yes")},f.iGiNo=function(){f.igiClass("igiimageoff"),f.yesClass("yesbutton"),f.noClass("nobutton"),f.broadcastType("FYI"),ENYM.ctx.removeItem("iGiStatus")}}function SignupStepFirstViewModel(){function a(){return{emailaddress:h.emailaddress(),accountname:h.evernym(),password:h.password()}}function b(b){if(b)h.accountNameClass("validationerror"),h.errorAccountName("<span>Sorry,</span> This evernym has already been taken");
else{$.mobile.showPageLoadingMsg("a","Enrolling");var c={success:d,error:e},f=a();ES.loginService.accountEnroll(f,c)}}function c(){$.mobile.hidePageLoadingMsg(),h.errorPassword("<span>Sorry,</span> Please enter password")}function d(a){$.isEmptyObject(a)||h.guest(!1),$.mobile.hidePageLoadingMsg(),h.loginCommand()}function e(a,b,c){$.mobile.hidePageLoadingMsg(),"100930"==c.code&&(h.emailClass("validationerror"),h.errorEmail("<span>Sorry, </span> email used by another account"))}function f(a){$.mobile.hidePageLoadingMsg(),ES.evernymService.clearAccessToken(),ES.evernymService.setAccessToken(a.accessToken),ENYM.ctx.setItem("accountName",a.account.accountname),ENYM.ctx.setItem("newusername",h.evernym()),ENYM.ctx.setItem("newuseremail",h.emailaddress()),ENYM.ctx.setItem("evernym",1),1==h.guest()&&goToView("registrationVerifyView")}function g(a,b,c){$.mobile.hidePageLoadingMsg(),h.errorFirstLastName("<span>Sorry,</span> "+c.message),ES.evernymService.clearAccessToken()}var h=this;h.requiresAuth=!1,h.template="signupStepFirstView",h.viewid="V-02",h.viewname="Register",h.displayname="Register",h.inputObs=["evernym","password","emailaddress","guest"],h.errorObs=["errorEmail","errorAccountName","errorPassword","emailClass","accountNameClass","passwordClass"],h.defineObservables(),h.activate=function(){var a=ES.evernymService.getAccessToken();h.guest(!0),""==a||null==a?($("input").keyup(function(){h.clearErrorObs()}),ENYM.ctx.getItem("signupObj")&&(h.emailaddress(ENYM.ctx.getItem("signupObj").emailAddress),h.evernym(ENYM.ctx.getItem("signupObj").evernymName),ENYM.ctx.removeItem("signupObj"))):goToView("homeView")},$(document).keyup(function(a){13==a.keyCode&&"signupStepFirstView"==$.mobile.activePage.attr("id")&&h.nextViewCommand()}),h.nextViewCommand=function(){var a=/^[\+_a-zA-Z0-9-]+(\.[\+_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/,d=/^[a-zA-Z0-9]+$/;if(""!=h.emailaddress()&&a.test(h.emailaddress()))if(""==h.evernym())h.accountNameClass("validationerror"),h.errorAccountName("<span>Sorry,</span> Please enter Evernym name");else if(d.test(h.evernym()))if(h.evernym().length<5||h.evernym().length>25)h.accountNameClass("validationerror"),h.errorAccountName("<span>Sorry,</span> Evernym min. 5 and max. 25 characters");else if(""==h.password())h.passwordClass("validationerror"),h.errorPassword("<span>Sorry,</span> Please enter password");else{if(!(h.password().length<8))return $.mobile.showPageLoadingMsg("a","Checking Evernym availability"),ES.loginService.checkName(h.evernym(),{success:b,error:c});h.passwordClass("validationerror"),h.errorPassword("<span>Sorry,</span> Password of min. 8 characters")}else h.accountNameClass("validationerror"),h.errorAccountName("<span>Sorry,</span> Letters and numbers only, no spaces.");else h.emailClass("validationerror"),h.errorEmail("<span>Sorry,</span> Please enter valid email")},h.loginCommand=function(){$.mobile.showPageLoadingMsg("a","Logging in with new credentials");var a={success:f,error:g},b={};b.accountname=h.evernym(),b.appToken="sNQO8tXmVkfQpyd3WoNA6_3y2Og=",b.overrideTtl=3600,b.password=h.password(),ES.loginService.accountLogin(b,a)},h.privacyPolicy=function(){var a={emailAddress:h.emailaddress(),evernymName:h.evernym()};ENYM.ctx.setItem("signupObj",a),goToView("privacyPolicyView")}}function SignupStepSecondViewModel(){function a(){return{emailaddress:ENYM.ctx.getItem("newuseremail"),accountname:ENYM.ctx.getItem("newusername"),password:ENYM.ctx.getItem("newuserpassword"),firstname:f.firstname(),lastname:f.lastname()}}function b(){$.mobile.hidePageLoadingMsg(),f.loginCommand()}function c(a,b,c){$.mobile.hidePageLoadingMsg(),ENYM.ctx.setItem("signUpError",c.message),goToView("signupStepFirstView")}function d(a){$.mobile.hidePageLoadingMsg(),ES.evernymService.clearAccessToken(),ES.evernymService.setAccessToken(a.accessToken),ENYM.ctx.setItem("accountName",a.account.accountname),goToView("registrationVerifyView")}function e(a,b,c){$.mobile.hidePageLoadingMsg(),f.errorFirstLastName("<span>Sorry,</span> "+c.message),ES.evernymService.clearAccessToken()}var f=this;this.template="signupStepSecondView",this.viewid="V-02b",this.viewname="Register",this.displayname="Register",this.firstname=ko.observable(),this.lastname=ko.observable(),this.errorFirstName=ko.observable(),this.errorFirstLastName=ko.observable(),this.firstnameClass=ko.observable(),this.lastnameClass=ko.observable(),this.applyBindings=function(){$("#"+this.template).on("pagebeforeshow",function(){f.clearForm(),f.activate()})},this.clearForm=function(){f.firstname(""),f.lastname(""),f.errorFirstName(""),f.errorFirstLastName("")},this.activate=function(){var a=ES.evernymService.getAccessToken(),b=ENYM.ctx.getItem("newusername");""==a||null==a?$("input").keyup(function(){f.firstnameClass(""),f.lastnameClass(""),f.errorFirstName(""),f.errorFirstLastName("")}):goToView(""==b||null==b?"homeView":"tutorialView")},$(document).keyup(function(a){13==a.keyCode&&"signupStepSecondView"==$.mobile.activePage.attr("id")&&f.signUpCommand()}),this.signUpCommand=function(){if(""==f.firstname())f.firstnameClass("validationerror"),f.errorFirstName("<span>Sorry,</span> Please enter first name");else if(f.firstname().length>20)f.firstnameClass("validationerror"),f.errorFirstName("<span>Sorry,</span> Please enter name of max. 20 characters");else if(""==f.lastname())f.lastnameClass("validationerror"),f.errorFirstLastName("<span>Sorry,</span> Please enter last name");else if(f.lastname().length>20)f.lastnameClass("validationerror"),f.errorFirstLastName("<span>Sorry,</span> Please enter name of max. 20 characters");else{$.mobile.showPageLoadingMsg("a","Enrolling");var d={success:b,error:c},e=a();ES.loginService.accountEnroll(e,d)}},this.loginCommand=function(){$.mobile.showPageLoadingMsg("a","Logging In With New Credentials");var a={success:d,error:e},b={};b.accountname=ENYM.ctx.getItem("newusername"),b.password=ENYM.ctx.getItem("newuserpassword"),b.appToken="sNQO8tXmVkfQpyd3WoNA6_3y2Og=",ES.loginService.accountLogin(b,a)}}function SingleFeedbackViewModel(){var a=this;a.template="singleFeedbackView",a.viewid="V-47",a.viewname="Single Feedback",a.displayname="Single Feedback",a.inputObs=["created","feedback","context"],a.defineObservables(),a.activate=function(){addExternalMarkup(a.template),a.showFeedback()},a.showFeedback=function(){var b=ENYM.ctx.getItem("singleFeedback");a.feedback(b.comments),a.created(b.created),a.context(b.context)}}function SingleMessageFullTextViewModel(){var a=this;a.template="singleMessageFullTextView",a.viewid="V-23",a.viewname="Full Msg",a.displayname="Broadcast Full Text",a.inputObs=["channelName","time","fullText"],a.defineObservables(),a.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData")),c=JSON.parse(ENYM.ctx.getItem("currentMessageData"));if(b&&c){addExternalMarkup(a.template);var b=JSON.parse(ENYM.ctx.getItem("currentChannelData")),c=JSON.parse(ENYM.ctx.getItem("currentMessageData"));a.channelName(b.channelName);var d=formatDate(c.created,"long");a.time("Sent - "+d),a.fullText(c.broadcastFull.replace(/\n/g,"<br/>"))}else goToView("channelsIOwnView")}}function SingleMessageRepliesViewModel(){function a(a){var b,d;$.mobile.hidePageLoadingMsg();for(var e=0;e<a.message.length;e++){"undefined"==typeof a.message[e].senderFirstname&&"undefined"==typeof a.message[e].senderLastname?(b="Evernym",d=""):(b=a.message[e].senderFirstname,d=a.message[e].senderLastname);var f="<em>"+b+" "+d+": </em>"+a.message[e].text;if(a.message[e].text.length>truncatedTextScreen())var g=$.trim(a.message[e].text).substring(0,2*truncatedTextScreen()).split(" ").slice(0,-1).join(" ")+"...";else var g=a.message[e].text;c.msgReplies.push({replyId:a.message[e].id,senderSubscriberId:a.message[e].senderSubscriberId,responseToMsgId:a.message[e].responseToMsgId,created:a.message[e].created,replyTime:formatDate(a.message[e].created,"short","main"),reply:f,replyLess:g.replace(/\n/g,"<br/>"),replyFull:a.message[e].text.replace(/\n/g,"<br/>"),senderFirstname:a.message[e].senderFirstname,senderLastname:a.message[e].senderLastname,replyToReply:a.message[e].replies})}}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="singleMessageRepliesView",c.viewid="V-56",c.viewname="Replies",c.displayname="Broadcast Replies",c.msgReplies=ko.observableArray([]),c.inputObs=["channelName","channelId","messageId","time","singleMessage","broadcastType","iGi","percentageText","percentageClass","percentage","noiGi","noacks","acks","escalateUntil","replies"],c.defineObservables(),c.noacksVisibility=ko.observable(!1),c.acksVisibility=ko.observable(!1),c.escalateTime=ko.observable(!1),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData")),e=JSON.parse(ENYM.ctx.getItem("currentMessageData"));return d&&e?(addExternalMarkup(c.template),c.msgReplies.removeAll(),c.time("Sent - "+formatDate(e.created,"long")),c.singleMessage("<span>"+e.broadcastFull+"</span><em></em>"),c.broadcastType(e.type),c.iGi(e.iGi),c.percentageText(e.percentageText),c.percentageClass(e.percentageClass),c.percentage(e.percentage),c.noiGi(e.noiGi),c.noacksVisibility(!1),c.acksVisibility(!1),c.escalateTime(!1),""!=e.escUntil&&"undefined"!=typeof e.escUntil&&(c.escalateTime(!0),c.escalateUntil('<span class="singlemsgicon '+e.sensitivity+'"></span>"'+e.sensitivityText+'" until '+formatDate(e.escUntil,"short","main"))),c.replies(e.replies),"REQUEST_ACKNOWLEDGEMENT"==e.type&&"undefined"!=typeof e.noacks&&(e.acks+e.noacks==e.acks?(c.noacksVisibility(!1),c.acksVisibility(!0),c.acks(e.acks+" Got It")):(c.noacksVisibility(!0),c.acksVisibility(!0),c.noacks(e.noacks+" Haven't Got It Yet"),c.acks(e.acks+" Got It"))),ENYM.ctx.removeItem("currentReplyData"),c.channelId(d.channelId),c.channelName(d.channelName),c.messageId(e.messageId),$.mobile.showPageLoadingMsg("a","Loading Message replies"),ES.messageService.getChannelMessages(c.channelId(),{replyto:c.messageId()},{success:a,error:b})):void goToView("channelsIOwnView")},c.showWhoGotIt=function(){if("REQUEST_ACKNOWLEDGEMENT"!=c.broadcastType()){var a={type:"toast-info",text:"No iGi requested"};showToast(a)}else if("0 Got It"==c.acks()){var a={type:"toast-info",text:"No iGi's received yet"};showToast(a)}else viewNavigate("Replies","singleMessageRepliesView","whoGotItView")},c.replyDetail=function(a){ENYM.ctx.setItem("currentReplyData",JSON.stringify(a)),viewNavigate("Replies","singleMessageRepliesView","replyDetailView")}}function SingleMessageViewModel(){var a=this;a.template="singleMessageView",a.viewid="V-23",a.viewname="Broadcast Details",a.displayname="Broadcast Details",a.inputObs=["channelName","time","singleMessage","broadcastType","iGi","percentageText","percentageClass","percentage","noiGi","noacks","acks","escalateUntil","replies"],a.defineObservables(),a.noacksVisibility=ko.observable(!1),a.acksVisibility=ko.observable(!1),a.escalateTime=ko.observable(!1),a.activate=function(){var b=JSON.parse(ENYM.ctx.getItem("currentChannelData")),c=JSON.parse(ENYM.ctx.getItem("currentMessageData"));b&&c?(addExternalMarkup(a.template),a.channelName(b.channelName),a.time("Sent - "+formatDate(c.created,"long")),a.singleMessage("<span>"+c.broadcastFull+"</span><em></em>"),a.broadcastType(c.type),a.iGi(c.iGi),a.percentageText(c.percentageText),a.percentageClass(c.percentageClass),a.percentage(c.percentage),a.noiGi(c.noiGi),a.noacksVisibility(!1),a.acksVisibility(!1),a.escalateTime(!1),""!=c.escUntil&&"undefined"!=typeof c.escUntil&&(a.escalateTime(!0),a.escalateUntil('<span class="singlemsgicon '+c.sensitivity+'"></span>"'+c.sensitivityText+'" until '+formatDate(c.escUntil,"short","main"))),a.replies(c.replies),"REQUEST_ACKNOWLEDGEMENT"==c.type&&"undefined"!=typeof c.noacks&&(c.acks+c.noacks==c.acks?(a.noacksVisibility(!1),a.acksVisibility(!0),a.acks(c.acks+" Got It")):(a.noacksVisibility(!0),a.acksVisibility(!0),a.noacks(c.noacks+" Haven't Got It Yet"),a.acks(c.acks+" Got It")))):goToView("channelsIOwnView")},a.showReplies=function(){if("0 Replies"==a.replies()){var b={type:"toast-info",text:"No replies to display"};showToast(b)}else viewNavigate("Broadcast Details","singleMessageView","singleMessageRepliesView")},a.showWhoGotIt=function(){if("REQUEST_ACKNOWLEDGEMENT"!=a.broadcastType()){var b={type:"toast-info",text:"No iGi requested"};showToast(b)}else if("0 Got It"==a.acks()){var b={type:"toast-info",text:"No iGi's received yet"};showToast(b)}else viewNavigate("Broadcast Details","singleMessageView","whoGotItView")}}function TutorialViewModel(){var a=this;a.template="tutorialView",a.viewid="V-51",a.viewname="Introduction",a.displayname="Introduction to Evernym Channels",a.activate=function(){function a(a,b,c){$(a).on(b,function(){$("header ul li").removeClass("active");var b=$(this)[c](a).attr("id");$(this).hide(),"undefined"==typeof b&&(b=$(this).attr("id")),$("header ul li#"+b+"Active").addClass("active"),$("#"+b).show()})}function b(a,b,c){$(a).on("click",function(){$("header ul li").removeClass("active"),$(c).hide();var a=$(this).parent()[b]("div "+c).attr("id");"undefined"==typeof a&&(a=$(this).parent().attr("id")),$("#"+a).show(),$("header ul li#"+a+"Active").addClass("active")})}$(".tutorial ul li").removeClass("active"),$(".tutorial ul li:first-child").addClass("active"),$(".tutorials .tutorialslides").hide(),$(".tutorials .tutorialslides:first-child").show(),a("div.tutorialslides","swipeleft","next"),a("div.tutorialslides","swiperight","prev"),b("div.new-user","next","div.tutorialslides"),$("img").on("dragstart",function(a){a.preventDefault()})},a.getStartedCommand=function(){goToView("userGuideView")}}function UnreachableFollowersViewModel(){function a(a){$.mobile.hidePageLoadingMsg(),$.each(a.followers,function(a,b){if("N"==b.reachable&&"F"==b.relationship){var d=!0,e=!1,f="normalfollowers noverified";if("N"==b.managed)var e=!0;if("undefined"==typeof b.firstname&&"undefined"==typeof b.lastname)"Y"==b.managed?g=b.comMethods[0].address:(g="","N"==b.reachable&&"N"==b.managed&&(g=b.accountname)),d=!1;else if("undefined"==typeof b.firstname)var g=b.lastname;else if("undefined"==typeof b.lastname)var g=b.firstname;else var g=b.firstname+" "+b.lastname;c.followers.push({followerId:b.id,nameClass:f,visibleName:d,followerName:g,accountname:b.accountname,reachable:"Un-reachable Follower",evernym:!0,evernymIcon:e,type:b.managed}),c.unreachCount(c.followers().length)}})}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="unreachableFollowersView",c.viewid="V-??",c.viewname="Unreachable",c.displayname="Unreachable Followers",c.evernymIcon=ko.observable(!1),c.inputObs=["channelId","channelName","unreachCount"],c.defineObservables(),c.followers=ko.observableArray([]),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData"));return d?(addExternalMarkup(c.template),c.evernymIcon(!1),c.followers.removeAll(),c.unreachCount(""),c.channelId(d.channelId),c.channelName(d.channelName),$.mobile.showPageLoadingMsg("a","Loading Invited Followers"),ES.channelService.getFollowers(c.channelId(),{success:a,error:b})):void goToView("channelsIOwnView")},c.followerDetails=function(a){ENYM.ctx.setItem("currentfollowerData",JSON.stringify(a)),viewNavigate("Unreachable","unreachableFollowersView","followerDetailsView")}}function UserGuideViewModel(){var a=this;a.template="userGuideView",a.viewid="V-??",a.viewname="User Guide",a.displayname="User Guide",a.sectionOne=ko.observable(!0),a.sectionTwo=ko.observable(!1),a.activate=function(){a.sectionOne(!0),a.sectionTwo(!1),addExternalMarkup(a.template)},a.goToNext=function(){a.sectionOne(!1),a.sectionTwo(!0)},a.okGotIt=function(){ENYM.ctx.removeItem("newuseremail"),ENYM.ctx.removeItem("newusername"),ENYM.ctx.removeItem("newuserpassword");var a=JSON.parse(ENYM.ctx.getItem("action"));a&&"Y"==a.follow_channel?(ENYM.ctx.removeItem("action"),goToView("channelsFollowingListView")):ENYM.ctx.getItem("evernymIntro")?(ENYM.ctx.removeItem("evernymIntro"),goToView("userSettingsView")):goToView("homeView")}}function UserSettingsViewModel(){function a(a){a.escPaths.length&&$.each(a.escPaths,function(a,b){var c=[];$.each(b.steps,function(a,b){var d=0,e=b.comMethodType;$.each(b.retries,function(a,b){d+=b.totalDuration/b.interval}),$.each(g.defaultCommethods,function(a,c){c.type==b.comMethodType&&"Y"==c.dflt&&(e=c.address,"Y"==c.verified)}),c.push({comMethodName:e,comMethodRetries:d+" Retries"})}),g.escalationplans.push({urgencyName:b.urgencyName.toLowerCase(),commethods:c})})}function b(){}function c(){}function d(a){g.defaultCommethods=a.commethod}function e(){ES.evernymService.clearAccessToken(),ENYM.ctx.removeItem("newuseremail"),ENYM.ctx.removeItem("newusername"),ENYM.ctx.removeItem("newuserpassword"),ENYM.ctx.removeItem("signUpError"),backNavText=[],backNavView=[],ENYM.ctx.removeItem("backNavText"),ENYM.ctx.removeItem("backNavView"),ENYM.ctx.removeItem("roleType"),goToView("loginView")}function f(){}var g=this;g.template="userSettingsView",g.viewid="V-081",g.viewname="Settings",g.displayname="User Settings",g.channels=ko.observableArray([]),g.commethods=ko.observableArray([]),g.escalationplans=ko.observableArray([]),g.comMethodType=ko.observable("EMAIL"),g.inputObs=["baseUrl","firstname","lastname","newComMethod","newComMethodName","navText","roleType"],g.defineObservables(),g.pView="",g.defaultCommethods="",g.getEscPlans=function(){return ES.escplanService.getEscPlans({success:b,error:c})},g.activate=function(){addExternalMarkup(g.template);var b=ENYM.ctx.getItem("baseUrl"),c=ENYM.ctx.getItem("previousView");console.log("previousView: "+c);var e=ko.dataFor($("#"+c).get(0));if(console.log("previousView Model viewid: "+e.displayname),g.navText(e.displayname),g.pView=c,g.roleType(ENYM.ctx.getItem("roleType")?!0:!1),b)g.baseUrl(b);else{var f=new EvernymService;g.baseUrl(f.getBaseUrl())}return g.escalationplans.removeAll(),g.getCommethods().then(d),$.mobile.showPageLoadingMsg("a","Loading Escalation Plans"),g.getEscPlans().then(a)},g.getCommethods=function(){$.mobile.showPageLoadingMsg("a","Getting Communication Methods");var a={success:function(){},error:function(){}};return ES.commethodService.getCommethods(a)},g.evernymIntro=function(){ENYM.ctx.setItem("evernymIntro",1),goToView("tutorialView")},g.logoutCommand=function(){var a=ES.evernymService.getAccessToken();if(a){var b={success:e,error:f};ES.loginService.accountLogout(b),g.cleanApplication()}},g.cleanApplication=function(){ES.evernymService.clearAccessToken(),ENYM.ctx.removeItem("login_nav"),ENYM.ctx.removeItem("currentChannel"),ENYM.ctx.removeItem("accountName"),ENYM.ctx.removeItem("account"),ENYM.ctx.removeItem("name"),ENYM.ctx.removeItem("currentChannelData"),ENYM.ctx.removeItem("enymNotifications"),ES.systemService.MnsCacheData={},ES.systemService.MnsLastUpdated=0,sendMessageViewModel.composeForm()}}function VerifyContactViewModel(){var a=this;a.template="verifyContactView",a.viewid="V-10",a.viewname="Verify Contact",a.displayname="Verify Contact",a.hasfooter=!0,a.inputObs=["verificationCommethod","verificationCommethodType","verificationCommethodID","verificationCode","verificationStatus"],a.errorObs=["verificationClass","errorMessage"],a.defineObservables(),a.activate=function(){var b,c;addExternalMarkup(a.template),a.verificationCommethod(ENYM.ctx.getItem("currentVerificationCommethod")),a.verificationCommethodID(ENYM.ctx.getItem("currentVerificationCommethodID")),a.verificationStatus(ENYM.ctx.getItem("verificationStatus")),$("input").keyup(function(){a.clearErrorObs()}),0==a.verificationStatus()?(a.verificationStatus(!1),b="To verify, click on the link (or enter the code below) from the message sent to you previously.",c="To verify, enter the code below from the message sent to you previously."):(a.verificationStatus(!0),b="We have sent you a confirmation message. Verify by clicking on the link (or enter the code below).",c="We have sent you a confirmation message. Verify by entering the code below."),a.verificationCommethodType("EMAIL"==ENYM.ctx.getItem("commethodType")?b:c)},$(document).keyup(function(b){13==b.keyCode&&"verifyContactView"==$.mobile.activePage.attr("id")&&a.getCommethods()}),a.gotoView=function(){ENYM.ctx.removeItem("currentVerificationCommethodID"),goToView("addContactView")},a.getCommethods=function(){$.mobile.showPageLoadingMsg("a","Sending Verification Request");var b={success:function(b){for(var c=0;c<b.commethod.length;c++)if(b.commethod[c].id==a.verificationCommethodID())if("Y"==b.commethod[c].verified){if("TEXT"==ENYM.ctx.getItem("commethodType"))var d="Phone number already verified";else var d="Email already verified";ENYM.ctx.removeItem("commethodType");var e={redirect:"addContactView",type:"toast-info",text:d};showToast(e),goToView("addContactView")}else a.verifyRequestCommethod()},error:function(b,c,d){a.verificationClass("validationerror"),a.errorMessage("<span>ERROR: </span> "+d.message)}};return ES.commethodService.getCommethods(b)},a.verifyRequestCommethod=function(){if(""==a.verificationCode())a.verificationClass("validationerror"),a.errorMessage("<span>ERROR: </span> Please input verification code!");else if(6!=a.verificationCode().length)a.verificationClass("validationerror"),a.errorMessage("<span>ERROR: </span> Verification code should be 6 digits!");else{var b={code:a.verificationCode(),type:a.verificationCommethodType,address:a.verificationCommethod()};a.verifyRequest(b)}},a.requestVerificationCode=function(){var b={success:function(){var a={type:"",text:"Verification code sent"};showToast(a)},error:function(b,c,d){a.verificationClass("validationerror"),a.errorMessage("<span>ERROR: </span> "+d.message)}};return $.mobile.showPageLoadingMsg("a","Sending Verification Request"),ES.commethodService.requestVerification(a.verificationCommethodID(),b)},a.verifyRequest=function(b){var c={success:function(){if("TEXT"==ENYM.ctx.getItem("commethodType"))var a="Phone number verified";else var a="Email verified";ENYM.ctx.removeItem("commethodType");var b={redirect:"addContactView",type:"",text:a};showToast(b),goToView("addContactView")},error:function(b,c,d){if("100912"==d.code){if("TEXT"==ENYM.ctx.getItem("commethodType"))var e="Phone number already verified";else var e="Email already verified";ENYM.ctx.removeItem("commethodType");var f={redirect:"addContactView",type:"toast-info",text:e};showToast(f),goToView("addContactView")}else a.errorMessage("<span>ERROR: </span>"+d.message)}};return ES.commethodService.verification(b.code,c,ES.evernymService.getAccessToken())}}function WhoGotItViewModel(){function a(a){$.mobile.hidePageLoadingMsg();for(var b=0;b<a.recipients.length;b++){if("undefined"==typeof a.recipients[b].rcvrFirstname&&"undefined"==typeof a.recipients[b].rcvrLastname?(rcvrFirstname="",rcvrLastname=""):(rcvrFirstname=a.recipients[b].rcvrFirstname,rcvrLastname=a.recipients[b].rcvrLastname+","),b%2===0)var d="even";else var d="odd";c.recipients.push({recipientId:a.recipients[b].subscriberId,recipientsClass:d,recipient:rcvrFirstname+" "+rcvrLastname+" <em>"+a.recipients[b].rcvrAccountname+"</em>"})}}function b(a,b,c){$.mobile.hidePageLoadingMsg();var d={type:"toast-error",text:c.message};showToast(d)}var c=this;c.template="whoGotItView",c.viewid="V-34",c.viewname="Who Got it",c.displayname="Who got iGi",c.recipients=ko.observableArray([]),c.inputObs=["channelName","channelId","messageId","time","singleMessage","broadcastType","iGi","percentageText","percentageClass","percentage","noiGi","noacks","acks","escalateUntil","replies"],c.defineObservables(),c.noacksVisibility=ko.observable(!1),c.acksVisibility=ko.observable(!1),c.escalateTime=ko.observable(!1),c.activate=function(){var d=JSON.parse(ENYM.ctx.getItem("currentChannelData")),e=JSON.parse(ENYM.ctx.getItem("currentMessageData"));return d&&e?(addExternalMarkup(c.template),c.recipients.removeAll(),c.time("Sent - "+formatDate(e.created,"long")),c.singleMessage("<span>"+e.broadcastFull+"</span><em></em>"),c.broadcastType(e.type),c.iGi(e.iGi),c.percentageText(e.percentageText),c.percentageClass(e.percentageClass),c.percentage(e.percentage),c.noiGi(e.noiGi),c.noacksVisibility(!1),c.acksVisibility(!1),c.escalateTime(!1),""!=e.escUntil&&"undefined"!=typeof e.escUntil&&(c.escalateTime(!0),c.escalateUntil('<span class="singlemsgicon '+e.sensitivity+'"></span>"'+e.sensitivityText+'" until '+formatDate(e.escUntil,"short","main"))),c.replies(e.replies),"REQUEST_ACKNOWLEDGEMENT"==e.type&&"undefined"!=typeof e.noacks&&(e.acks+e.noacks==e.acks?(c.noacksVisibility(!1),c.acksVisibility(!0),c.acks(e.acks+" Got It")):(c.noacksVisibility(!0),c.acksVisibility(!0),c.noacks(e.noacks+" Haven't Got It Yet"),c.acks(e.acks+" Got It"))),ENYM.ctx.removeItem("currentRecipientData"),c.channelId(d.channelId),c.channelName(d.channelName),c.messageId(e.messageId),c.acks(e.acks?e.acks+" Got It":0==e.acks?e.acks+" Got It":"REQUEST_ACKNOWLEDGEMENT"!=e.type?"No iGi requested":"No followers to acknowledge iGi!"),$.mobile.showPageLoadingMsg("a","Loading Followers"),ES.messageService.getMessageRecipients(c.channelId(),c.messageId(),"Y",{success:a,error:b})):void goToView("channelsIOwnView")},c.recipientDetails=function(a){ENYM.ctx.setItem("currentRecipientData",JSON.stringify(a)),viewNavigate("Who Got it","whoGotItView","recipientDetailsView")}}function successHandler(a){alert("result = "+a)}function errorHandler(){}function tokenHandler(a){showError("device token = "+a),submitFeedbackForRegid(a),addNewPushComMethod(a,"APN"),console.log("device token = "+a)}function registerPushNotifications(){pushNotification=window.plugins.pushNotification,"android"==device.platform||"Android"==device.platform?pushNotification.register(successHandler,errorHandler,{senderID:"819327889157",ecb:"onNotificationGCM"}):pushNotification.register(tokenHandler,errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"})}function errorAddingPushComMethod(a,b,c){$.mobile.hidePageLoadingMsg(),showError("Error Adding Push Com Method: "+c.message)}function addNewPushComMethod(a,b){var c={success:function(){alert("success")},error:errorAddingPushComMethod},d={name:device.name,type:"PUSH",address:b+":"+a};ES.commethodService.addCommethod(d,c)}function submitFeedbackForRegid(a){function b(){}function c(a,b,c){showError("Error Sending Feedback: "+(500==b?"Internal Server Error":c.message))}var d=JSON.stringify({regid:a,uuid:device.uuid,name:device.name,platform:device.platform,model:device.model,version:device.version,cordova:device.cordova}),e={success:b,error:c},f={comments:d,context:"app start"};ES.systemService.sendFeedback(f,e)}function onNotificationAPN(a){if(alert(JSON.stringify(a)),a.alert){var b="single";if("single"==b){var c=a.channelid,d=a.messageid;$.mobile.changePage("#singleMessageView?id="+d+"&channeid="+c,{allowSamePageTransition:!0})}else"multiplesame"==b?$.mobile.changePage("#channelView?id="+c,{allowSamePageTransition:!0}):"multiplevarious"==b&&OVERLAY.show()}a.sound,a.badge&&pushNotification.setApplicationIconBadgeNumber(successHandler,errorHandler,a.badge)}function onNotificationGCM(a){switch(a.event){case"registered":a.regid.length>0&&(submitFeedbackForRegid(a.regid),addNewPushComMethod(a.regid,"GCM"),console.log("regid = "+a.regid));break;case"message":if(a.foreground)alert(JSON.stringify(a));else if(alert(JSON.stringify(a)),a.coldstart);else{var b="single";if("single"==b){var c=a.payload.channelid,d=a.payload.messageid;$.mobile.changePage("#singleMessageView?id="+d+"&channeid="+c,{allowSamePageTransition:!0})}else"multiplesame"==b?$.mobile.changePage("#channelView?id="+c,{allowSamePageTransition:!0}):"multiplevarious"==b&&OVERLAY.show()}break;case"error":alert("error");break;default:alert("a notification event was passed but we do not know what it is")}}function goToView(a){$.mobile.changePage("#"+a,{allowSamePageTransition:!0})}function goToChannel(a){startBroadcast(a.value)}function inviteFollowers(){var a=channelListViewModel.channels().length,b=getCurrentViewModel();a?1==a?(ENYM.ctx.setItem("currentChannel",JSON.stringify(channelListViewModel.channels()[0])),$.mobile.changePage("#inviteFollowersView",{allowSamePageTransition:!0})):b.isChannelView?$.mobile.changePage("#inviteFollowersView",{allowSamePageTransition:!0}):$.mobile.changePage("#channelListView",{allowSamePageTransition:!0}):showError("First create a channel, then you can invite followers to it.<br/> <button onclick=\"goToView('channelNewView');closeError();\">create channel</button><br/>")}function initiateBroadcast(){var a=channelListViewModel.channels().length,b=getCurrentViewModel();if(a)if(1==a)startBroadcast(channelListViewModel.channels()[0].normName);else if(b.isChannelView){var c=ENYM.ctx.getItem("currentChannel"),d=JSON.parse(c);startBroadcast(d.normName)}else $.mobile.changePage("#channelListView",{allowSamePageTransition:!0});else showError("First create a channel, then you can send an alert to it.<br/> <button onclick=\"goToView('channelNewView');closeError();\">create channel</button><br/>")}function startBroadcast(a){$.mobile.activePage.find("#mypanel").panel("close"),$.mobile.changePage("#"+channelMenuViewModel.template),channelMenuViewModel.activate({id:a},"newbroadcast")}function showMessage(a){$("<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h3>"+a+"</h3></div>").css({display:"block",opacity:.9,position:"fixed",padding:"7px","text-align":"center",width:"270px",left:($(window).width()-284)/2,top:$(window).height()/2}).appendTo($.mobile.pageContainer).delay(1500).fadeOut(400,function(){$(this).remove()})}function closeError(){$("#errordiv").fadeOut(400,function(){$(this).remove()})}function showError(a){var b=$("#errordiv").get(0);b||$("<div id='errordiv' class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h3>"+a+"<br/><button onclick='closeError();' style='font-size:16pt;'>ok</button></h3></div>").css({display:"block",opacity:.9,position:"fixed",padding:"7px","text-align":"center",width:"270px",left:($(window).width()-284)/2,top:$(window).height()/2}).appendTo($.mobile.pageContainer).delay(1500)}function closeFeedback(){$("#feedbackdiv").fadeOut(400,function(){$(this).remove()})}function submitFeedback(){function a(){$("#feedbackdiv").fadeOut(400,function(){$(this).remove(),showMessage("Thanks. Your feedback has been submitted for the page: "+d+" "+e)})}function b(a,b,c){$.mobile.hidePageLoadingMsg(),showError(loginPageIfBadLogin(c.code)?"Please log in or register to view this channel.":"Error Sending Feedback: "+(500==b?"Internal Server Error":c.message))}var c=getCurrentViewModel(),d=c.viewid,e=c.viewname,f={success:a,error:b},g=$("#feedbacktextarea").val(),h={comments:g,context:d+" "+e};ES.systemService.sendFeedback(h,f)}function getCurrentViewModel(){var a=ko.dataFor($.mobile.activePage.get(0));return a}function showFeedback(){var a=$("#feedbackdiv").get(0);a||$("<div id='feedbackdiv' class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><textarea id='feedbacktextarea' style='width:250px;height:70px;resize:none;'></textarea><br/><button onclick='submitFeedback();'>Submit</button>&nbsp;&nbsp;<button onclick='closeFeedback();'>Cancel</button><br/></div>").css({display:"block",opacity:.9,position:"fixed",padding:"7px","text-align":"center",width:"270px",left:($(window).width()-284)/2,top:"20px"}).appendTo($.mobile.pageContainer).delay(1500)}function convDate(a){var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=new Date,d=c.getTimezoneOffset(),a=new Date(a+d),e=a.getMonth(),f=a.getDate(),g=a.getHours(),h=a.getMinutes(),i=(a.getSeconds(),b[e]+" "+f+", "+a.getFullYear()+", "+(0==g||12==g?12:g%12)+":"+((""+h).length<2?"0":"")+h+" "+(12>g?"am":"pm"));return i}function isBadLogin(a){var b=[100110,100201,100202,100203,100400],c=!1;return-1!=b.indexOf(a)&&(c=!0),c}function loginPageIfBadLogin(a){var b=isBadLogin(a);return b&&$.mobile.changePage("#"+loginViewModel.template),b}function getClassName(a){return a.constructor.name}function getHTMLName(a){var b=getClassName(a).replace("Model","");
return b.charAt(0).toUpperCase()+b.slice(1)+".html"}function getViewName(a){var b=getClassName(a);return b.charAt(0).toLowerCase()+b.slice(1).replace("Model","")}function loadAllPages(){var a,b,c=[];for(a=0,b=models.length;b>a;a+=1){var d=getHTMLName(models[a]);console.log("loading page: "+d);var e=$.mobile.loadPage("views/"+d,{pageContainer:$("#allpages"),allowSamePageTransition:!0});c.push(e)}return $.when.apply($,c).done(function(){for(a=0,b=models.length;b>a;a+=1){var c=(getClassName(models[a]),models[a]),d=getViewName(c);console.log("binding ko: "+d),ko.applyBindings(c,document.getElementById(d)),c.applyBindings&&c.applyBindings()}})}function viewNavigate(a,b,c){$.mobile.activePage.attr("id")!=c&&backNavView[backNavView.length-1]!=b&&(backNavText.push(a),ENYM.ctx.setItem("backNavText",JSON.stringify(backNavText)),backNavView.push(b),ENYM.ctx.setItem("backNavView",JSON.stringify(backNavView))),$("#"+$.mobile.activePage.attr("id")+" .toast-notification").html(""),$.mobile.changePage("#"+c,{allowSamePageTransition:!0})}function popBackNav(){backNavText.pop(),ENYM.ctx.removeItem("backNavText"),ENYM.ctx.setItem("backNavText",JSON.stringify(backNavText));var a=goToView(backNavView.pop());ENYM.ctx.removeItem("backNavView"),ENYM.ctx.setItem("backNavView",JSON.stringify(backNavView)),$.mobile.changePage("#"+a,{allowSamePageTransition:!0})}function showToast(a){a.redirect?$("#"+a.redirect+" .toast-notification").html('<div class="toast-text '+a.type+'">'+a.text+"</div>"):$("#"+$.mobile.activePage.attr("id")+" .toast-notification").html('<div class="toast-text '+a.type+'">'+a.text+"</div>");var b=new Date;b=b.getTime(),diff=b-last,diff>4e3||"undefined"==typeof last?$(".toast-notification").delay(500).slideDown(500,function(){$(".toast-notification").show()}).delay(1800).slideUp(700,function(){$("#"+$.mobile.activePage.attr("id")+" .toast-notification").html("")}):($(" .toast-notification").show(),setTimeout(function(){$(" .toast-notification").slideUp(1e3)},1e3)),last=b}function _getDate(a){var b=new Date;return b[a]()}function formatDate(a,b,c){"undefined"==typeof a&&(a=new Date),"undefined"==typeof b&&(b="short"),"undefined"==typeof c&&(c="");var d,e=new Date(moment(a)),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=e.getFullYear(),i=e.getMonth(),j=e.getDate(),k=e.getDay(),l=e.getHours(),m=e.getMinutes(),n=(new Date).getDate(),o=(new Date).getFullYear();switch(b){case"short":d=j==n?"follow"==c||"main"==c?"TODAY, "+(0==l||12==l?12:l%12)+":"+((""+m).length<2?"0":"")+m+" "+(12>l?"AM":"PM"):(0==l||12==l?12:l%12)+":"+((""+m).length<2?"0":"")+m+" "+(12>l?"AM":"PM"):h>o?"follow"==c||"main"==c?i+"/"+j+"/"+h:i+"/"+j+"/"+h+(0==l||12==l?12:l%12)+":"+((""+m).length<2?"0":"")+m+" "+(12>l?"AM":"PM"):"follow"==c||"main"==c?f[i]+". "+j+", "+(0==l||12==l?12:l%12)+":"+((""+m).length<2?"0":"")+m+" "+(12>l?"AM":"PM"):f[i]+". "+j;break;case"long":d=g[k]+" "+f[i]+". "+j+", "+h+" "+(0==l||12==l?12:l%12)+":"+((""+m).length<2?"0":"")+m+" "+(12>l?"AM":"PM")}return d}function authenticate(){var a=ES.evernymService.getAccessToken();return""==a||null==a?(sendMessageViewModel.clearForm(),ENYM.ctx.setItem("resumeStatus",1),goToView("loginView"),!1):!0}function time2TimeAgo(a){endDate=new Date,startDate=new Date(a);var b=startDate-endDate,c=864e5;startDate.setHours(0,0,0,1),endDate.setHours(23,59,59,999);var b=endDate-startDate,d=Math.ceil(b/c);if(d-=1,1==d)return" yesterday";if(d>1)return formatDate(a,"short");if(1>d){var e=new Date(a).getTime(),f=(new Date).getTime()-e,g=Math.floor(f/1e3),h=Math.floor(g/3600),i=h%24,j=g%3600,k=Math.floor(j/60),l=j%60,m=Math.ceil(l);return 1==i?i+" hr ago":i>1?i+" hrs ago":1==k?k+" min ago":k>1?k+" mins ago":m>1?m+" secs ago":"just now"}}function addExternalMarkup(a){$("#"+a+" header.logged-in").load("header.html"),$("#"+a+" .active-overlay").load("overlaymessages.html")}function truncatedText(){var a=$(window).width();return 400>a?a/7:a>400&&600>a?a/6:a>600&&800>a?a/5:a/4}function truncatedTextScreen(){var a=$(window).width();return 400>a?a/11:a>400&&700>a?a/8:a/8}function validateUSAPhone(a){var b=/^[0-9\-\s\(\)\+]+$/i;if(b.test(a)){var c=a.replace(/\D/g,"");if(10==c.length){textShow=c.replace(/(.{3})(.{3})(.{4})/,"$1-$2-$3");var d={type:"Text",text:textShow}}else if(11==c.length){c=c.slice(1,c),textShow=c.replace(/(.{3})(.{3})(.{4})/,"$1-$2-$3");var d={type:"Text",text:textShow}}else if(c.length>11||c.length<10)var d={type:"Error",text:"<span>Sorry,</span> Not a valid phone number."}}else var d={type:"Error",text:"<span>Sorry,</span> Not a valid phone number."};return d}function validateEmail(a){var b=/^([\w-\.\+]+@([\w-]+\.)+[\w-]{2,4})?$/;if(b.test(a)){if(b.test(a))var c={type:"Email",text:a}}else var c={type:"Error",text:"<span>Sorry,</span> Not a valid email address."};return c}var ENYM={};ENYM.Ctx=function(){var a=this;a.setItem=function(a,b){amplify.store(a,b),console.log("stored "+a)},a.removeItem=function(a){amplify.store(a,null),console.log("removed "+a)},a.getItem=function(a){console.log("retrieved "+a);var b=amplify.store(a);return void 0==b?null:b},a.removeAll=function(){$.each(amplify.store(),function(a){amplify.store(a,null)})}},ENYM.ctx=new ENYM.Ctx,ENYM.ViewModel=function(){this.accountName=ko.observable(),this.toastText=ko.observable(),this.previousViewID=ko.observable(),this.inputObs=[],this.errorObs=[],this.requiresAuth=!0,this.defineObservables=function(){var a=this;$.each(this.allObs(),function(b,c){a[c]=ko.observable()})},this.initializeObservables=function(a){var b=this;$.each(this.initObs,function(c,d){b[d]=ko.observable(a)})},this.clearObs=function(a){var b=this;$.each(a,function(a,c){b[c]("")})},this.clearForm=function(){this.clearObs(this.allObs())},this.clearErrorObs=function(){this.clearObs(this.errorObs)},this.allObs=function(){return this.inputObs.concat(this.errorObs)},this.applyBindings=function(){var a=this;$("#"+a.template).on("pagebeforeshow",null,function(b,c){(!a.requiresAuth||authenticate())&&(a.clearForm(),a.activate(),a.accountName(ENYM.ctx.getItem("accountName")),a.previousViewID(c.prevPage.attr("id")))})},this.removelLocalStorage=function(){var a=this;$.each(this.ENYM.ctx(),function(b,c){ENYM.ctx.removeItem(a[c])})},this.showToast=function(){},this.showBadgeCounts=function(){},this.showOverlayMessages=function(){}},AboutEvernymViewModel.prototype=new ENYM.ViewModel,AboutEvernymViewModel.prototype.constructor=AboutEvernymViewModel,AddContactViewModel.prototype=new ENYM.ViewModel,AddContactViewModel.prototype.constructor=AddContactViewModel,AddFollowersViewModel.prototype=new ENYM.ViewModel,AddFollowersViewModel.prototype.constructor=AddFollowersViewModel,AddInviteFollowersViewModel.prototype=new ENYM.ViewModel,AddInviteFollowersViewModel.prototype.constructor=AddInviteFollowersViewModel,AdditionalContactViewModel.prototype=new ENYM.ViewModel,AdditionalContactViewModel.prototype.constructor=AdditionalContactViewModel,AdministratorFeedbackViewModel.prototype=new ENYM.ViewModel,AdministratorFeedbackViewModel.prototype.constructor=AdministratorFeedbackViewModel,AdministratorViewModel.prototype=new ENYM.ViewModel,AdministratorViewModel.prototype.constructor=AdministratorViewModel,AfterLoginVerifyViewModel.prototype=new ENYM.ViewModel,AfterLoginVerifyViewModel.prototype.constructor=AfterLoginVerifyViewModel,ChangePasswordViewModel.prototype=new ENYM.ViewModel,ChangePasswordViewModel.prototype.constructor=ChangePasswordViewModel,ChannelChangeIconViewModel.prototype=new ENYM.ViewModel,ChannelChangeIconViewModel.prototype.constructor=ChannelChangeIconViewModel,ChannelChangeNameViewModel.prototype=new ENYM.ViewModel,ChannelChangeNameViewModel.prototype.constructor=ChannelChangeNameViewModel,ChannelDeleteViewModel.prototype=new ENYM.ViewModel,ChannelDeleteViewModel.prototype.constructor=ChannelDeleteViewModel,ChannelIntroViewModel.prototype=new ENYM.ViewModel,ChannelIntroViewModel.prototype.constructor=ChannelIntroViewModel,ChannelMainViewModel.prototype=new ENYM.ViewModel,ChannelMainViewModel.prototype.constructor=ChannelMainViewModel,ChannelMenuViewModel.prototype=new ENYM.ViewModel,ChannelMenuViewModel.prototype.constructor=ChannelMenuViewModel,ChannelMessagesViewModel.prototype=new ENYM.ViewModel,ChannelMessagesViewModel.prototype.constructor=ChannelMessagesViewModel,ChannelNewViewModel.prototype=new ENYM.ViewModel,ChannelNewViewModel.prototype.constructor=ChannelNewViewModel,ChannelSettingsViewModel.prototype=new ENYM.ViewModel,ChannelSettingsViewModel.prototype.constructor=ChannelSettingsViewModel,ChannelSingleMessagesViewModel.prototype=new ENYM.ViewModel,ChannelSingleMessagesViewModel.prototype.constructor=ChannelSingleMessagesViewModel,ChannelViewModel.prototype=new ENYM.ViewModel,ChannelViewModel.prototype.constructor=ChannelViewModel,ChannelViewUnfollowModel.prototype=new ENYM.ViewModel,ChannelViewUnfollowModel.prototype.constructor=ChannelViewUnfollowModel,ChannelsFollowingListViewModel.prototype=new ENYM.ViewModel,ChannelsFollowingListViewModel.prototype.constructor=ChannelsFollowingListViewModel,ChannelsIOwnViewModel.prototype=new ENYM.ViewModel,ChannelsIOwnViewModel.prototype.constructor=ChannelsIOwnViewModel,CommethodVerificationViewModel.prototype=new ENYM.ViewModel,CommethodVerificationViewModel.prototype.constructor=CommethodVerificationViewModel,DeclinedFollowersViewModel.prototype=new ENYM.ViewModel,DeclinedFollowersViewModel.prototype.constructor=DeclinedFollowersViewModel,EditFollowerDetailsViewModel.prototype=new ENYM.ViewModel,EditFollowerDetailsViewModel.prototype.constructor=EditFollowerDetailsViewModel,EditLongDescriptionViewModel.prototype=new ENYM.ViewModel,EditLongDescriptionViewModel.prototype.constructor=EditLongDescriptionViewModel,EditNameViewModel.prototype=new ENYM.ViewModel,EditNameViewModel.prototype.constructor=EditNameViewModel,EditShortDescriptionViewModel.prototype=new ENYM.ViewModel,EditShortDescriptionViewModel.prototype.constructor=EditShortDescriptionViewModel,EscalateHelpViewModel.prototype=new ENYM.ViewModel,EscalateHelpViewModel.prototype.constructor=EscalateHelpViewModel,EscalateSettingsViewModel.prototype=new ENYM.ViewModel,EscalateSettingsViewModel.prototype.constructor=EscalateSettingsViewModel,EscalateTimeSettingsViewModel.prototype=new ENYM.ViewModel,EscalateTimeSettingsViewModel.prototype.constructor=EscalateTimeSettingsViewModel,EscalationPlanSingleViewModel.prototype=new ENYM.ViewModel,EscalationPlanSingleViewModel.prototype.constructor=EscalationPlanSingleViewModel,FeedbackViewModel.prototype=new ENYM.ViewModel,FeedbackViewModel.prototype.constructor=FeedbackViewModel,FirstChannelViewModel.prototype=new ENYM.ViewModel,FirstChannelViewModel.prototype.constructor=FirstChannelViewModel,FollowChannelViewModel.prototype=new ENYM.ViewModel,FollowChannelViewModel.prototype.constructor=FollowChannelViewModel,FollowerDetailsViewModel.prototype=new ENYM.ViewModel,FollowerDetailsViewModel.prototype.constructor=FollowerDetailsViewModel,FollowersListViewModel.prototype=new ENYM.ViewModel,FollowersListViewModel.prototype.constructor=FollowersListViewModel,ForgotEvernymViewModel.prototype=new ENYM.ViewModel,ForgotEvernymViewModel.prototype.constructor=ForgotEvernymViewModel,ForgotPasswordViewModel.prototype=new ENYM.ViewModel,ForgotPasswordViewModel.prototype.constructor=ForgotPasswordViewModel,HelpViewModel.prototype=new ENYM.ViewModel,HelpViewModel.prototype.constructor=HelpViewModel,HomeViewModel.prototype=new ENYM.ViewModel,HomeViewModel.prototype.constructor=HomeViewModel,InviteFollowersViewModel.prototype=new ENYM.ViewModel,InviteFollowersViewModel.prototype.constructor=InviteFollowersViewModel,InvitedFollowersViewModel.prototype=new ENYM.ViewModel,InvitedFollowersViewModel.prototype.constructor=InvitedFollowersViewModel,LoginViewModel.prototype=new ENYM.ViewModel,LoginViewModel.prototype.constructor=LoginViewModel,MessageLengthWarningViewModel.prototype=new ENYM.ViewModel,MessageLengthWarningViewModel.prototype.constructor=MessageLengthWarningViewModel,NameRequiredViewModel.prototype=new ENYM.ViewModel,NameRequiredViewModel.prototype.constructor=NameRequiredViewModel,NewFollowersSettingsViewModel.prototype=new ENYM.ViewModel,NewFollowersSettingsViewModel.prototype.constructor=NewFollowersSettingsViewModel,NotGotItViewModel.prototype=new ENYM.ViewModel,NotGotItViewModel.prototype.constructor=NotGotItViewModel,PlusMenuViewModel.prototype=new ENYM.ViewModel,PlusMenuViewModel.prototype.constructor=PlusMenuViewModel,PrivacyPolicyViewModel.prototype=new ENYM.ViewModel,PrivacyPolicyViewModel.prototype.constructor=PrivacyPolicyViewModel,RecipientDetailsViewModel.prototype=new ENYM.ViewModel,RecipientDetailsViewModel.prototype.constructor=RecipientDetailsViewModel,RegistrationVerifyViewModel.prototype=new ENYM.ViewModel,RegistrationVerifyViewModel.prototype.constructor=RegistrationVerifyViewModel,RemoveFollowerViewModel.prototype=new ENYM.ViewModel,RemoveFollowerViewModel.prototype.constructor=RemoveFollowerViewModel,ReplyDetailViewModel.prototype=new ENYM.ViewModel,ReplyDetailViewModel.prototype.constructor=ReplyDetailViewModel,RequestiGiHelpViewModel.prototype=new ENYM.ViewModel,RequestiGiHelpViewModel.prototype.constructor=RequestiGiHelpViewModel,ResetPasswordViewModel.prototype=new ENYM.ViewModel,ResetPasswordViewModel.prototype.constructor=ResetPasswordViewModel,SendFeedbackViewModel.prototype=new ENYM.ViewModel,SendFeedbackViewModel.prototype.constructor=SendFeedbackViewModel,SendMessageViewModel.prototype=new ENYM.ViewModel,SendMessageViewModel.prototype.constructor=SendMessageViewModel,SignupStepFirstViewModel.prototype=new ENYM.ViewModel,SignupStepFirstViewModel.prototype.constructor=SignupStepFirstViewModel,SingleFeedbackViewModel.prototype=new ENYM.ViewModel,SingleFeedbackViewModel.prototype.constructor=SingleFeedbackViewModel,SingleMessageFullTextViewModel.prototype=new ENYM.ViewModel,SingleMessageFullTextViewModel.prototype.constructor=SingleMessageFullTextViewModel,SingleMessageRepliesViewModel.prototype=new ENYM.ViewModel,SingleMessageRepliesViewModel.prototype.constructor=SingleMessageRepliesViewModel,SingleMessageViewModel.prototype=new ENYM.ViewModel,SingleMessageViewModel.prototype.constructor=SingleMessageViewModel,TutorialViewModel.prototype=new ENYM.ViewModel,TutorialViewModel.prototype.constructor=TutorialViewModel,UnreachableFollowersViewModel.prototype=new ENYM.ViewModel,UnreachableFollowersViewModel.prototype.constructor=UnreachableFollowersViewModel,UserGuideViewModel.prototype=new ENYM.ViewModel,UserGuideViewModel.prototype.constructor=UserGuideViewModel,UserSettingsViewModel.prototype=new ENYM.ViewModel,UserSettingsViewModel.prototype.constructor=UserSettingsViewModel,VerifyContactViewModel.prototype=new ENYM.ViewModel,VerifyContactViewModel.prototype.constructor=VerifyContactViewModel,WhoGotItViewModel.prototype=new ENYM.ViewModel,WhoGotItViewModel.prototype.constructor=WhoGotItViewModel;var CODEMAP={1e5:"userSettingsView"},NotificationOverlay=function(){var a=this;this.close=function(){$("#notification-overlay").remove()},this.addNotification=function(b){a.notifications.push(b)},this.removeNotifications=function(){a.notifications=[]},this.displayNotifications=function(){if(console.log("trying to get notifications"+JSON.stringify(a.notifications)),a.notifications)for(var b=0;b<a.notifications.length;b++)$("#notification-overlay").prepend('<div style="border:1px solid gray; border-radius:5px;margin:0px 0px 5px;background:white;cursor:pointer;" onclick="goToView(\''+CODEMAP[a.notifications[b].code]+"');OVERLAY.close();\">"+a.notifications[b].message+"</div>")},this.setPosition=function(){$("#notification-overlay").css({width:$.mobile.activePage.width()-30,height:$(window).height()-30,left:$.mobile.activePage.offset().left+10,top:10})},this.show=function(){var b=$("#notification-overlay").get(0);b||$("<div id='notification-overlay' class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h3><br/><button onclick='OVERLAY.close();' style='font-size:16pt;'>ok</button></h3></div>").css({display:"block",opacity:.95,position:"fixed",padding:"7px","text-align":"center",width:$.mobile.activePage.width()-30,height:$(window).height()-30,left:$.mobile.activePage.offset().left+10,top:10}).appendTo($.mobile.pageContainer).delay(1500),a.displayNotifications()}},OVERLAY=new NotificationOverlay;$(window).resize(function(){OVERLAY.setPosition()});var EVERNYM_ICONS={sports:{image:"sports-icons-01.jpg",width:70,height:70,imagewidth:700,imageheight:700,columns:10,rows:10,count:100},animals:{image:"animal-icons.png",width:135,height:135,imagewidth:945,imageheight:945,columns:7,rows:7,count:46},business:{image:"business_icons.jpg",width:135,height:135,imagewidth:1200,imageheight:1200,columns:6,rows:6,count:36},round:{image:"round_icons.jpg",width:135,height:135,imagewidth:400,imageheight:400,columns:6,rows:6,count:24},outdoor:{image:"outdoor_icons.jpg",width:135,height:135,imagewidth:380,imageheight:380,columns:4,rows:4,count:16}},pushNotification,ES={evernymService:new EvernymService};ES.evernymService=new EvernymService,ES.channelService=new EvernymChannelService(ES.evernymService),ES.commethodService=new EvernymCommethodService(ES.evernymService),ES.loginService=new EvernymLoginService(ES.evernymService),ES.systemService=new EvernymSystemService(ES.evernymService),ES.messageService=new EvernymMessageService(ES.evernymService),ES.escplanService=new EvernymEscPlanService(ES.evernymService),ES.evernymService.doAfterDone=function(){$.mobile.hidePageLoadingMsg()},ES.evernymService.doAfterFail=function(a,b,c,d,e){if($.mobile.hidePageLoadingMsg(),b.responseJSON)if("100201"==b.responseJSON.code||"100202"==b.responseJSON.code||"100203"==b.responseJSON.code){ES.evernymService.clearAccessToken(),authenticate();var f={type:"toast-error",text:b.responseJSON.message};showToast(f)}else{var g=$.mobile.urlHistory.getActive().hash;isBadLogin(e.code)&&-1==g.indexOf("loginView")&&(ENYM.ctx.setItem("resumeStatus",1),ENYM.ctx.setItem("login_nav",JSON.stringify({hash:g,params:a})))}},ko.virtualElements.allowedBindings.updateListviewOnChange=!0,ko.bindingHandlers.updateListviewOnChange={update:function(a,b){ko.utils.unwrapObservable(b());var c=$(a).parents().andSelf().filter("[data-role='listview']");if(c)try{$(c).listview("refresh")}catch(d){}}};var messages=0,activePage="",openPanel=!1;Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){null==b?b=0:0>b&&(b=Math.max(0,this.length+b));for(var c=b,d=this.length;d>c;c++)if(this[c]===a)return c;return-1});var loginViewModel=new LoginViewModel,homeViewModel=new HomeViewModel,channelsFollowingListViewModel=new ChannelsFollowingListViewModel,channelViewModel=new ChannelViewModel,channelMenuViewModel=new ChannelMenuViewModel,channelSettingsViewModel=new ChannelSettingsViewModel,channelNewViewModel=new ChannelNewViewModel,sendMessageViewModel=new SendMessageViewModel,followersListViewModel=new FollowersListViewModel,inviteFollowersViewModel=new InviteFollowersViewModel,forgotPasswordViewModel=new ForgotPasswordViewModel,resetPasswordViewModel=new ResetPasswordViewModel,userSettingsViewModel=new UserSettingsViewModel,escalationPlanSingleViewModel=new EscalationPlanSingleViewModel,addContactViewModel=new AddContactViewModel,additionalContactViewModel=new AdditionalContactViewModel,verifyContactViewModel=new VerifyContactViewModel,channelMessagesViewModel=new ChannelMessagesViewModel,channelSingleMessagesViewModel=new ChannelSingleMessagesViewModel,channelViewUnfollowModel=new ChannelViewUnfollowModel,changePasswordViewModel=new ChangePasswordViewModel,tutorialViewModel=new TutorialViewModel,signupStepFirstViewModel=new SignupStepFirstViewModel,signupStepSecondViewModel=new SignupStepSecondViewModel,channelsIOwnViewModel=new ChannelsIOwnViewModel,helpViewModel=new HelpViewModel,aboutEvernymViewModel=new AboutEvernymViewModel,feedbackViewModel=new FeedbackViewModel,administratorViewModel=new AdministratorViewModel,sendFeedbackViewModel=new SendFeedbackViewModel,privacyPolicyViewModel=new PrivacyPolicyViewModel,administratorFeedbackViewModel=new AdministratorFeedbackViewModel,singleFeedbackViewModel=new SingleFeedbackViewModel,channelMainViewModel=new ChannelMainViewModel,channelChangeNameViewModel=new ChannelChangeNameViewModel,editShortDescriptionViewModel=new EditShortDescriptionViewModel,channelDeleteViewModel=new ChannelDeleteViewModel,channelChangeIconViewModel=new ChannelChangeIconViewModel,firstChannelViewModel=new FirstChannelViewModel,registrationVerifyViewModel=new RegistrationVerifyViewModel,singleMessageFullTextViewModel=new SingleMessageFullTextViewModel,singleMessageRepliesViewModel=new SingleMessageRepliesViewModel,replyDetailViewModel=new ReplyDetailViewModel,addInviteFollowersViewModel=new AddInviteFollowersViewModel,addFollowersViewModel=new AddFollowersViewModel,editNameViewModel=new EditNameViewModel,editLongDescriptionViewModel=new EditLongDescriptionViewModel,requestiGiHelpViewModel=new RequestiGiHelpViewModel,escalateHelpViewModel=new EscalateHelpViewModel,escalateSettingsViewModel=new EscalateSettingsViewModel,escalateTimeSettingsViewModel=new EscalateTimeSettingsViewModel,followerDetailsViewModel=new FollowerDetailsViewModel,editFollowerDetailsViewModel=new EditFollowerDetailsViewModel,removeFollowerViewModel=new RemoveFollowerViewModel,notGotItViewModel=new NotGotItViewModel,whoGotItViewModel=new WhoGotItViewModel,recipientDetailsViewModel=new RecipientDetailsViewModel,singleMessageViewModel=new SingleMessageViewModel,userGuideViewModel=new UserGuideViewModel,plusMenuViewModel=new PlusMenuViewModel,channelIntroViewModel=new ChannelIntroViewModel,nameRequiredViewModel=new NameRequiredViewModel,forgotEvernymViewModel=new ForgotEvernymViewModel,messageLengthWarningViewModel=new MessageLengthWarningViewModel,newFollowersSettingsViewModel=new NewFollowersSettingsViewModel,followChannelViewModel=new FollowChannelViewModel,invitedFollowersViewModel=new InvitedFollowersViewModel,declinedFollowersViewModel=new DeclinedFollowersViewModel,unreachableFollowersViewModel=new UnreachableFollowersViewModel,afterLoginVerifyViewModel=new AfterLoginVerifyViewModel;$.mobile.defaultPageTransition="";var models=[loginViewModel,homeViewModel,channelsFollowingListViewModel,channelViewModel,channelMenuViewModel,channelSettingsViewModel,channelNewViewModel,sendMessageViewModel,followersListViewModel,inviteFollowersViewModel,forgotPasswordViewModel,resetPasswordViewModel,singleMessageViewModel,userSettingsViewModel,escalationPlanSingleViewModel,addContactViewModel,additionalContactViewModel,verifyContactViewModel,signupStepFirstViewModel,signupStepSecondViewModel,tutorialViewModel,channelsIOwnViewModel,helpViewModel,aboutEvernymViewModel,feedbackViewModel,sendFeedbackViewModel,privacyPolicyViewModel,channelMainViewModel,channelChangeNameViewModel,editShortDescriptionViewModel,channelDeleteViewModel,channelChangeIconViewModel,firstChannelViewModel,channelMessagesViewModel,registrationVerifyViewModel,singleMessageFullTextViewModel,channelViewUnfollowModel,singleMessageRepliesViewModel,replyDetailViewModel,channelSingleMessagesViewModel,addInviteFollowersViewModel,addFollowersViewModel,editNameViewModel,editLongDescriptionViewModel,changePasswordViewModel,requestiGiHelpViewModel,escalateHelpViewModel,escalateSettingsViewModel,escalateTimeSettingsViewModel,followerDetailsViewModel,removeFollowerViewModel,notGotItViewModel,whoGotItViewModel,recipientDetailsViewModel,userGuideViewModel,plusMenuViewModel,channelIntroViewModel,nameRequiredViewModel,administratorViewModel,administratorFeedbackViewModel,singleFeedbackViewModel,forgotEvernymViewModel,messageLengthWarningViewModel,newFollowersSettingsViewModel,followChannelViewModel,editFollowerDetailsViewModel,invitedFollowersViewModel,declinedFollowersViewModel,unreachableFollowersViewModel,afterLoginVerifyViewModel];if($(document).ready(function(){console.log("document ready");var a=ENYM.ctx.getItem("accessToken");""==document.location.hash&&(document.location.hash=a?"#channelsIOwnView":"#loginView"),console.log("hash: "+document.location.hash),$.mobile.activeBtnClass="",ENYM.ctx.removeItem("baseUrl"),loadAllPages().done(function(){console.log("done loading all pages."),console.log("INITIALIZE PAGE"),$.mobile.initializePage()})}),$(document).on("pagebeforecreate",'[data-role="page"]',function(){console.log("creating "+$(this).attr("id")),$(this).find("#gpanel").append($("#globalpanel #mypanel").clone()),$(this).find("#gpaneldots").append($("#globalpaneldots #mypaneldots").clone()),$(this).find("#gfooter").after($("#globalfooter #thefooter").clone()),$(this).page({domCache:!0})}),$(document).on("pagebeforehide",'[data-role="page"]',function(){console.log("hiding page: "+$(this).attr("id")),ENYM.ctx.setItem("previousView",$(this).attr("id"))}),$(document).on("pagebeforeshow",'[data-role="page"]',function(){console.log("showing page: "+$(this).attr("id"));var a=ko.dataFor(this),b=ENYM.ctx.getItem("accessToken");if(document.title=a.displayname,a&&a.hasfooter&&b){var c=a.viewid,d=a.viewname,e=ENYM.ctx.getItem("accountName");$(this).find("#thefooter #footer-gear").html(e),$(this).find("#thefooter #viewid").html(c+" "+d)}else $(this).find("#thefooter").remove()}),$(document).on("swipeleft",'[data-role="page"]',function(){openPanel||$(this).find("#mypanel").panel("open")}),$(document).on("expand",'[data-role="collapsible"]',function(){$(this).find("span.ui-btn-inner").css({background:"#D1D3D4","border-top":"#F1F2F2","border-bottom":"#A7A9AC"}),$(window).resize()}),$(document).on("collapse",'[data-role="collapsible"]',function(){$(this).find("span.ui-btn-inner").css({background:"","border-top":"","border-bottom":""}),$(window).resize()}),$(document).bind("pagebeforechange",function(a,b){$.mobile.pageData=b&&b.options&&b.options.pageData?b.options.pageData:null}),$(document).bind("panelclose",function(){openPanel=!1}),$(document).bind("panelopen",function(){openPanel=!0}),$(document).bind("panelbeforeclose",function(){$(".ui-panel").scrollTop(0)}),$(document).bind("panelbeforeopen",function(){top_pos=$(document).scrollTop(),$(".ui-panel").css("top",top_pos)}),ENYM.ctx.getItem("backNavText")&&ENYM.ctx.getItem("backNavView"))var backNavText=JSON.parse(ENYM.ctx.getItem("backNavText")),backNavView=JSON.parse(ENYM.ctx.getItem("backNavView"));else var backNavText=[],backNavView=[];var last,diff;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var initialScreenSize=window.innerHeight;window.addEventListener("resize",function(){window.innerHeight<initialScreenSize?$(".footer").hide():$(".footer").show()})}
//# sourceMappingURL=evernym-channels.min.map